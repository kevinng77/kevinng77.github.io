import{_ as o,Q as i,V as l,Z as n,a2 as e,Y as a,a1 as c,aQ as t,H as p}from"./framework-8ecb9d65.js";const r="/assets/img/precommit-md/image-20211003102602000.png",u={},d={href:"https://pre-commit.com/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://pre-commit.com/hooks.html",target:"_blank",rel:"noopener noreferrer"},k=t('<h3 id="背景-git-hook" tabindex="-1"><a class="header-anchor" href="#背景-git-hook" aria-hidden="true">#</a> 背景 - git hook</h3><p>网上对于 git hook 的讲解很多，简单概括的话，git hook 就是一种可以在 git 各个操作阶段被执行的工具，这些工具可以做到如检查代码规范，阻止不合格代码提交等功能。</p><figure><img src="'+r+`" alt="相关图片" height="300" tabindex="0" loading="lazy"><figcaption>相关图片</figcaption></figure><p>（图：一些 git hook 示意图。橙色/红色/蓝色 矩形框即为 git hook）</p><h3 id="pre-commit-快速开始" tabindex="-1"><a class="header-anchor" href="#pre-commit-快速开始" aria-hidden="true">#</a> pre-commit 快速开始</h3><blockquote><p>一般我们手动建立的 git hook 不会被上传到 git 远程仓库中，若要共同分享 pre-commit git hook，则需要安装并配置 pre-commit。</p></blockquote><h4 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pip install pre-commit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>或 conda 安装</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>conda install -c conda-forge pre-commit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装后在<code>requirements.txt</code>中添加 <code>pre-commit</code> 一项</p><h4 id="添加一个样本配置文件" tabindex="-1"><a class="header-anchor" href="#添加一个样本配置文件" aria-hidden="true">#</a> 添加一个样本配置文件</h4><p>输入 <code>pre-commit --version</code> 查看是否安装成功。</p><p>添加一个 pre-commit 配置文件，在 <code>git</code> 仓库根目录下创建并编写 <code>.pre-commit-config.yaml</code> 文件。</p><p>在 python 环境下输入 <code>pre-commit sample-config</code> ，我们能够得到一个配置文件样例：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>repos:
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v2.3.0
    hooks:
    -   id: check-yaml
    -   id: end-of-file-fixer
    -   id: trailing-whitespace
-   repo: https://github.com/psf/black
    rev: 19.3b0
    hooks:
    -   id: black
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将以上内容复制到刚刚创建的 <code>.pre-commit-config.yaml</code>中。更多的配置设定请参考<a href="#%E9%85%8D%E7%BD%AE-pre-commit">下文</a>。</p><h4 id="安装-pre-commit-相关-git-hook-脚本" tabindex="-1"><a class="header-anchor" href="#安装-pre-commit-相关-git-hook-脚本" aria-hidden="true">#</a> 安装 pre-commit 相关 git hook 脚本</h4><p>pre-commit 也是 git hook 中的一种，在对应的 git 仓库下执行：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pre-commit install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后在<code>.git/hook</code> 文件加中会生成一个可执行脚本，此时 <code>pre-commit</code> 就会自动在 <code>git commit</code> 的时候运行了。</p><h4 id="对所有文件执行-pre-commit" tabindex="-1"><a class="header-anchor" href="#对所有文件执行-pre-commit" aria-hidden="true">#</a> 对所有文件执行 pre-commit</h4><p>通常 pre-commit 只对修改后的文件执行 pre-commit 操作。</p><h3 id="配置-pre-commit" tabindex="-1"><a class="header-anchor" href="#配置-pre-commit" aria-hidden="true">#</a> 配置 pre-commit</h3><p><strong>repos 参数配置</strong></p><p>在每个 repo 下我们需要配置以下三种映射：</p>`,26),h={href:"https://pre-commit.com/#repos-repo",target:"_blank",rel:"noopener noreferrer"},v=n("code",null,"repo",-1),_=n("th",null,[n("code",null,"git clone"),e(" 对象的仓库 URL（需要拷贝的 hook 的对应仓库链接）")],-1),g={href:"https://pre-commit.com/#repos-rev",target:"_blank",rel:"noopener noreferrer"},b=n("code",null,"rev",-1),f=n("td",null,[e("克隆对象仓库的版本或 tag: 部分之前的版本会使用 "),n("code",null,"sha")],-1),x={href:"https://pre-commit.com/#repos-hooks",target:"_blank",rel:"noopener noreferrer"},y=n("code",null,"hooks",-1),V={href:"https://pre-commit.com/#pre-commit-configyaml---hooks",target:"_blank",rel:"noopener noreferrer"},q=t(`<p>实例：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>repos:
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v1.2.3
    hooks:
    -   ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>hooks 的重要配置</strong></p>`,3),E={href:"https://pre-commit.com/#pre-commit-configyaml---hooks",target:"_blank",rel:"noopener noreferrer"},L={href:"https://pre-commit.com/hooks.html",target:"_blank",rel:"noopener noreferrer"},N={href:"https://pre-commit.com/#config-id",target:"_blank",rel:"noopener noreferrer"},$=n("code",null,"id",-1),B=n("th",null,"hook 在对应仓库中的 id",-1),w={href:"https://pre-commit.com/#config-name",target:"_blank",rel:"noopener noreferrer"},C=n("code",null,"name",-1),D=n("td",null,"(optional) override the name of the hook - shown during hook execution.",-1),I={href:"https://pre-commit.com/#config-files",target:"_blank",rel:"noopener noreferrer"},Q=n("code",null,"files",-1),j=n("td",null,"(optional) 重新设定 hook 要执行的文件对象。",-1),z={href:"https://pre-commit.com/#config-language_version",target:"_blank",rel:"noopener noreferrer"},A=n("code",null,"language_version",-1),H={href:"https://pre-commit.com/#overriding-language-version",target:"_blank",rel:"noopener noreferrer"},M={href:"https://pre-commit.com/#config-verbose",target:"_blank",rel:"noopener noreferrer"},O=n("code",null,"verbose",-1),R=n("td",null,"(optional) 如果设定为 true，hook 检查代码通过后也会输出执行日志。",-1),S=n("p",null,"一些其他可选参数：",-1),T={href:"https://pre-commit.com/#top_level-default_language_version",target:"_blank",rel:"noopener noreferrer"},U=n("code",null,"default_language_version",-1),Y=t(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>default_language_version:
    python: python3.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Z={href:"https://pre-commit.com/#top_level-default_stages",target:"_blank",rel:"noopener noreferrer"},F=n("code",null,"default_stages",-1),G=n("div",{class:"language-text line-numbers-mode","data-ext":"text"},[n("pre",{class:"language-text"},[n("code",null,`default_stages: [commit, push]
`)]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),J={href:"https://pre-commit.com/#top_level-fail_fast",target:"_blank",rel:"noopener noreferrer"},K=n("code",null,"fail_fast",-1),P=n("div",{class:"language-text line-numbers-mode","data-ext":"text"},[n("pre",{class:"language-text"},[n("code",null,`fail_fast: true
`)]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),W={href:"https://pre-commit.com/#top_level-minimum_pre_commit_version",target:"_blank",rel:"noopener noreferrer"},X=n("code",null,"minimum_pre_commit_version",-1),nn=n("code",null,"'0'",-1),en=t(`<h3 id="参考配置" tabindex="-1"><a class="header-anchor" href="#参考配置" aria-hidden="true">#</a> 参考配置：</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">repos</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span>   <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/Lucas<span class="token punctuation">-</span>C/pre<span class="token punctuation">-</span>commit<span class="token punctuation">-</span>hooks
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v1.0.1
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> forbid<span class="token punctuation">-</span>crlf
        <span class="token key atrule">files</span><span class="token punctuation">:</span> \\.md$
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> remove<span class="token punctuation">-</span>crlf
        <span class="token key atrule">files</span><span class="token punctuation">:</span> \\.md$
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> forbid<span class="token punctuation">-</span>tabs
        <span class="token key atrule">files</span><span class="token punctuation">:</span> \\.md$
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> remove<span class="token punctuation">-</span>tabs
        <span class="token key atrule">files</span><span class="token punctuation">:</span> \\.md$
<span class="token punctuation">-</span>   <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/pre<span class="token punctuation">-</span>commit/pre<span class="token punctuation">-</span>commit<span class="token punctuation">-</span>hooks
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v4.0.1
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>merge<span class="token punctuation">-</span>conflict
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> detect<span class="token punctuation">-</span>private<span class="token punctuation">-</span>key
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>symlinks
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> trailing<span class="token punctuation">-</span>whitespace
        <span class="token key atrule">files</span><span class="token punctuation">:</span> \\.md$
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> end<span class="token punctuation">-</span>of<span class="token punctuation">-</span>file<span class="token punctuation">-</span>fixer
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>docstring<span class="token punctuation">-</span>first
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>json
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>added<span class="token punctuation">-</span>large<span class="token punctuation">-</span>files
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>yaml
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> debug<span class="token punctuation">-</span>statements
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> name<span class="token punctuation">-</span>tests<span class="token punctuation">-</span>test
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> double<span class="token punctuation">-</span>quote<span class="token punctuation">-</span>string<span class="token punctuation">-</span>fixer
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> requirements<span class="token punctuation">-</span>txt<span class="token punctuation">-</span>fixer
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> fix<span class="token punctuation">-</span>encoding<span class="token punctuation">-</span>pragma
    

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2);function sn(an,tn){const s=p("ExternalLinkIcon");return i(),l("div",null,[n("blockquote",null,[n("p",null,[e("本文对代码自动化规范工具 - pre-commit 进行了主要流程介绍，大部分内容为 "),n("a",d,[e("官网详细文档"),a(s)]),e(" 的中文翻译，总结与拓展。")]),n("p",null,[e("相关链接："),n("a",m,[e("hook 指南"),a(s)])])]),c("more"),k,n("table",null,[n("thead",null,[n("tr",null,[n("th",null,[n("a",h,[v,a(s)])]),_])]),n("tbody",null,[n("tr",null,[n("td",null,[n("a",g,[b,a(s)])]),f]),n("tr",null,[n("td",null,[n("a",x,[y,a(s)])]),n("td",null,[e("包含各种 "),n("a",V,[e("hook mappings"),a(s)]),e(" 的列表")])])])]),q,n("p",null,[e("一下列举部分常用的配置信息，其他参数请参考 "),n("a",E,[e("hook mappings 官方"),a(s)]),e(" 。"),n("a",L,[e("这份指南"),a(s)]),e(" 整理了各种代码对应的 git hood id 与功能，方便查看与配置。")]),n("table",null,[n("thead",null,[n("tr",null,[n("th",null,[n("a",N,[$,a(s)])]),B])]),n("tbody",null,[n("tr",null,[n("td",null,[n("a",w,[C,a(s)])]),D]),n("tr",null,[n("td",null,[n("a",I,[Q,a(s)])]),j]),n("tr",null,[n("td",null,[n("a",z,[A,a(s)])]),n("td",null,[e("(optional) 重新设定语言版本，具体参考： "),n("a",H,[e("Overriding Language Version"),a(s)]),e(".")])]),n("tr",null,[n("td",null,[n("a",M,[O,a(s)])]),R])])]),S,n("p",null,[n("a",T,[U,a(s)]),e(" 用于配置默认的语言版本，如 配置 python 的默认版本为 3.7，则添加：")]),Y,n("p",null,[n("a",Z,[F,a(s)]),e(" 默认为所有 stages。暂时没搞懂这个参数干啥的，似乎挺少人配置它。样例：")]),G,n("p",null,[n("a",J,[K,a(s)]),e(" 默认为 false，如果设置为 true 的话， pre-commit 会在第一次 hood 失败后马上终止。")]),P,n("p",null,[n("a",W,[X,a(s)]),e(" 默认为 "),nn,e(" ，最小 pre-commit 版本要求。")]),en])}const ln=o(u,[["render",sn],["__file","笔记precommit-md.html.vue"]]);export{ln as default};
