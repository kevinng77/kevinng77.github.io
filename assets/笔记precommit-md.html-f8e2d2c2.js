import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as i,c as p,a as s,b as e,d as a,e as r,f as l}from"./app-a449bd9b.js";const c="/assets/img/precommit-md/image-20211003102602000.png",d={},m={href:"https://pre-commit.com/",target:"_blank",rel:"noopener noreferrer"},h={href:"https://pre-commit.com/hooks.html",target:"_blank",rel:"noopener noreferrer"},u=l('<h3 id="背景-git-hook" tabindex="-1"><a class="header-anchor" href="#背景-git-hook" aria-hidden="true">#</a> 背景 - git hook</h3><p>网上对于 git hook 的讲解很多，简单概括的话，git hook 就是一种可以在 git 各个操作阶段被执行的工具，这些工具可以做到如检查代码规范，阻止不合格代码提交等功能。</p><figure><img src="'+c+`" alt="相关图片" height="300" tabindex="0" loading="lazy"><figcaption>相关图片</figcaption></figure><p>（图：一些 git hook 示意图。橙色/红色/蓝色 矩形框即为 git hook）</p><h3 id="pre-commit-快速开始" tabindex="-1"><a class="header-anchor" href="#pre-commit-快速开始" aria-hidden="true">#</a> pre-commit 快速开始</h3><blockquote><p>一般我们手动建立的 git hook 不会被上传到 git 远程仓库中，若要共同分享 pre-commit git hook，则需要安装并配置 pre-commit。</p></blockquote><h4 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">pip install pre-commit</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>或 conda 安装</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">conda install -c conda-forge pre-commit</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装后在<code>requirements.txt</code>中添加 <code>pre-commit</code> 一项</p><h4 id="添加一个样本配置文件" tabindex="-1"><a class="header-anchor" href="#添加一个样本配置文件" aria-hidden="true">#</a> 添加一个样本配置文件</h4><p>输入 <code>pre-commit --version</code> 查看是否安装成功。</p><p>添加一个 pre-commit 配置文件，在 <code>git</code> 仓库根目录下创建并编写 <code>.pre-commit-config.yaml</code> 文件。</p><p>在 python 环境下输入 <code>pre-commit sample-config</code> ，我们能够得到一个配置文件样例：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">repos:</span></span>
<span class="line"><span style="color:#24292e;">-   repo: https://github.com/pre-commit/pre-commit-hooks</span></span>
<span class="line"><span style="color:#24292e;">    rev: v2.3.0</span></span>
<span class="line"><span style="color:#24292e;">    hooks:</span></span>
<span class="line"><span style="color:#24292e;">    -   id: check-yaml</span></span>
<span class="line"><span style="color:#24292e;">    -   id: end-of-file-fixer</span></span>
<span class="line"><span style="color:#24292e;">    -   id: trailing-whitespace</span></span>
<span class="line"><span style="color:#24292e;">-   repo: https://github.com/psf/black</span></span>
<span class="line"><span style="color:#24292e;">    rev: 19.3b0</span></span>
<span class="line"><span style="color:#24292e;">    hooks:</span></span>
<span class="line"><span style="color:#24292e;">    -   id: black</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将以上内容复制到刚刚创建的 <code>.pre-commit-config.yaml</code>中。更多的配置设定请参考<a href="#%E9%85%8D%E7%BD%AE-pre-commit">下文</a>。</p><h4 id="安装-pre-commit-相关-git-hook-脚本" tabindex="-1"><a class="header-anchor" href="#安装-pre-commit-相关-git-hook-脚本" aria-hidden="true">#</a> 安装 pre-commit 相关 git hook 脚本</h4><p>pre-commit 也是 git hook 中的一种，在对应的 git 仓库下执行：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">pre-commit install</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后在<code>.git/hook</code> 文件加中会生成一个可执行脚本，此时 <code>pre-commit</code> 就会自动在 <code>git commit</code> 的时候运行了。</p><h4 id="对所有文件执行-pre-commit" tabindex="-1"><a class="header-anchor" href="#对所有文件执行-pre-commit" aria-hidden="true">#</a> 对所有文件执行 pre-commit</h4><p>通常 pre-commit 只对修改后的文件执行 pre-commit 操作。</p><h3 id="配置-pre-commit" tabindex="-1"><a class="header-anchor" href="#配置-pre-commit" aria-hidden="true">#</a> 配置 pre-commit</h3><p><strong>repos 参数配置</strong></p><p>在每个 repo 下我们需要配置以下三种映射：</p>`,26),v={href:"https://pre-commit.com/#repos-repo",target:"_blank",rel:"noopener noreferrer"},y=s("code",null,"repo",-1),b=s("th",null,[s("code",null,"git clone"),e(" 对象的仓库 URL（需要拷贝的 hook 的对应仓库链接）")],-1),_={href:"https://pre-commit.com/#repos-rev",target:"_blank",rel:"noopener noreferrer"},g=s("code",null,"rev",-1),f=s("td",null,[e("克隆对象仓库的版本或 tag: 部分之前的版本会使用 "),s("code",null,"sha")],-1),k={href:"https://pre-commit.com/#repos-hooks",target:"_blank",rel:"noopener noreferrer"},E=s("code",null,"hooks",-1),x={href:"https://pre-commit.com/#pre-commit-configyaml---hooks",target:"_blank",rel:"noopener noreferrer"},A=l(`<p>实例：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">repos:</span></span>
<span class="line"><span style="color:#24292e;">-   repo: https://github.com/pre-commit/pre-commit-hooks</span></span>
<span class="line"><span style="color:#24292e;">    rev: v1.2.3</span></span>
<span class="line"><span style="color:#24292e;">    hooks:</span></span>
<span class="line"><span style="color:#24292e;">    -   ...</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>hooks 的重要配置</strong></p>`,3),F={href:"https://pre-commit.com/#pre-commit-configyaml---hooks",target:"_blank",rel:"noopener noreferrer"},q={href:"https://pre-commit.com/hooks.html",target:"_blank",rel:"noopener noreferrer"},V={href:"https://pre-commit.com/#config-id",target:"_blank",rel:"noopener noreferrer"},L=s("code",null,"id",-1),N=s("th",null,"hook 在对应仓库中的 id",-1),$={href:"https://pre-commit.com/#config-name",target:"_blank",rel:"noopener noreferrer"},B=s("code",null,"name",-1),w=s("td",null,"(optional) override the name of the hook - shown during hook execution.",-1),C={href:"https://pre-commit.com/#config-files",target:"_blank",rel:"noopener noreferrer"},D=s("code",null,"files",-1),I=s("td",null,"(optional) 重新设定 hook 要执行的文件对象。",-1),j={href:"https://pre-commit.com/#config-language_version",target:"_blank",rel:"noopener noreferrer"},z=s("code",null,"language_version",-1),M={href:"https://pre-commit.com/#overriding-language-version",target:"_blank",rel:"noopener noreferrer"},O={href:"https://pre-commit.com/#config-verbose",target:"_blank",rel:"noopener noreferrer"},R=s("code",null,"verbose",-1),S=s("td",null,"(optional) 如果设定为 true，hook 检查代码通过后也会输出执行日志。",-1),T=s("p",null,"一些其他可选参数：",-1),U={href:"https://pre-commit.com/#top_level-default_language_version",target:"_blank",rel:"noopener noreferrer"},G=s("code",null,"default_language_version",-1),H=l(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">default_language_version:</span></span>
<span class="line"><span style="color:#24292e;">    python: python3.7</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,1),J={href:"https://pre-commit.com/#top_level-default_stages",target:"_blank",rel:"noopener noreferrer"},K=s("code",null,"default_stages",-1),P=l(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">default_stages: [commit, push]</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),Q={href:"https://pre-commit.com/#top_level-fail_fast",target:"_blank",rel:"noopener noreferrer"},W=s("code",null,"fail_fast",-1),X=l(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">fail_fast: true</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),Y={href:"https://pre-commit.com/#top_level-minimum_pre_commit_version",target:"_blank",rel:"noopener noreferrer"},Z=s("code",null,"minimum_pre_commit_version",-1),ss=s("code",null,"'0'",-1),es=l(`<h3 id="参考配置" tabindex="-1"><a class="header-anchor" href="#参考配置" aria-hidden="true">#</a> 参考配置：</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">repos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">-   </span><span style="color:#22863A;">repo</span><span style="color:#24292E;">: </span><span style="color:#032F62;">https://github.com/Lucas-C/pre-commit-hooks</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rev</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1.0.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">hooks</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">forbid-crlf</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">files</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\\.md$</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">remove-crlf</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">files</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\\.md$</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">forbid-tabs</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">files</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\\.md$</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">remove-tabs</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">files</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\\.md$</span></span>
<span class="line"><span style="color:#24292E;">-   </span><span style="color:#22863A;">repo</span><span style="color:#24292E;">: </span><span style="color:#032F62;">https://github.com/pre-commit/pre-commit-hooks</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rev</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v4.0.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">hooks</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">check-merge-conflict</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">detect-private-key</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">check-symlinks</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">trailing-whitespace</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">files</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\\.md$</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">end-of-file-fixer</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">check-docstring-first</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">check-json</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">check-added-large-files</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">check-yaml</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">debug-statements</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">name-tests-test</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">double-quote-string-fixer</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">requirements-txt-fixer</span></span>
<span class="line"><span style="color:#24292E;">    -   </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">fix-encoding-pragma</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2);function ns(as,ls){const n=t("ExternalLinkIcon");return i(),p("div",null,[s("blockquote",null,[s("p",null,[e("本文对代码自动化规范工具 - pre-commit 进行了主要流程介绍，大部分内容为 "),s("a",m,[e("官网详细文档"),a(n)]),e(" 的中文翻译，总结与拓展。")]),s("p",null,[e("相关链接："),s("a",h,[e("hook 指南"),a(n)])])]),r("more"),u,s("table",null,[s("thead",null,[s("tr",null,[s("th",null,[s("a",v,[y,a(n)])]),b])]),s("tbody",null,[s("tr",null,[s("td",null,[s("a",_,[g,a(n)])]),f]),s("tr",null,[s("td",null,[s("a",k,[E,a(n)])]),s("td",null,[e("包含各种 "),s("a",x,[e("hook mappings"),a(n)]),e(" 的列表")])])])]),A,s("p",null,[e("一下列举部分常用的配置信息，其他参数请参考 "),s("a",F,[e("hook mappings 官方"),a(n)]),e(" 。"),s("a",q,[e("这份指南"),a(n)]),e(" 整理了各种代码对应的 git hood id 与功能，方便查看与配置。")]),s("table",null,[s("thead",null,[s("tr",null,[s("th",null,[s("a",V,[L,a(n)])]),N])]),s("tbody",null,[s("tr",null,[s("td",null,[s("a",$,[B,a(n)])]),w]),s("tr",null,[s("td",null,[s("a",C,[D,a(n)])]),I]),s("tr",null,[s("td",null,[s("a",j,[z,a(n)])]),s("td",null,[e("(optional) 重新设定语言版本，具体参考： "),s("a",M,[e("Overriding Language Version"),a(n)]),e(".")])]),s("tr",null,[s("td",null,[s("a",O,[R,a(n)])]),S])])]),T,s("p",null,[s("a",U,[G,a(n)]),e(" 用于配置默认的语言版本，如 配置 python 的默认版本为 3.7，则添加：")]),H,s("p",null,[s("a",J,[K,a(n)]),e(" 默认为所有 stages。暂时没搞懂这个参数干啥的，似乎挺少人配置它。样例：")]),P,s("p",null,[s("a",Q,[W,a(n)]),e(" 默认为 false，如果设置为 true 的话， pre-commit 会在第一次 hood 失败后马上终止。")]),X,s("p",null,[s("a",Y,[Z,a(n)]),e(" 默认为 "),ss,e(" ，最小 pre-commit 版本要求。")]),es])}const is=o(d,[["render",ns],["__file","笔记precommit-md.html.vue"]]);export{is as default};
