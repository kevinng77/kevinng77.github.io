import{_ as o,Q as i,V as p,Z as e,a2 as n,Y as a,a1 as l,aQ as t,H as c}from"./framework-6f4ef33f.js";const d={},r=t('<h1 id="poetry" tabindex="-1"><a class="header-anchor" href="#poetry" aria-hidden="true">#</a> Poetry</h1><p>Poetry replaces <code>setup.py</code>, <code>requirements.txt</code>, <code>setup.cfg</code>, <code>MANIFEST.in</code> and <code>Pipfile</code> with a simple <code>pyproject.toml</code> based project format.</p>',2),u={href:"https://github.com/python-poetry/poetry",target:"_blank",rel:"noopener noreferrer"},v={href:"https://python-poetry.org/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://zhuanlan.zhihu.com/p/448879082",target:"_blank",rel:"noopener noreferrer"},k=e("h2",{id:"快速上手",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#快速上手","aria-hidden":"true"},"#"),n(" 快速上手")],-1),b=e("h3",{id:"安装",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#安装","aria-hidden":"true"},"#"),n(" 安装")],-1),h={href:"https://python-poetry.org/docs/#installing-with-the-official-installer",target:"_blank",rel:"noopener noreferrer"},y=t(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://install.python-poetry.org <span class="token operator">|</span> python3 -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>清理缓存：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry cache <span class="token function">clear</span> pypi <span class="token parameter variable">--all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="基本用法" tabindex="-1"><a class="header-anchor" href="#基本用法" aria-hidden="true">#</a> 基本用法</h3><p>初始化项目</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>poetry 基本项目架构如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>poetry-demo
├── pyproject.toml
├── README.md
├── poetry_demo
│   └── __init__.py
└── tests
    └── __init__.py
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 <code>pyproject.toml</code> 在 <code>poetry init</code> 是会被创建，用于记录项目的依赖，如。</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">tool.poetry</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;myproject&quot;</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1.0&quot;</span>
<span class="token key property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;kevinng77 &lt;417333277@qq.com&gt;&quot;</span><span class="token punctuation">]</span>
<span class="token key property">readme</span> <span class="token punctuation">=</span> <span class="token string">&quot;README.md&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">tool.poetry.dependencies</span><span class="token punctuation">]</span>
<span class="token key property">python</span> <span class="token punctuation">=</span> <span class="token string">&quot;^3.8&quot;</span>


<span class="token punctuation">[</span><span class="token table class-name">build-system</span><span class="token punctuation">]</span>
<span class="token key property">requires</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;poetry-core&quot;</span><span class="token punctuation">]</span>
<span class="token key property">build-backend</span> <span class="token punctuation">=</span> <span class="token string">&quot;poetry.core.masonry.api&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">tool.poetry.source</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;tsinghua-pypi&quot;</span>
<span class="token key property">url</span> <span class="token punctuation">=</span> <span class="token string">&quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</span>
<span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p><strong>为了方便包下载，我们需要修改下 pip 源。</strong></p></div><p>可以类似 <code>pip install -r requirments.txt</code> 批量安装依赖：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>poetry install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加依赖：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> poetry add pendulum
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>执行后会生成 <code>poetry.lock</code> ， 他同样可以用来进行环境版本控制，但通常在开发时，我们会更倾向于使用 <code>pyproject.toml</code> 。</p><p>同步依赖（把当前的 python 包环境与 <code>poetry.lock</code> 中的同步）：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry <span class="token function">install</span> <span class="token parameter variable">--sync</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当你安装了新的 python 包时，可以手动更新 <code>poetry.lock</code> 文件：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>删除不想要的依赖：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry remove pendulum
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>把所有的 python 包锁定版本，By default, this will lock all dependencies to the latest available compatible versions.：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry lock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,24),g={href:"https://python-poetry.org/docs/pre-commit-hooks/#poetry-lock",target:"_blank",rel:"noopener noreferrer"},_=t(`<p>最后环境可以导出成 <code>requirements.txt</code> :</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry <span class="token builtin class-name">export</span> <span class="token parameter variable">-f</span> requirements.txt <span class="token parameter variable">--output</span> requirements.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="依赖控制" tabindex="-1"><a class="header-anchor" href="#依赖控制" aria-hidden="true">#</a> 依赖控制</h3><p>可以在 <code>[tool.poetry.dependencies]</code> 中和 <code>requirments.txt</code> 一样指定包版本：<code>numpy = &quot;^1.19.2&quot;</code></p><p>或针对不同的 python 版本，指定不同的包版本：</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">tool.poetry.dependencies.numpy</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;&gt;=1.19.2,&lt;1.22.0&quot;</span>
<span class="token key property">python</span> <span class="token punctuation">=</span> <span class="token string">&quot;~=3.7.0&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">tool.poetry.dependencies.numpy</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;&gt;=1.19.2,&lt;1.24.0&quot;</span>
<span class="token key property">python</span> <span class="token punctuation">=</span> <span class="token string">&quot;&gt;=3.8,&lt;3.11&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="虚拟环境" tabindex="-1"><a class="header-anchor" href="#虚拟环境" aria-hidden="true">#</a> 虚拟环境</h3><p>默认情况下，poetry 会在 <code>{cache-dir}/virtualenvs</code> 下面创建虚拟环境。激活虚拟环境可以直接对 <code>{cache-dir}/virtualenvs</code> 下面的 <code>your_env/bin/activate</code> 进行执行。</p><p>推荐在拥有 <code>pyproject.toml</code> 文件的目录下使用 <code>poetry shell</code> 自动激活对应 python 环境。</p><p>运行 python 文件是，官方提到了使用 <code>poetry run python xxx.py</code> 执行。不确定这样做与在虚拟环境中直接执行脚本有啥区别。</p><h3 id="构建包" tabindex="-1"><a class="header-anchor" href="#构建包" aria-hidden="true">#</a> 构建包</h3><p>在构建之前需要满足以下项目架构：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── README.md
├── kk                <span class="token comment"># 改文件夹名称</span>
│   ├── __init__.py
│   └── __main__.py   <span class="token comment"># 可选</span>
├── poetry.lock
└── pyproject.toml

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同时你的 <code>toml</code> 文件要定义一个可运行脚本：</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">tool.poetry</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;kk&quot;</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1.0&quot;</span>
<span class="token key property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;kevinng77 &lt;417333277@qq.com&gt;&quot;</span><span class="token punctuation">]</span>
<span class="token key property">readme</span> <span class="token punctuation">=</span> <span class="token string">&quot;README.md&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">tool.poetry.scripts</span><span class="token punctuation">]</span>
<span class="token key property">mk</span> <span class="token punctuation">=</span> <span class="token string">&quot;kk:kevin&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 scripts 的格式为 <code>cli_script = &quot;{package_name}:{function_name}&quot;</code>。比如以上写的 <code>mk = &quot;kk:kevin&quot;</code>。在 <code>build</code> 好之后，终端运行 <code>mk</code> 相当于直接运行了 <code>kk</code> 模块下面的 <code>kevin()</code> 函数。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>此处的 package_name 最好和 <code>[tool.poetry]</code> 中的 <code>name</code> 相同。同时，在 kk 文件夹下面所有的 python import 导入都已跟目录作为路径。如你想要导入 kk 文件夹下 main.py 中的 <code>kevin()</code> 函数，就使用 <code>from kk.main import kevin</code></p></div><p>准备好之后进行构建：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>构建好之后 install：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>poetry install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后在终端运行 <code>mk</code> 就能看到 <code>kevin()</code> 函数的运行结果了。</p><p>构建好了之后可以用</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>poetry publish
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>来推送到 pypi</p>`,25);function q(x,f){const s=c("ExternalLinkIcon");return i(),p("div",null,[r,e("p",null,[n("官方链接 "),e("a",u,[n("github"),a(s)]),n(),e("a",v,[n("官网"),a(s)])]),l("more"),e("p",null,[n("其他参考： "),e("a",m,[n("知乎笔记"),a(s)])]),k,b,e("p",null,[n("根据 "),e("a",h,[n("官方提示"),a(s)]),n(" 进行安装")]),y,e("p",null,[n("这个功能可以在 "),e("a",g,[n("pre-commit hooks"),a(s)]),n(" 当中使用。")]),_])}const j=o(d,[["render",q],["__file","笔记poetry.html.vue"]]);export{j as default};
