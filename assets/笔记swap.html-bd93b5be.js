import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as l,f as n}from"./app-4b8f98a4.js";const e="/assets/img/swap/image-20230618215236213.png",o={},p=n(`<p>通常转换大模型时，会出现系统内存不够用的情况，除了购买额外的内存条之外，还可以使用 swap 来暂时提高内存空间。但 swap 占用硬盘空间，并且硬盘读写速度远不如内存，因此还是要谨慎使用。</p><h2 id="扩大-swap-空间" tabindex="-1"><a class="header-anchor" href="#扩大-swap-空间" aria-hidden="true">#</a> 扩大 swap 空间</h2><ol><li>查看内存使用情况：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">free</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>查看 swap 使用情况：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">swapon</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--show</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">      </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">USED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PRIO</span></span>
<span class="line"><span style="color:#6F42C1;">/swapfile</span><span style="color:#24292E;"> </span><span style="color:#032F62;">file</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">G</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">B</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">-2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>如果要提升 swap 的空间，首先关闭 swap：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">swapoff</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/swapfile</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>分配空间给 swapfile：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">fallocate</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">50</span><span style="color:#032F62;">G</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/swapfile</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>配置并开启 swap：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mkswap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/swapfile</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">swapon</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/swapfile</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="重新配置-swap-空间" tabindex="-1"><a class="header-anchor" href="#重新配置-swap-空间" aria-hidden="true">#</a> 重新配置 swap 空间</h2><p>如果要减小 swap 空间的话，只能删除 swap 文件，然后重新添加 swapfile：</p><ol><li>停用 swap</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">swapoff</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/swapfile</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>移除 swapfile，可以通过 <code>swapon --show</code> 来查看 swap 文件位置。</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/swapfile</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>配置新的 swapfile，其中 <code>bs=2G</code> 表示需要申请的 swapfile 大小为 2G.</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">if=/dev/zero</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of=/swapfile</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bs=</span><span style="color:#005CC5;">2</span><span style="color:#032F62;">G</span><span style="color:#24292E;"> </span><span style="color:#032F62;">count=</span><span style="color:#005CC5;">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>启动 swap，并设置 swapfile 权限</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">sudo mkswap /swapfile</span></span>
<span class="line"><span style="color:#24292e;">sudo chmod 0600 /swapfile</span></span>
<span class="line"><span style="color:#24292e;">sudo swapon /swapfile</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>使用 <code>swapon --show</code> 查看是否修改成功情况，而后检查 <code>/etc/fstab</code> 文件。</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">cat /etc/fstab</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+e+`" alt="image-20230618215236213" tabindex="0" loading="lazy"><figcaption>image-20230618215236213</figcaption></figure><p>检查 <code>/etc/fstab</code> 文件最后是否有一行 <code>swapfile none swap sw 0 0</code>。如果没有的话，添加上去</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">vim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/fstab</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">swapfile none swap sw 0 0</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,29),i=[p];function c(t,r){return a(),l("div",null,i)}const y=s(o,[["render",c],["__file","笔记swap.html.vue"]]);export{y as default};
