import{_ as a,S as s,W as e,aS as n}from"./framework-d5c0d2cb.js";const i="/assets/img/swap/image-20230618215236213.png",l={},d=n(`<p>通常转换大模型时，会出现系统内存不够用的情况，除了购买额外的内存条之外，还可以使用 swap 来暂时提高内存空间。但 swap 占用硬盘空间，并且硬盘读写速度远不如内存，因此还是要谨慎使用。</p><h2 id="扩大-swap-空间" tabindex="-1"><a class="header-anchor" href="#扩大-swap-空间" aria-hidden="true">#</a> 扩大 swap 空间</h2><ol><li>查看内存使用情况：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">free</span> <span class="token parameter variable">-h</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>查看 swap 使用情况：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">swapon</span> <span class="token parameter variable">--show</span>
NAME      TYPE SIZE USED PRIO
/swapfile <span class="token function">file</span>   2G   0B   <span class="token parameter variable">-2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>如果要提升 swap 的空间，首先关闭 swap：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> swapoff /swapfile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>分配空间给 swapfile：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> fallocate <span class="token parameter variable">-l</span> 50G /swapfile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>配置并开启 swap：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkswap</span> /swapfile
<span class="token function">sudo</span> <span class="token function">swapon</span> /swapfile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="重新配置-swap-空间" tabindex="-1"><a class="header-anchor" href="#重新配置-swap-空间" aria-hidden="true">#</a> 重新配置 swap 空间</h2><p>如果要减小 swap 空间的话，只能删除 swap 文件，然后重新添加 swapfile：</p><ol><li>停用 swap</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> swapoff /swapfile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>移除 swapfile，可以通过 <code>swapon --show</code> 来查看 swap 文件位置。</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">rm</span> /swapfile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>配置新的 swapfile，其中 <code>bs=2G</code> 表示需要申请的 swapfile 大小为 2G.</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/swapfile <span class="token assign-left variable">bs</span><span class="token operator">=</span>2G <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>启动 swap，并设置 swapfile 权限</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo mkswap /swapfile
sudo chmod 0600 /swapfile
sudo swapon /swapfile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>使用 <code>swapon --show</code> 查看是否修改成功情况，而后检查 <code>/etc/fstab</code> 文件。</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cat /etc/fstab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+i+`" alt="image-20230618215236213" tabindex="0" loading="lazy"><figcaption>image-20230618215236213</figcaption></figure><p>检查 <code>/etc/fstab</code> 文件最后是否有一行 <code>swapfile none swap sw 0 0</code>。如果没有的话，添加上去</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/fstab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>swapfile none swap sw 0 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,29),o=[d];function t(c,p){return s(),e("div",null,o)}const u=a(l,[["render",t],["__file","笔记swap.html.vue"]]);export{u as default};
