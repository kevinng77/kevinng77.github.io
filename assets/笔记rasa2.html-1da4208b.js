import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as p,c as t,a as n,b as s,d as c,f as a}from"./app-a26e9423.js";const i={},r=a(`<p>RASA 感觉像是时代的眼泪了，自动 LLM 火了之后，类似 RASA 一类的传统 NLP 对话架构变得冷门，不少技术似乎也被摒弃。但如今不少厂家在实现对话机器人、智能服务等应用时，却也会用到这类型的框架。市面上提供类似 RASA 服务的 low code 平台也不少，如 Nuance, Omilia, Kore.ai 等。</p><p>该系列文章主要围绕 RASA 源码，整理落地部署 RASA 类似系统的一些笔记。</p><p>本文围绕 RASA 的源码架构，针对 RASA 自定义部署方式，RASA 代码拆解功能展开。</p><p>参考代码：</p><p>https://github.com/kevinng77/rasa_example/tree/master/examples/4_unpack_rasa</p><h3 id="安装环境" tabindex="-1"><a class="header-anchor" href="#安装环境" aria-hidden="true">#</a> 安装环境</h3><p>RASA 采用 poetry 进行包管理，可以直接 <code>poetry install</code> 来安装对应依赖。如果没有 poetry 的话，就：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">pip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;"> </span><span style="color:#032F62;">requirements.txt</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>默认情况下官方推荐使用 <code>rasa run</code> 启动 nlu 以及 action 模块。</p><p>Entrypoint 对应的主函数在 <code>rasa/__main__.py</code> 中，因此我们以模块的方式运行它就行了。这也是 poetry 中触发 rasa 的方法。至于如何用 rasa 直接开启服务，可以查看 poetry python 包管理工具。</p><p>执行 <code>rasa train</code> 等价于 <code>python -m rasa train</code>；<code>rasa run actions</code> 相当于 <code>python -m rasa run actions</code>。</p><p>因此，如果我们只希望用到 rasa 当中的某个模块而非整个 rasa 模块，就可以避开其复杂的 sanic router，采用传统 python 的方式运行其中对应的函数了。</p><h2 id="自定义-channel" tabindex="-1"><a class="header-anchor" href="#自定义-channel" aria-hidden="true">#</a> 自定义 Channel</h2><p>https://github.com/kevinng77/rasa_example/tree/master/examples/5_custom_channel</p><p>自定义 channel 可以用于修改和用户交互的方式，或进行一些输出预处理等。比如开源的 RASA 并不支持语音功能，那么我们可以在自定义 Channel 当中加入 ASR 和 TTS 模块实现语音文字转换。</p><p>首先需要自定义 Input channel 模块，重写 <code>blueprint</code> 等模块，代码请参考</p><p>https://github.com/kevinng77/rasa_example/blob/master/examples/5_custom_channel/mychannel/myrest.py#L22</p>`,17),d=n("code",null,"sent_text_message",-1),y=n("code",null,"sent_image_url",-1),u={href:"https://github.com/kevinng77/rasa_example/blob/master/examples/5_custom_channel/mychannel/myrest.py#L196",target:"_blank",rel:"noopener noreferrer"},v=a(`<p>https://github.com/kevinng77/rasa_example/blob/master/examples/5_custom_channel/mychannel/myrest.py#L196</p><p>最后在 <code>credentials.yml</code> 中配置使用我们定义的 Channel：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">mychannel.myrest.RestInput</span><span style="color:#24292E;">:</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>配置完成后启动整个 rasa 服务：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">rasa train</span></span>
<span class="line"><span style="color:#24292E;">rasa run actions </span><span style="color:#D73A49;">&amp;</span></span>
<span class="line"><span style="color:#24292E;">rasa run </span><span style="color:#B31D28;font-style:italic;">--</span><span style="color:#24292E;">enable</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">api</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>打开一个新的终端 B 输入：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">curl -X POST http://localhost:5005/webhooks/rest/mywebhook \\</span></span>
<span class="line"><span style="color:#24292e;">-H &quot;Content-Type: application/json&quot; \\</span></span>
<span class="line"><span style="color:#24292e;">-d &#39;{  &quot;sender&quot;: &quot;change_to_your_name&quot;,   &quot;message&quot;: &quot;Find me some good venues&quot;}&#39; </span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你会在终端 A 中看到：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">This is a custom webhook made by me.</span></span>
<span class="line"><span style="color:#24292e;">&gt;&gt;&gt; you could see the following information: sender_id change_to_your_name,</span></span>
<span class="line"><span style="color:#24292e;"> text Find me some good venues</span></span>
<span class="line"><span style="color:#24292e;">&gt;&gt;&gt; the custom channel is used for custom front-end interaction, if you want to save</span></span>
<span class="line"><span style="color:#24292e;">middleware information, please use custom trackerstore, see next example</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们主要将 channel 自定义在了 <code>mychannel</code> 中，并在 <code>RestInput.blueprint()</code> 中修改了 app 的 router。</p><h3 id="webui" tabindex="-1"><a class="header-anchor" href="#webui" aria-hidden="true">#</a> WebUI</h3><p>对于使用 RASA 搭建 WebUI，可以考虑使用 widget + socket IO 的方式实现。</p><p>https://github.com/kevinng77/rasa_example/tree/master/examples/8_wedget</p><ol><li>在 credentials 中添加设置 socketio 通道:</li></ol><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">socketio</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">user_message_evt</span><span style="color:#24292E;">: </span><span style="color:#032F62;">user_uttered</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">bot_message_evt</span><span style="color:#24292E;">: </span><span style="color:#032F62;">bot_uttered</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">session_persistence</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>启动 RASA 服务</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">rasa</span><span style="color:#24292E;"> </span><span style="color:#032F62;">train</span></span>
<span class="line"><span style="color:#6F42C1;">rasa</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">actions</span><span style="color:#24292E;"> &amp;</span></span>
<span class="line"><span style="color:#6F42C1;">rasa</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--enable-api</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cors</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;*&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在任意 HTML 文件中添加（记得修改你的 websocket 为 <code>http://&lt;ip&gt;:&lt;port&gt;/socket.io</code>）:</li></ol><div class="language-html line-numbers-mode" data-ext="html"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;rasa-chat-widget&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">data-websocket-url</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;http://40.76.242.139:5005/socket.io&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">src</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;https://unpkg.com/@rasahq/rasa-chat&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;application/javascript&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>而后打开该网页，就能看到 UI 右下角的对话框了。</p><h2 id="配置-redis-储存" tabindex="-1"><a class="header-anchor" href="#配置-redis-储存" aria-hidden="true">#</a> 配置 Redis 储存</h2><p>使用 redis tracker store 记录 session 还有 tracker。</p><p>https://github.com/kevinng77/rasa_example/tree/master/examples/6_redis_store</p><p>配置 redis 需要同时开启 rasa 和 redis 服务，为了方便 debug 及查看 redis 中的数据，我们同时部署 redis 和 redisinsight，编写以下 docker compose 文件：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">version</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;3.0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">services</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">redis</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">redis</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">redis</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">127.0.0.1:6379:6379</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">$PWD/redis_data:/data</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">$PWD/myredis.conf:/etc/redis/redis.conf</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">redis-server --save 60 1 --requirepass 777777</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">redisinsight</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">redislabs/redisinsight</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">redisinsight</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">network_mode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;host&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而后启动服务 <code>docker compose up -d</code></p><p>我们在 <code>endpoints.yml</code> 中配置好应用 redis 的一些参数:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">rest</span><span style="color:#24292E;">:</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>而后启动服务：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">rasa</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">actions</span><span style="color:#24292E;"> &amp;</span></span>
<span class="line"><span style="color:#6F42C1;">rasa</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--enable-api</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>打开新终端尝试发送一个 POST 到服务器：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:5005/webhooks/rest/webhook</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-H </span><span style="color:#032F62;">&quot;Content-Type: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-d </span><span style="color:#032F62;">&#39;{  &quot;sender&quot;: &quot;change_to&quot;,   &quot;message&quot;: &quot;Find me some good venues&quot;}&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行发送后，rasa 在处理上面这个请求时，会将 tracker 记录在 redis 中。我们打开 <code>your_ip:8001</code> 查看，如下填写，其中密码是 777777：</p><figure><img src="https://pic2.zhimg.com/80/v2-072028dcd5bbc1a80429c67e9f71684d_1440w.webp" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>在 browser 中我们可以查看到 redis 数据库中的记录：</p><figure><img src="https://pic4.zhimg.com/80/v2-a1363bfce70bbbfd31cb7393b7a68fa3_1440w.webp" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>完整的 session 数据：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;events&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;">// 此处省略一些 session 内容</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;event&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;timestamp&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1679306228.4886646</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;metadata&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;model_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e1105180adce4701ac369a4b0ef90c8b&quot;</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;text&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Find me some good venues&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;parse_data&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;intent&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;search_venues&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">&quot;confidence&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.9929251670837402</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;entities&quot;</span><span style="color:#24292E;">: [],</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;text&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Find me some good venues&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;message_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e75148a4a0ad4f8cb1168d716ea43479&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;metadata&quot;</span><span style="color:#24292E;">: {},</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;text_tokens&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">          [ </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> ],</span></span>
<span class="line"><span style="color:#24292E;">          [ </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> ],</span></span>
<span class="line"><span style="color:#24292E;">          [ </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        ],</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;intent_ranking&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">          {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;greet&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">&quot;confidence&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.00012646465620491654</span></span>
<span class="line"><span style="color:#24292E;">          },</span></span>
<span class="line"><span style="color:#24292E;">          {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;thankyou&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">&quot;confidence&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1.6760051948949695e-05</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        ]</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;input_channel&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;rest&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;message_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e75148a4a0ad4f8cb1168d716ea43479&quot;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;event&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;user_featurization&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;timestamp&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1679306228.5121474</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;metadata&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;model_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e1105180adce4701ac369a4b0ef90c8b&quot;</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;use_text_for_featurization&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;event&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;timestamp&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1679306228.5121644</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;metadata&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;model_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e1105180adce4701ac369a4b0ef90c8b&quot;</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;action_search_venues&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;policy&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;MemoizationPolicy&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;confidence&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;action_text&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;hide_rule_turn&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;event&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;bot&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;timestamp&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1679306228.5122068</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;metadata&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;model_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e1105180adce4701ac369a4b0ef90c8b&quot;</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;text&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;here are some venues I found&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;data&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;elements&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;quick_replies&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;buttons&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;attachment&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;image&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;custom&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;event&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;slot&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;timestamp&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1679306228.5122104</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;metadata&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;model_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e1105180adce4701ac369a4b0ef90c8b&quot;</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;venues&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;value&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">        {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Big Arena&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">&quot;reviews&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">4.5</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Rock Cellar&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">&quot;reviews&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5.0</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">      ]</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;event&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;timestamp&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1679306228.516813</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;metadata&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;model_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;e1105180adce4701ac369a4b0ef90c8b&quot;</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;action_listen&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;policy&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;MemoizationPolicy&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;confidence&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;action_text&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;hide_rule_turn&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;change_to&quot;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中比较重要的包括：<code>intent_ranking</code> ，entity 等数据都有。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h2><ol><li><p>RASA 采用 sanic 搭建 API 服务，NLU 和 Dialog 模块分别由两个 API 服务组成（Kore.ai, Nuance 等平台也是采用该方案）。</p></li><li><p>RASA 中对轮对话方案是通过将用户历史的 intent, message, slot 等储存在服务器中实现的。（用户只想后端发送 message 和 session_id）。可以参考目前大多数 GPT 客户端多轮对话的方案，将历史对话信息储存在用户客户端的 Session Storage 或者 Local Storage 中，来环节本地储存的压力。</p></li><li><p>RASA 免费版支持的 Channel 较少，我们可以自定义 Channel 实现语音对话等功能。对于 Web UI 搭建的话，RASA 提供的 Widget 还是挺不错的。</p></li></ol>`,41);function m(E,b){const l=o("ExternalLinkIcon");return p(),t("div",null,[r,n("p",null,[s("而后根据需求对 Output Channel 的 "),d,s(", "),y,s("也进行重写，"),n("a",u,[s("示例代码"),c(l)]),s("。")]),v])}const h=e(i,[["render",m],["__file","笔记rasa2.html.vue"]]);export{h as default};
