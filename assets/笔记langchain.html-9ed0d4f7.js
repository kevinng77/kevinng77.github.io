import{_ as o,P as p,U as c,Y as n,a1 as s,X as t,aQ as e,E as i}from"./framework-6cee4965.js";const l={},u=n("h1",{id:"langchain",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#langchain","aria-hidden":"true"},"#"),s(" LangChain")],-1),r=n("p",null,"link: https://github.com/hwchase17/langchain",-1),d=n("p",null,"langchain 算是工程类的仓库，大模型应用的框架，提供了大模型和个人数据交互的框架，目前很多应用都有着和 langchain 非常相似的架构和目的，如 LLAMA INDEX，haystack， semantic-kernel 等。",-1),k={href:"https://python.langchain.com/en/latest/use_cases/personal_assistants.html",target:"_blank",rel:"noopener noreferrer"},m={href:"https://python.langchain.com/en/latest/use_cases/question_answering.html",target:"_blank",rel:"noopener noreferrer"},v=e(`<p>主要特点在于：</p><ul><li>支持异构数据输入</li><li>提供了各种 Plugin 的实现方案</li><li>支持除文本回复之外的反馈操作，如执行代码等。</li></ul><div class="hint-container warning"><p class="hint-container-title">注意</p><p>由于 LangChain 在快速更新截断，因此文中的示例代码，可能与源码存在差异。但大致上，框架的逻辑思路是相同的。</p></div><h2 id="源码框架梳理" tabindex="-1"><a class="header-anchor" href="#源码框架梳理" aria-hidden="true">#</a> 源码框架梳理</h2><h3 id="models" tabindex="-1"><a class="header-anchor" href="#models" aria-hidden="true">#</a> Models</h3><p>LangChain 中的模型相关代码较少，大部分主要是调用外部资源，如 OPENAI 或者 Huggingface 等模型/API。Model 模块下提供了 <code>llms</code>, <code>cache</code>, <code>embeddings</code> 等子模块。</p><h4 id="llms" tabindex="-1"><a class="header-anchor" href="#llms" aria-hidden="true">#</a> llms</h4><p>llms 用于输入 input 文本，输出文本回复。该模块保存了各种 llm 接口。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain <span class="token keyword">import</span> HuggingFacePipeline

llm <span class="token operator">=</span> HuggingFacePipeline<span class="token punctuation">.</span>from_model_id<span class="token punctuation">(</span>model_id<span class="token operator">=</span><span class="token string">&quot;bigscience/bloom-1b7&quot;</span><span class="token punctuation">,</span> task<span class="token operator">=</span><span class="token string">&quot;text-generation&quot;</span><span class="token punctuation">,</span> model_kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;max_length&quot;</span><span class="token punctuation">:</span><span class="token number">64</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>llm<span class="token punctuation">(</span><span class="token string">&quot;Hello, what is apple?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>在 langchain 中自定义 LLM 的话，只需要重写 <code>_call()</code> 方法即可。使其接受一个字符串，输出一个字符串</p></div><h4 id="cache" tabindex="-1"><a class="header-anchor" href="#cache" aria-hidden="true">#</a> cache</h4><p>当用户对相同的问题进行提问时，如果配置了 cache 的话，回复会更快。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> Redis
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>cache <span class="token keyword">import</span> RedisCache

langchain<span class="token punctuation">.</span>llm_cache <span class="token operator">=</span> RedisCache<span class="token punctuation">(</span>redis_<span class="token operator">=</span>Redis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="embeddings" tabindex="-1"><a class="header-anchor" href="#embeddings" aria-hidden="true">#</a> embeddings</h4><p><code>embeddings</code> 输入文本，输出对应的 embedding。主要用于编码本地数据以及用户 query，以方便检索。langchain 整合了部分开箱即用的 embedding 服务，包括比较流行的 sentance Transformer 库：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>embeddings <span class="token keyword">import</span> HuggingFaceEmbeddings<span class="token punctuation">,</span> SentenceTransformerEmbeddings 
embeddings <span class="token operator">=</span> HuggingFaceEmbeddings<span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">&quot;all-MiniLM-L6-v2&quot;</span><span class="token punctuation">)</span>
query_result <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>embed_query<span class="token punctuation">(</span><span class="token string">&quot;your text input&quot;</span><span class="token punctuation">)</span>
doc_result <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>embed_documents<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;text input1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text input2.&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="自定义-embedding" tabindex="-1"><a class="header-anchor" href="#自定义-embedding" aria-hidden="true">#</a> 自定义 Embedding</h5><p>如果需要使用自定义的模型进行编码的话，仅需重写 <code>embed_documents</code>， <code>embed_query</code> 两个方法即可</p><p>如 <code>embeddings.huggingface</code> 下的 <code>HuggingFaceEmbeddings</code>，使用 <code>sentence_transformers</code> 对文本进行编码，那么 <code>embed_documents</code>， <code>embed_query</code> 的实现方式为：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#   self.client = sentence_transformers.SentenceTransformer(self.model_name)</span>

<span class="token keyword">def</span> <span class="token function">embed_documents</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    texts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;\\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> texts<span class="token punctuation">)</span><span class="token punctuation">)</span>
    embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
    <span class="token keyword">return</span> embeddings<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">embed_query</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    text <span class="token operator">=</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;\\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
    embedding <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> embedding<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="indexes-和-数据库" tabindex="-1"><a class="header-anchor" href="#indexes-和-数据库" aria-hidden="true">#</a> Indexes 和 数据库</h3><p>Langchain 提供好了 <code>index</code>, <code>document_store</code> 等模块，能够方便地进行数据库管理、异构数据处理、数据读写等操作。Indexes 主要用于数据检索。</p><h4 id="document-loaders" tabindex="-1"><a class="header-anchor" href="#document-loaders" aria-hidden="true">#</a> document_loaders</h4><p><code>document_loaders</code> 主要用于管理数据库元数据。提供了读写文件时候必要的方法，包括文件地址，文件读取方式，文件分段方式等。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>document_loaders <span class="token keyword">import</span> TextLoader
loader <span class="token operator">=</span> TextLoader<span class="token punctuation">(</span><span class="token string">&#39;./mydoc.txt&#39;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如上创建 loader 之后，loader 中储存了 <code>loader.file_path = &quot;./mydoc.txt&quot;</code> 等元数据。</p><h4 id="text-splitter" tabindex="-1"><a class="header-anchor" href="#text-splitter" aria-hidden="true">#</a> text splitter</h4><p>通常，我们需要对一整篇文章进行分段，才能方便我们对段落进行检索。langchain 提供了部分 splitter，可以针对 markdown，pdf 等进行分段。分段后的文章，会被储存成 <code>Document</code> 数据格式。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>markdown_splitter <span class="token operator">=</span> MarkdownTextSplitter<span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> chunk_overlap<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

mymdstr <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;### this is md content&quot;&quot;&quot;</span>
<span class="token comment">## 可以使用 create_documents 从字符串列表直接获得 List[Documents]</span>
docs <span class="token operator">=</span> markdown_splitter<span class="token punctuation">.</span>create_documents<span class="token punctuation">(</span><span class="token punctuation">[</span>mymdstr<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">## 也可以使用 split_documents() 为现有的 Documents 进行二次细分</span>
docs <span class="token operator">=</span> markdown_splitter<span class="token punctuation">.</span>split_documents<span class="token punctuation">(</span>documents<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如上代码， <code>docs</code> 为 <code>List[Document]</code></p><h4 id="vectorstores" tabindex="-1"><a class="header-anchor" href="#vectorstores" aria-hidden="true">#</a> vectorstores</h4><p><code>vectorstores</code> 用于储存文档、数据及其对应 embedding 等信息的引擎。</p><p>比如，要将文档与对应的 embedding 储存与 ElasticSearch 当中，可以参考 <code>elastic_vector_search.py</code> 中的内容。几个比较常见的数据库以及 NLP 检索框架在 langchain 中都写好了对应的 vectorstores， 如 <code>redis</code>, <code>faiss</code>, <code>elasticsearch</code> 等。以下为使用 <code>FAISS</code> 进行相似文档检索的操作：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>vectorstores <span class="token keyword">import</span> FAISS

<span class="token comment"># 可以更换自定义 Embedding</span>
embeddings <span class="token operator">=</span> HuggingFaceEmbeddings<span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">&quot;all-MiniLM-L6-v2&quot;</span><span class="token punctuation">)</span>

db <span class="token operator">=</span> FAISS<span class="token punctuation">.</span>from_documents<span class="token punctuation">(</span>docs<span class="token punctuation">,</span> embeddings<span class="token punctuation">)</span>
query <span class="token operator">=</span> <span class="token string">&quot;What did the president say about Ketanji Brown Jackson&quot;</span>
similar_docs <span class="token operator">=</span> db<span class="token punctuation">.</span>similarity_search<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要支持其他数据库的话，可以自定义 vectorstore 类。自定义的话需要继承 <code>base.VectorStore</code>，而后重写下面几个主要的功能函数即可：</p><ol><li><code>add_texts</code>, <code>from_texts</code>：往数据库中添加数据的一些操作</li><li><code>similarity_search</code>：从数据库中检索本文的一些操作。该操作自定义程度搞，如对于 <code>elastic search</code>， 可以将 <code>retrievers</code> 下的 <code>elastic_search_bm25</code> 召回，以及 <code>elastic_vector_search</code> 的精排结合使用，以进行性能调优。</li></ol><p>自定义 vectorstores 可以考虑参考 <code>vectorstores.redis</code> ，使用另个一类 <code>RedisVectorStoreRetriever</code>来负责数据的检索。</p><h3 id="chains" tabindex="-1"><a class="header-anchor" href="#chains" aria-hidden="true">#</a> chains</h3><p>Chain 的作用相当于 pipeline，主要将多个 LLM 模块和程序处理环节进行拼接，将复杂任务成应用。有点像 transformers 中的 pipeline。以下是基础的 LLMChain 示例：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>chains <span class="token keyword">import</span> LLMChain
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate

prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">(</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;thing&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    template<span class="token operator">=</span><span class="token string">&quot;Hello, what is {thing}?&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
mychain <span class="token operator">=</span> LLMChain<span class="token punctuation">(</span>llm<span class="token operator">=</span>llm<span class="token punctuation">,</span> prompt<span class="token operator">=</span>prompt<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mychain<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;banana&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上示例对输入进行 <strong>模板填充</strong> ，而后进行 <strong>LLM 推理</strong> ，将答案整理并返回给用户。Chain 之间能够相互组合：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>chains <span class="token keyword">import</span> SimpleSequentialChain
overall_chain <span class="token operator">=</span> SimpleSequentialChain<span class="token punctuation">(</span>chains<span class="token operator">=</span><span class="token punctuation">[</span>chain<span class="token punctuation">,</span> chain_two<span class="token punctuation">]</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># Run the chain specifying only the input variable for the first chain.</span>
catchphrase <span class="token operator">=</span> overall_chain<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;colorful socks&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,42),h={href:"https://python.langchain.com/en/latest/modules/chains/how_to_guides.html",target:"_blank",rel:"noopener noreferrer"},b=n("code",null,"chains.__init__",-1),g=e(`<ol><li><code>ChatVectorDBChain</code>：从 vectorstore 检索和 query 最相近的 k 条文档；而后根据这些文档生成回复。</li><li><code>LLMBashChain</code>：先通过 <code>LLMChain</code> 对 query 生成回复，如果回复中包含了 \`\`\`\`bash\` 字样，则执行对应位置的代码。</li><li><code>LLMMathChain</code>：首先让 LLM 将需要数学计算的部分用 \`\`\`\`python\` 进行标注，而后通过 python 进行对应的数学计算返回结果。</li><li><code>SQLDatabaseChain</code>：先用 LLM 解析 query，输出 sql；用 sql database 执行 sql 语句，抽取回复 query 时需要用到的数据；根据检索的数据，将结果返回给用户。对于这种 chain，以下是一个可以参考的 prompt：</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;Given an input question, first create a syntactically correct {dialect} query to run, then look at the results of the query and return the answer. Unless the user specifies in his question a specific number of examples he wishes to obtain, always limit your query to at most {top_k} results. You can order the results by a relevant column to return the most interesting examples in the database.

Never query for all the columns from a specific table, only ask for a the few relevant columns given the question.

Pay attention to use only the column names that you can see in the schema description. Be careful to not query for columns that do not exist. Also, pay attention to which column is in which table.

Use the following format:

Question: &quot;Question here&quot;
SQLQuery: &quot;SQL Query to run&quot;
SQLResult: &quot;Result of the SQLQuery&quot;
Answer: &quot;Final answer here&quot;

Only use the tables listed below.

{table_info}

Question: {input}&quot;&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义 chain 需要重写下面三种方法：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>chains <span class="token keyword">import</span> LLMChain
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>chains<span class="token punctuation">.</span>base <span class="token keyword">import</span> Chain

<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> List

<span class="token keyword">class</span> <span class="token class-name">ConcatenateChain</span><span class="token punctuation">(</span>Chain<span class="token punctuation">)</span><span class="token punctuation">:</span>
    chain_1<span class="token punctuation">:</span> LLMChain
    chain_2<span class="token punctuation">:</span> LLMChain

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">input_keys</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># Union of the input keys of the two chains.</span>
        all_input_vars <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>chain_1<span class="token punctuation">.</span>input_keys<span class="token punctuation">)</span><span class="token punctuation">.</span>union<span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>chain_2<span class="token punctuation">.</span>input_keys<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span>all_input_vars<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">output_keys</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&#39;concat_output&#39;</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_call</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        output_1 <span class="token operator">=</span> self<span class="token punctuation">.</span>chain_1<span class="token punctuation">.</span>run<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
        output_2 <span class="token operator">=</span> self<span class="token punctuation">.</span>chain_2<span class="token punctuation">.</span>run<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&#39;concat_output&#39;</span><span class="token punctuation">:</span> output_1 <span class="token operator">+</span> output_2<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="agent" tabindex="-1"><a class="header-anchor" href="#agent" aria-hidden="true">#</a> Agent</h3><p>Agent 是 AI 的一个关键概念。Agent 能够根据不同的问题，决定要执行哪一个 chain。以下是一个基础 agent 的调用示例。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword">import</span> load_tools
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword">import</span> initialize_agent
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword">import</span> AgentType
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI

llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
tools <span class="token operator">=</span> load_tools<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;serpapi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;llm-math&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> llm<span class="token operator">=</span>llm<span class="token punctuation">)</span>
agent <span class="token operator">=</span> initialize_agent<span class="token punctuation">(</span>tools<span class="token punctuation">,</span> llm<span class="token punctuation">,</span> agent<span class="token operator">=</span>AgentType<span class="token punctuation">.</span>ZERO_SHOT_REACT_DESCRIPTION<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
agent<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;Who is Leo DiCaprio&#39;s girlfriend? What is her current age raised to the 0.43 power?&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下是上面这串代码执行后的结果：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;</span> Entering new AgentExecutor chain<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 I need to find out who Leo DiCaprio&#39;s girlfriend <span class="token keyword">is</span> <span class="token keyword">and</span> then calculate her age raised to the <span class="token number">0.43</span> power<span class="token punctuation">.</span>
Action<span class="token punctuation">:</span> Search
Action Input<span class="token punctuation">:</span> <span class="token string">&quot;Leo DiCaprio girlfriend&quot;</span>
Observation<span class="token punctuation">:</span> Camila Morrone
Thought<span class="token punctuation">:</span> I need to find out Camila Morrone&#39;s age
Action<span class="token punctuation">:</span> Search
Action Input<span class="token punctuation">:</span> <span class="token string">&quot;Camila Morrone age&quot;</span>
Observation<span class="token punctuation">:</span> <span class="token number">25</span> years
Thought<span class="token punctuation">:</span> I need to calculate <span class="token number">25</span> raised to the <span class="token number">0.43</span> power
Action<span class="token punctuation">:</span> Calculator
Action Input<span class="token punctuation">:</span> <span class="token number">25</span><span class="token operator">^</span><span class="token number">0.43</span>
Observation<span class="token punctuation">:</span> Answer<span class="token punctuation">:</span> <span class="token number">3.991298452658078</span>

Thought<span class="token punctuation">:</span> I now know the final answer
Final Answer<span class="token punctuation">:</span> Camila Morrone <span class="token keyword">is</span> Leo DiCaprio&#39;s girlfriend <span class="token keyword">and</span> her current age raised to the <span class="token number">0.43</span> power <span class="token keyword">is</span> <span class="token number">3.991298452658078</span><span class="token punctuation">.</span>

<span class="token operator">&gt;</span> Finished chain<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="agent-单元" tabindex="-1"><a class="header-anchor" href="#agent-单元" aria-hidden="true">#</a> Agent 单元</h4><p>一个 Agent 单元负责执行一次任务。如 langchain 中的 <code>langchain.agents.agent.Agent</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Agent</span><span class="token punctuation">(</span>BaseSingleActionAgent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    llm_chain<span class="token punctuation">:</span> LLMChain
    allowed_tools<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>agent 的执行功能在于 <code>Agent.plan()</code>：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">plan</span><span class="token punctuation">(</span>intermediate_steps<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Tuple<span class="token punctuation">[</span>AgentAction<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token punctuation">:</span>   
    <span class="token comment"># 将各种异构的历史信息转换成 inputs，传入到 LLM 当中</span>
    thoughts <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">for</span> action<span class="token punctuation">,</span> observation <span class="token keyword">in</span> intermediate_steps<span class="token punctuation">:</span>
            thoughts <span class="token operator">+=</span> action<span class="token punctuation">.</span>log
            thoughts <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f&quot;\\n</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>observation_prefix<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>observation<span class="token punctuation">}</span></span><span class="token string">\\n</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>llm_prefix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            
    full_input <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;agent_scratchpad&quot;</span><span class="token punctuation">:</span> thoughts<span class="token punctuation">,</span> <span class="token string">&quot;stop&quot;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_stop<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">}</span>  
    
    <span class="token comment"># 根据 LLM 生成的反馈，采取决策</span>
    <span class="token comment">## prompt template: &quot;your input xx {other prompt slot} xx, {agent_scratchpad}&quot;</span>
    <span class="token comment">## full_output: LLM 输出的回复，字符串形式</span>
    full_output <span class="token operator">=</span> self<span class="token punctuation">.</span>llm_chain<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token operator">**</span>full_inputs<span class="token punctuation">)</span>
    
    parsed_output <span class="token operator">=</span> self<span class="token punctuation">.</span>_extract_tool_and_input<span class="token punctuation">(</span>full_output<span class="token punctuation">)</span>
    <span class="token keyword">while</span> parsed_output <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        full_output <span class="token operator">=</span> self<span class="token punctuation">.</span>_fix_text<span class="token punctuation">(</span>full_output<span class="token punctuation">)</span>
        full_inputs<span class="token punctuation">[</span><span class="token string">&quot;agent_scratchpad&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> full_output
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>llm_chain<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token operator">**</span>full_inputs<span class="token punctuation">)</span>
        full_output <span class="token operator">+=</span> output
        parsed_output <span class="token operator">=</span> self<span class="token punctuation">.</span>_extract_tool_and_input<span class="token punctuation">(</span>full_output<span class="token punctuation">)</span>
        
    <span class="token comment"># 或者返回 AgentFinish({&quot;output&quot;: action.tool_input}, action.log)</span>
    <span class="token keyword">return</span> AgentAction<span class="token punctuation">(</span>
            tool<span class="token operator">=</span>parsed_output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tool_input<span class="token operator">=</span>parsed_output<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> log<span class="token operator">=</span>full_output
        <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于 Agent，能够从历史操作中获取信息，并根据目的做出决策是很重要的。对于 Langchain 的 Agent，我们解析他的 <code>.plan()</code> 方法：</p><p><code>.plan()</code> 的参数有 <code>intermediate_steps</code> 和 <code>**kwargs</code>，前者保存了 agent 之前做过的一些行为。后者通常会储存 agent 的目标，如用户提出的 query 等。</p><p><code>.plan()</code> 可以看做两步：</p><ol><li>将各种异构的历史信息转换成 inputs，传入到 LLM 当中；对于 Langchain，其做法就是简单的将 <code>intermediate_steps</code> 中的 action 日志和 <code>observation</code> 进行拼接，而后统一放在 <code>inputs</code> 后面。在 langchain 的 prompt template 当中，经常会看到 <code>agent_scratchpad</code> 的填充字段，它就是用来放历史信息的。</li><li>根据 LLM 生成的反馈，采取决策。LLM 生成的回复是 string 格式，我们会将回复出来的 <code>full_output</code> 在 <code>_extract_tool_and_input</code> 中进行处理。一个例子就是 <code>agents.mrkl.base.get_action_and_tool()</code>。</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_action_and_input</span><span class="token punctuation">(</span>llm_output<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Parse out the action and input from the LLM output.

    Note: if you&#39;re specifying a custom prompt for the ZeroShotAgent,
    you will need to ensure that it meets the following Regex requirements.
    The string starting with &quot;Action:&quot; and the following string starting
    with &quot;Action Input:&quot; should be separated by a newline.
    &quot;&quot;&quot;</span>
    <span class="token keyword">if</span> FINAL_ANSWER_ACTION <span class="token keyword">in</span> llm_output<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Final Answer&quot;</span><span class="token punctuation">,</span> llm_output<span class="token punctuation">.</span>split<span class="token punctuation">(</span>FINAL_ANSWER_ACTION<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># \\s matches against tab/newline/whitespace</span>
    regex <span class="token operator">=</span> <span class="token string">r&quot;Action: (.*?)[\\n]*Action Input:[\\s]*(.*)&quot;</span>
    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>regex<span class="token punctuation">,</span> llm_output<span class="token punctuation">,</span> re<span class="token punctuation">.</span>DOTALL<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Could not parse LLM output: \`</span><span class="token interpolation"><span class="token punctuation">{</span>llm_output<span class="token punctuation">}</span></span><span class="token string">\`&quot;</span></span><span class="token punctuation">)</span>
    action <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    action_input <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> action<span class="token punctuation">,</span> action_input<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">&#39;&quot;&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，langchain 中<code>ZeroShotAgent</code> 通过字符串匹配的方式来识别 action。因此，agent 能否正常运行，与 prompt 格式，以及 LLM 的 ICL 以及 alignment 能力有着很大的关系。</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>最后的输出 <code>AgentAction</code> 中会包括：需要使用的 tool，使用该 tool 时候，对应的执行命令。可以使用的 tool 会在 prompt template 中提示出来，比如如果你采用 <code>create_pandas_dataframe_agent</code> 构造了一个 agent，那么它的 prompt template 就会编程：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
You are working with a pandas dataframe in Python. The name of the dataframe is \`df\`.
You should use the tools below to answer the question posed of you:
python_repl_ast
A Python shell. Use this to execute python commands. &quot;
        &quot;Input should be a valid python command. &quot;
        &quot;When using this tool, sometimes output is abbreviated - &quot;
        &quot;make sure it does not look abbreviated before using it in your answer.&quot;
This is the result of \`print(df.head())\`:
Begin!
Question: {input}
{agent_scratchpad}
&quot;&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h4 id="agentexecutor" tabindex="-1"><a class="header-anchor" href="#agentexecutor" aria-hidden="true">#</a> AgentExecutor</h4><p>不论是通过 <code>initialize_agent</code> 或者是 <code>create_pandas_dataframe_agent</code> 等方式，我们都可以得到 <code>AgentExecutor</code> 来执行 agent 相关的任务。</p><p><code>AgentExecutor</code> 实际上是一个 <code>Chain</code>，可以通过 <code>.run()</code> 或者 <code>_call()</code> 来调用。如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>agent_executor <span class="token operator">=</span> create_pandas_dataframe_agent<span class="token punctuation">(</span>llm<span class="token operator">=</span>llm<span class="token punctuation">,</span> df<span class="token operator">=</span>df<span class="token punctuation">)</span>
agent_executor<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;how many rows are there?&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>agent_executor.run()</code> 通过迭代地执行 agent</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>intermediate_steps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># List[(AgentAction, str)]</span>
<span class="token comment"># 其中 str 为 oservation，是每次迭代后，我们调用 tool 得到的结果。</span>
agent_action <span class="token operator">=</span> self<span class="token punctuation">.</span>agent<span class="token punctuation">.</span>plan<span class="token punctuation">(</span>
                intermediate_steps<span class="token punctuation">,</span>
                <span class="token operator">**</span>inputs<span class="token punctuation">)</span>
<span class="token comment"># inputs 是一个用于填充 prompt.format 的字典，参考 prompts 部分。</span>

<span class="token keyword">for</span> agent_action <span class="token keyword">in</span> actions<span class="token punctuation">:</span>
	tools2run <span class="token operator">=</span> name_to_tool_map<span class="token punctuation">[</span>agent_action<span class="token punctuation">.</span>tool<span class="token punctuation">]</span>
    observation <span class="token operator">=</span> tool<span class="token punctuation">.</span>run<span class="token punctuation">(</span>agent_action<span class="token punctuation">.</span>tool_input<span class="token punctuation">,</span> <span class="token operator">**</span>tool_run_kwargs<span class="token punctuation">,</span><span class="token punctuation">)</span>

intermediate_steps<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>agent_action<span class="token punctuation">,</span> observation<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因此，结合上面 Agent 部分的 <code>plan</code>，我们就可以理解 langchain 中 Agent 执行的大致逻辑。</p><h3 id="prompts" tabindex="-1"><a class="header-anchor" href="#prompts" aria-hidden="true">#</a> Prompts</h3><p>Langchain 当中，定义好了不同的 Prompt template，以面对不同的用户提问，prompt template 应该与模型绑定。Prompts 模块当中也提供了 example selector，方便用户进行 few shot 选择。</p><h3 id="callback" tabindex="-1"><a class="header-anchor" href="#callback" aria-hidden="true">#</a> Callback</h3><p>可以在各个环节对你的 LLM 应用进行监控， callback 可以用于各个环节，如 Chain 开始，Chain 结束，LLM 开始， LLM 出错，接受到新的 Token 等等。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>callbacks <span class="token keyword">import</span> StdOutCallbackHandler
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>chains <span class="token keyword">import</span> LLMChain
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>llms <span class="token keyword">import</span> OpenAI
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> PromptTemplate

handler <span class="token operator">=</span> StdOutCallbackHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
llm <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span><span class="token punctuation">)</span>
prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token string">&quot;1 + {number} = &quot;</span><span class="token punctuation">)</span>

<span class="token comment"># First, let&#39;s explicitly set the StdOutCallbackHandler in \`callbacks\`</span>
chain <span class="token operator">=</span> LLMChain<span class="token punctuation">(</span>llm<span class="token operator">=</span>llm<span class="token punctuation">,</span> prompt<span class="token operator">=</span>prompt<span class="token punctuation">,</span> callbacks<span class="token operator">=</span><span class="token punctuation">[</span>handler<span class="token punctuation">]</span><span class="token punctuation">)</span>
chain<span class="token punctuation">.</span>run<span class="token punctuation">(</span>number<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义 callback 需要实现 <code>langchain.callbacks.base.BaseCallBackHandler</code> 中的接口。</p><h3 id="other-utils" tabindex="-1"><a class="header-anchor" href="#other-utils" aria-hidden="true">#</a> Other Utils</h3><h4 id="output-parser" tabindex="-1"><a class="header-anchor" href="#output-parser" aria-hidden="true">#</a> Output Parser</h4><h4 id="api-工具" tabindex="-1"><a class="header-anchor" href="#api-工具" aria-hidden="true">#</a> API 工具</h4><p>在 <code>tools</code> 目录下，可以看到各种适配 Plugin 等插件。支持通过 python 运行各种脚本、调用各类 API 。</p>`,38);function _(y,f){const a=i("ExternalLinkIcon");return p(),c("div",null,[u,r,d,n("p",null,[s("主要的应用场景有："),n("a",k,[s("私人助理"),t(a)]),s(" ，"),n("a",m,[s("问答系统"),t(a)]),s(" 等。")]),v,n("p",null,[n("a",h,[s("官方文档"),t(a)]),s(" 中有部分 chain 的示例代码，在源码 "),b,s(" 中可以查看到所有默认的 chain。一些比较有意思的 chain：")]),g])}const w=o(l,[["render",_],["__file","笔记langchain.html.vue"]]);export{w as default};
