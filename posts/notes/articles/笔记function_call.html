<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://antarina.tech/posts/notes/articles/%E7%AC%94%E8%AE%B0function_call.html"><meta property="og:site_name" content="è®°å¿†ç¬”ä¹¦"><meta property="og:title" content="Function Call æ•´ç†"><meta property="og:description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢³ç†äº†å¼€æºæ¨¡å‹ Function Calling èƒ½åŠ›çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬é‡‡ç”¨çš„ chat templateï¼Œfunction call è®­ç»ƒæ–¹æ¡ˆç­‰ã€‚æ¶‰åŠæ¨¡å‹ LlaMa 3.1ï¼Œ Mistral Large 2ï¼Œglm-4-9b-chatï¼ŒQwen 2ã€‚ Llama 3.1 æ¨èå®˜æ–¹æŒ‡å—ï¼šhttps://llama.meta.com/docs/model-cards-and-prompt-formats/llama3_1/ å¯¹è¯åè®®ï¼ˆChat Protocal) Llama 3.1 ä¸­é‡‡ç”¨äº†ä»¥ä¸‹ special tokens æ¥è¾…åŠ©å¤šè½®å¯¹è¯å’Œå·¥å…·çš„è°ƒç”¨ã€‚ã€‚"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-01-29T12:24:45.000Z"><meta property="article:author" content="Kevin å´å˜‰æ–‡"><meta property="article:tag" content="AIGC"><meta property="article:tag" content="LLM"><meta property="article:published_time" content="2024-08-10T00:00:00.000Z"><meta property="article:modified_time" content="2025-01-29T12:24:45.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Function Call æ•´ç†","image":[""],"datePublished":"2024-08-10T00:00:00.000Z","dateModified":"2025-01-29T12:24:45.000Z","author":[{"@type":"Person","name":"Kevin å´å˜‰æ–‡"}]}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link rel="icon" href="/logo.svg"><title>Function Call æ•´ç† | è®°å¿†ç¬”ä¹¦</title><meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢³ç†äº†å¼€æºæ¨¡å‹ Function Calling èƒ½åŠ›çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬é‡‡ç”¨çš„ chat templateï¼Œfunction call è®­ç»ƒæ–¹æ¡ˆç­‰ã€‚æ¶‰åŠæ¨¡å‹ LlaMa 3.1ï¼Œ Mistral Large 2ï¼Œglm-4-9b-chatï¼ŒQwen 2ã€‚ Llama 3.1 æ¨èå®˜æ–¹æŒ‡å—ï¼šhttps://llama.meta.com/docs/model-cards-and-prompt-formats/llama3_1/ å¯¹è¯åè®®ï¼ˆChat Protocal) Llama 3.1 ä¸­é‡‡ç”¨äº†ä»¥ä¸‹ special tokens æ¥è¾…åŠ©å¤šè½®å¯¹è¯å’Œå·¥å…·çš„è°ƒç”¨ã€‚ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-99575b2e.css" as="style"><link rel="stylesheet" href="/assets/style-99575b2e.css">
    <link rel="modulepreload" href="/assets/app-47fc8baf.js"><link rel="modulepreload" href="/assets/ç¬”è®°function_call.html-bc73116b.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/ç¬”è®°function_call.html-8929b4c5.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container no-sidebar has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><!----><!----><span class="vp-site-name">è®°å¿†ç¬”ä¹¦</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="ä¸»é¡µ" class="vp-link nav-link nav-link" href="/"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="å½’æ¡£" class="vp-link nav-link nav-link" href="/timeline/"><span class="font-icon icon iconfont icon-categoryselected" style=""></span>å½’æ¡£<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/kevinng77" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Function Call æ•´ç†</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Kevin å´å˜‰æ–‡</span></span><span property="author" content="Kevin å´å˜‰æ–‡"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-08-10T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 16 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT16M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category7 clickable" role="navigation">çŸ¥è¯†ç¬”è®°</span><!--]--><meta property="articleSection" content="çŸ¥è¯†ç¬”è®°"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag4 clickable" role="navigation">AIGC</span><span class="page-tag-item tag6 clickable" role="navigation">LLM</span><!--]--><meta property="keywords" content="AIGC,LLM"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#llama-3-1">Llama 3.1</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#å¯¹è¯åè®®-chat-protocal">å¯¹è¯åè®®ï¼ˆChat Protocal)</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#å·¥å…·è°ƒç”¨ç›¸å…³çš„è®­ç»ƒ">å·¥å…·è°ƒç”¨ç›¸å…³çš„è®­ç»ƒ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#æ•ˆæœ">æ•ˆæœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#å…¶ä»–">å…¶ä»–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#mistral-large-2">Mistral Large 2</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#glm-4-9b-chat">glm-4-9b-chat</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#å¯¹è¯åè®®">å¯¹è¯åè®®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#æ•ˆæœ-1">æ•ˆæœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#å…¶ä»–-1">å…¶ä»–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#qwen-2">Qwen 2</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#å…¶ä»–-2">å…¶ä»–</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢³ç†äº†å¼€æºæ¨¡å‹ Function Calling èƒ½åŠ›çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬é‡‡ç”¨çš„ chat templateï¼Œfunction call è®­ç»ƒæ–¹æ¡ˆç­‰ã€‚æ¶‰åŠæ¨¡å‹ LlaMa 3.1ï¼Œ Mistral Large 2ï¼Œglm-4-9b-chatï¼ŒQwen 2ã€‚</p><h2 id="llama-3-1" tabindex="-1"><a class="header-anchor" href="#llama-3-1" aria-hidden="true">#</a> Llama 3.1</h2><p>æ¨èå®˜æ–¹æŒ‡å—ï¼šhttps://llama.meta.com/docs/model-cards-and-prompt-formats/llama3_1/</p><h3 id="å¯¹è¯åè®®-chat-protocal" tabindex="-1"><a class="header-anchor" href="#å¯¹è¯åè®®-chat-protocal" aria-hidden="true">#</a> å¯¹è¯åè®®ï¼ˆChat Protocal)</h3><p>Llama 3.1 ä¸­é‡‡ç”¨äº†ä»¥ä¸‹ special tokens æ¥è¾…åŠ©å¤šè½®å¯¹è¯å’Œå·¥å…·çš„è°ƒç”¨ã€‚ã€‚</p><ul><li><strong><code>&lt;|begin_of_text|&gt;</code></strong> : æŒ‡å®š prompt çš„å¼€å§‹</li><li><strong><code>&lt;|end_of_text|&gt;</code>:</strong> æ¨¡å‹å°†åœæ­¢ç”Ÿæˆæ›´å¤šçš„ tokensã€‚æ­¤ token ä»…ç”±åŸºç¡€æ¨¡å‹ç”Ÿæˆã€‚</li><li><strong><code>&lt;|start_header_id|&gt;</code> å’Œ <code>&lt;|end_header_id|&gt;</code>:</strong> è¿™äº› tokens å°é—­ç‰¹å®šæ¶ˆæ¯çš„è§’è‰²ã€‚å¯èƒ½çš„è§’è‰²åŒ…æ‹¬: <code>[system, user, assistant, and ipython]</code></li><li><strong><code>&lt;|eom_id|&gt;</code>:</strong> end of messageã€‚è¡¨ç¤ºæ¶ˆæ¯ç»“æŸï¼Œæç¤ºæ¨¡å‹æ¥ä¸‹æ¥å¯èƒ½éœ€è¦è°ƒç”¨å·¥å…·ã€‚è¿™ç”¨äºæ¨¡å‹ä¸ä»»ä½•å¯ç”¨å·¥å…·ä¹‹é—´çš„å¤šæ­¥éª¤äº¤äº’ã€‚å½“åœ¨ç³»ç»Ÿæç¤ºä¸­ä½¿ç”¨<code>Environment: ipython</code>æŒ‡ä»¤æ—¶ï¼Œæˆ–è€…å¦‚æœæ¨¡å‹è°ƒç”¨å†…ç½®å·¥å…·æ—¶ï¼Œä¼šå‘å‡ºæ­¤ tokenã€‚</li><li><strong><code>&lt;|eot_id|&gt;</code>:</strong> End of turnã€‚è¡¨ç¤ºæ¨¡å‹å·²ç»ç¡®å®šå®ƒå·²å®Œæˆä¸ç”¨æˆ·æ¶ˆæ¯çš„äº’åŠ¨ï¼Œæœ‰ä¸¤ç§æƒ…å†µä¼šä½¿ç”¨ï¼š</li><li>åœ¨æ¨¡å‹ä¸ç”¨æˆ·ä¹‹é—´çš„ç›´æ¥äº’åŠ¨ç»“æŸæ—¶</li><li>åœ¨æ¨¡å‹ä¸ä»»ä½•å¯ç”¨å·¥å…·ä¹‹é—´çš„å¤šæ¬¡äº’åŠ¨ç»“æŸæ—¶</li><li><strong><code>&lt;|python_tag|&gt;</code>:</strong> æ˜¯æ¨¡å‹å“åº”ä¸­ç”¨æ¥è¡¨ç¤ºå·¥å…·è°ƒç”¨çš„ç‰¹æ®Šæ ‡ç­¾ã€‚</li></ul><p>åœ¨å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œllama 3.1 æ”¯æŒäº† 4 ä¸­è§’è‰²ï¼š</p><p><code>[system, assistant, user, ipython]</code> å…¶ä¸­ <code>ipython</code> çš„è§’è‰²ä¸ gpt ä¸­çš„ <code>tool</code> ç±»ä¼¼ï¼Œç”¨æ¥æ ‡è®°è°ƒç”¨ tool åç”Ÿæˆçš„ç»“æœã€‚</p><h4 id="tool-call-template-æ ·å¼" tabindex="-1"><a class="header-anchor" href="#tool-call-template-æ ·å¼" aria-hidden="true">#</a> Tool Call Template æ ·å¼</h4><p>æ ¹æ® <a href="https://arxiv.org/pdf/2407.21783" target="_blank" rel="noopener noreferrer">Llama çš„è¿™ä¸ªæŠ€æœ¯æŠ¥å‘Š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ¥çœ‹ï¼Œllama 3 å·¥å…·è°ƒç”¨èƒ½åŠ›ï¼Œæ˜¯åœ¨ post training çš„æ—¶å€™åŠ ä¸Šå»çš„ã€‚å¤§è‡´çš„ä½¿ç”¨ tool æµç¨‹å’Œ GPT çš„ tool call å·®ä¸å¤šï¼Œå¦‚ä¸‹ï¼š<img src="/assets/img/function_call/image-20240810173733768.jpg" alt="image-20240810173733768" loading="lazy"></p><p><strong>æ ·å¼ 1ï¼šJson based tool calling</strong></p><p>ä»¥ä¸‹ç”¨ä¸€ä¸ªä¾‹å­å±•ç¤º llama 3.1 tool call æ—¶å€™çš„æ ¼å¼ï¼Œå‡è®¾ç”¨æˆ·ä¸ agent æœ‰äº†ä»¥ä¸‹å¯¹è¯ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">tool_call </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;get_current_temperature&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;arguments&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;location&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Paris, France&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">messages </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;system&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;You are a bot that responds to weather queries.&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Hey, what&#39;s the temperature in Paris right now?&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;assistant&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;tool_calls&quot;</span><span style="color:#24292E;">: [{</span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">: tool_call}]},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;tool&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;get_current_temperature&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;22.0&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆï¼Œæ­¤æ—¶çš„ prompt ä¸ºï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">&lt;|begin_of_text|&gt;&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Environment: ipython</span></span>
<span class="line"><span style="color:#24292E;">Cutting Knowledge Date: December 2023</span></span>
<span class="line"><span style="color:#24292E;">Today Date: 26 Jul 2024</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">You have access to the following functions. To call a function, please respond with JSON for a function call.Respond in the format {&quot;name&quot;: function name, &quot;parameters&quot;: dictionary of argument name and its value}.Do not use variables.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    &quot;type&quot;: &quot;function&quot;,</span></span>
<span class="line"><span style="color:#24292E;">    &quot;function&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">        &quot;name&quot;: &quot;get_current_temperature&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        &quot;description&quot;: &quot;Get the current temperature at a location.&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        &quot;parameters&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">            &quot;type&quot;: &quot;object&quot;,</span></span>
<span class="line"><span style="color:#24292E;">            &quot;properties&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">                &quot;location&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">                    &quot;type&quot;: &quot;string&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                    &quot;description&quot;: &quot;The location to get the temperature for, in the format \&quot;City, Country\&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">            &quot;required&quot;: [</span></span>
<span class="line"><span style="color:#24292E;">                &quot;location&quot;</span></span>
<span class="line"><span style="color:#24292E;">            ]</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        &quot;return&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">            &quot;type&quot;: &quot;number&quot;,</span></span>
<span class="line"><span style="color:#24292E;">            &quot;description&quot;: &quot;The current temperature at the specified location in the specified units, as a float.&quot;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">You are a bot that responds to weather queries.&lt;|eot_id|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Hey, what&#39;s the temperature in Paris right now?&lt;|eot_id|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">{&quot;name&quot;: &quot;get_current_temperature&quot;, &quot;parameters&quot;: {&quot;location&quot;: &quot;Paris, France&quot;}}&lt;|eot_id|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;|start_header_id|&gt;ipython&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&quot;22.0&quot;&lt;|eot_id|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å…³æ³¨ç‚¹ï¼š</strong></p><ul><li>ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä»¥ä¸Š prompt ä¸­æ·»åŠ äº†ä¸€äº›æ¢è¡Œç¬¦ã€‚</li><li>llama 3.1 70B instruct æä¾›çš„æ¨¡æ¿ä¸­ï¼Œå¯ä»¥é€‰æ‹©å°† function ä¿¡æ¯æ”¾åœ¨ç”¨æˆ·çš„è¾“å…¥ä¸­ï¼Œæˆ–è€…æ”¾åœ¨ system prompt ä¸­ã€‚</li><li>å·¥å…·è°ƒç”¨ç»“æœé€šè¿‡ <code>&lt;|start_header_id|&gt;ipython&lt;|end_header_id|&gt;</code> æ ‡è®°ã€‚</li><li>åœ¨ llama 3.1 çš„<a href="https://llama.meta.com/docs/model-cards-and-prompt-formats/llama3_1/#built-in-tooling" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸­è¿˜è®°å½•äº†ä¸€ç§ User-defined Custom tool calling çš„æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰åœ¨ llama3.1 70B instruct çš„ jinja chat template ä¸­æ‰¾åˆ°å¯¹åº”çš„åŠŸèƒ½ï¼Œå¯èƒ½å®˜æ–¹è¿˜æ²¡æ›´æ–° jinja templateï¼Ÿ</li></ul><details class="hint-container details"><summary>å…·ä½“ç”Ÿæˆä»¥ä¸Š prompt çš„ä»£ç </summary><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> transformers </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> AutoTokenizer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">model_path </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/home/kevin/models/Meta-Llama-3.1-70B-Instruct&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># First, define a tool</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">get_current_temperature</span><span style="color:#24292E;">(location: </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">) -&gt; </span><span style="color:#005CC5;">float</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">    Get the current temperature at a location.</span></span>
<span class="line"><span style="color:#032F62;">    </span></span>
<span class="line"><span style="color:#032F62;">    Args:</span></span>
<span class="line"><span style="color:#032F62;">        location: The location to get the temperature for, in the format &quot;City, Country&quot;</span></span>
<span class="line"><span style="color:#032F62;">    Returns:</span></span>
<span class="line"><span style="color:#032F62;">        The current temperature at the specified location in the specified units, as a float.</span></span>
<span class="line"><span style="color:#032F62;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">22</span><span style="color:#24292E;">.  </span><span style="color:#6A737D;"># A real function should probably actually get the temperature!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">tool_call </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;get_current_temperature&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;arguments&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;location&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Paris, France&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">messages </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;system&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;You are a bot that responds to weather queries.&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Hey, what&#39;s the temperature in Paris right now?&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;assistant&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;tool_calls&quot;</span><span style="color:#24292E;">: [{</span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">: tool_call}]},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;tool&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;get_current_temperature&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;22.0&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">tokenizer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> AutoTokenizer.from_pretrained(model_path, </span><span style="color:#E36209;">trust_remote_code</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">inputs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tokenizer.apply_chat_template(messages, </span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">tools</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[get_current_temperature],</span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">add_generation_prompt</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">tokenize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">tools_in_user_message</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;input.txt&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;w&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> fp:</span></span>
<span class="line"><span style="color:#24292E;">    fp.write(inputs)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>æ›´å…·ä½“çš„å¤šè½®å¯¹è¯ prompt å¯ä»¥å‚è€ƒ llama 3.1-70b-instruct çš„ jinja chat templateã€‚</p><p><strong>æ ·å¼ 2ï¼šBuilt in Python based tool calling</strong></p><p>å®˜æ–¹è‡ªå¸¦æ”¯æŒ <code>brave_search</code>, <code>wolfram_alpha</code>, å’Œ <code>code interpreter</code> ä¸‰ç§å·¥å…·ï¼Œä½¿ç”¨è¿™ä¸‰ç§å·¥å…·æ—¶ï¼Œtokenizer çš„å¤„ç†æ–¹å¼ä¸ json based tool calling ä¸å¤ªä¸€æ ·ã€‚å…·ä½“æ˜¯è¦åœ¨ system prompt ä¸­åŠ ä¸Š</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">Environment: ipython</span></span>
<span class="line"><span style="color:#24292e;">Tools: brave_search, wolfram_alpha</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ—¶æ¨¡å‹è¦è°ƒç”¨å·¥å…·æ—¶ï¼Œä¼šç”Ÿæˆ <code>&lt;|python_tag|&gt;wolfram_alpha.call(query=&quot;solve x^3 - 4x^2 + 6x - 24 = 0&quot;)&lt;|eom_id|&gt;</code> ç±»ä¼¼çš„æ ·å¼ï¼Œè€ŒéåŸå…ˆçš„ json æ ¼å¼ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">&lt;|begin_of_text|&gt;&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Environment: ipython</span></span>
<span class="line"><span style="color:#24292E;">Tools: brave_search, wolfram_alpha</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Cutting Knowledge Date: December 2023</span></span>
<span class="line"><span style="color:#24292E;">Today Date: 23 Jul 2024</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">You are a helpful assistant.&lt;|eot_id|&gt;&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Can you help me solve this equation: x^3 - 4x^2 + 6x - 24 = 0&lt;|eot_id|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;|python_tag|&gt;wolfram_alpha.call(query=&quot;solve x^3 - 4x^2 + 6x - 24 = 0&quot;)&lt;|eom_id|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;|start_header_id|&gt;ipython&lt;|end_header_id|&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">{&quot;queryresult&quot;: {&quot;success&quot;: true, &quot;inputstring&quot;: &quot;solve x^3 - 4x^2 + 6x - 24 = 0&quot;, &quot;pods&quot;: [{&quot;title&quot;: &quot;Input interpretation&quot;, &quot;subpods&quot;: [{&quot;title&quot;: &quot;&quot;, &quot;plaintext&quot;: &quot;solve x^3 - 4 x^2 + 6 x - 24 = 0&quot;}]}, {&quot;title&quot;: &quot;Results&quot;, &quot;primary&quot;: true, &quot;subpods&quot;: [{&quot;title&quot;: &quot;&quot;, &quot;plaintext&quot;: &quot;x = 4&quot;}, {&quot;title&quot;: &quot;&quot;, &quot;plaintext&quot;: &quot;x = \u00b1 (i sqrt(6))&quot;}]}, ... ]}}&lt;|eot_id|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;         </span></span>
<span class="line"><span style="color:#24292E;">          </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å·¥å…·è°ƒç”¨ç›¸å…³çš„è®­ç»ƒ" tabindex="-1"><a class="header-anchor" href="#å·¥å…·è°ƒç”¨ç›¸å…³çš„è®­ç»ƒ" aria-hidden="true">#</a> å·¥å…·è°ƒç”¨ç›¸å…³çš„è®­ç»ƒ</h3><p><a href="https://arxiv.org/pdf/2407.21783" target="_blank" rel="noopener noreferrer">The Llama 3 Herd of Models<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­æåˆ°å·¥å…·è°ƒç”¨æ˜¯åœ¨ post training éƒ¨åˆ†åŠ ä¸Šå»çš„ï¼ŒåŒ…æ‹¬äº†å¤šç»„çš„ SFT + DPO è®­ç»ƒã€‚</p><figure><img src="/assets/img/function_call/image-20240811164344721.jpg" alt="Llama 3 è®­ç»ƒæµç¨‹" tabindex="0" loading="lazy"><figcaption>Llama 3 è®­ç»ƒæµç¨‹</figcaption></figure><h4 id="sft" tabindex="-1"><a class="header-anchor" href="#sft" aria-hidden="true">#</a> SFT</h4><p>Learning rate 1e-5ï¼Œè®­ç»ƒ 9K stepsã€‚SFT çš„è®­ç»ƒé›†ä¸­ï¼Œæœ‰ 21.9% çš„æ•°æ®æ˜¯ç”¨äºæ¨ç†å’Œå·¥å…·ä½¿ç”¨çš„:</p><figure><img src="/assets/img/function_call/image-20240810184324389.jpg" alt="image-20240810184324389" tabindex="0" loading="lazy"><figcaption>image-20240810184324389</figcaption></figure><p><strong>æ•°æ®</strong></p><p>å‚è€ƒ llama 3 herd of model ä¸­å¯¹ SFT Tool æ•°æ®é›†çš„æè¿°ï¼š</p><ul><li>æ ‡æ³¨å‘˜åªå¯¹ assistant ä¿¡æ¯è¿›è¡Œæ’åæ‰“åˆ†ï¼ˆé€šå¸¸æ¨¡å‹å¯¹å½“å‰é—®é¢˜çš„æ¨ç†èƒ½åŠ›è¶Šå¼ºï¼Œæ‰“åˆ†è¶Šé«˜ï¼‰ï¼Œä¸å¯¹ tool message è¿›è¡Œæ’åæ‰“åˆ†ã€‚</li><li>ä¸é‡‡ç”¨ rejection samplingï¼Œå› ä¸º llama å›¢é˜Ÿæ²¡æœ‰åœ¨åæœŸçš„ tool æµ‹è¯„ä¸­è§‚å¯Ÿåˆ°å®ƒå¸¦æ¥çš„æ”¶ç›Šã€‚</li></ul><p>ä¸ºäº†åŠ å¿«æ ‡æ³¨è¿‡ç¨‹ï¼Œllama å›¢é˜Ÿé¦–å…ˆé€šè¿‡åœ¨ä¹‹å‰çš„ Llama 3 æ£€æŸ¥ç‚¹ç”Ÿæˆçš„åˆæˆæ•°æ®ä¸Šè¿›è¡Œå¾®è°ƒæ¥å¼•å¯¼åŸºæœ¬çš„å·¥å…·ä½¿ç”¨èƒ½åŠ›ã€‚å› æ­¤ï¼Œæ ‡æ³¨å‘˜éœ€è¦è¿›è¡Œçš„ç¼–è¾‘è¾ƒå°‘ã€‚åŒæ ·åœ°ï¼Œéšç€ Llama 3 åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€æ¸æ”¹è¿›ï¼Œæˆ‘ä»¬é€æ­¥å¤æ‚åŒ–äººç±»æ ‡æ³¨åè®®ï¼šä»æ ‡æ³¨å•è½® tool use çš„å¯¹è¯æ•°æ®å¼€å§‹ï¼Œé€æ­¥è¿‡æ¸¡åˆ°æ ‡æ³¨å¯¹è¯ä¸­åŒ…å«äº† tool use çš„æ•°æ®ï¼Œæœ€ååˆ°æ ‡æ³¨å¯¹è¯ä¸­åŒ…å«äº†å¤šæ­¥ tool use ä»¥åŠæ•°æ®åˆ†æçš„è®­ç»ƒæ•°æ®ã€‚</p><p>llama å›¢é˜Ÿé‡‡ç”¨äº†ä»¥ä¸‹æ–¹æ³•æ¥æ„é€  Synthetic <strong>Tool datasets</strong></p><p><strong>single-step tool use æ•°æ®</strong></p><p>å‚è€ƒä¸Šæ–‡ä¸­æåˆ°çš„æ ‡æ³¨æ–¹æ¡ˆï¼Œllama å›¢é˜Ÿå…ˆæ„é€ äº†è¯¥æ•°æ®é›†ï¼Œå¹¶å¯¹æ¨¡å‹è¿›è¡Œå•è®º tool use è®­ç»ƒã€‚æ„é€ æ­¥éª¤ï¼š</p><ol><li>é€šè¿‡ few-shotï¼Œç”¨æ¨¡å‹ç”Ÿæˆç”¨æˆ· promptã€‚è¯¥ prompt å¿…é¡»æ¶‰åŠåˆ°è°ƒç”¨ 1 ä¸ª llama çš„æ ¸å¿ƒå·¥å…·ï¼ˆcore toolsï¼‰ã€‚</li><li>é€šè¿‡ few-shotï¼Œå’Œ step 1 ä¸­çš„ promptï¼Œç”Ÿæˆå¯¹åº”çš„ tool call å›ç­”ï¼ˆåŒ…æ‹¬è°ƒç”¨å·¥å…·åç§°ï¼Œå¯¹åº”å‚æ•°ï¼‰ã€‚</li><li>æ‰§è¡Œ step 2 ä¸­çš„å·¥å…·å’Œå‚æ•°ï¼Œå¾—åˆ°å¯¹åº”çš„ tool outputã€‚</li><li>è®©æ¨¡å‹åŸºäº ç”¨æˆ· promptï¼Œtool callï¼Œtool outputï¼Œç”Ÿæˆæœ€ç»ˆå›å¤ã€‚</li></ol><p>å› æ­¤æ•´ä¸ªæ•°æ®é›†åŒ…æ‹¬äº†ï¼š<code>system prompt</code>ï¼Œ <code>user prompt</code>, <code>tool call</code>, <code>tool output</code> å’Œ <code>final answer</code>ã€‚åœ¨è·å¾—æ•°æ®é›†åï¼Œllama è¿˜è¿‡æ»¤äº†çº¦ 30% çš„æ•°æ®é›†ï¼Œä»¥å»é™¤æ— æ³•æ‰§è¡Œå·¥å…·æˆ–æœ‰å…¶ä»–æ ¼å¼é—®é¢˜çš„æ•°æ®ã€‚</p><p>æ ¹æ® llama æŠ¥å‘Šä¸­ä»‹ç» core tools åŒ…æ‹¬ <code>brave_search</code>, <code>wolfram_alpha</code>, and <code>code interpreter</code> ç­‰ python å¯¹è±¡ã€‚</p><p><strong>Multi-step tool use æ•°æ®ï¼š</strong></p><p>Multi-step ä¸ single step çš„ tool use æ•°æ®ç”Ÿæˆæ–¹å¼ç›¸ä¼¼ï¼š</p><ol><li>é€šè¿‡ few-shotï¼Œç”¨æ¨¡å‹ç”Ÿæˆç”¨æˆ· promptã€‚è¯¥ prompt å¿…é¡»æ˜¯ä¸€ä¸ªéœ€è¦ä½¿ç”¨å¤šä¸ª tool æ¥è·å¾—ç­”æ¡ˆçš„ä»»åŠ¡ï¼ˆè¿™äº› tool ä¸ä¸€å®šå¾—ä» core tool ä¸­é€‰ï¼‰ã€‚</li><li>åŸºäº step 1 çš„ promptï¼Œè®© llama 3 ç”ŸæˆåŒ…å«äº†æ¨ç†æ­¥éª¤å’Œå¯¹åº” tool call ä¿¡æ¯çš„æ•°æ®ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹å›¾ï¼š</li></ol><figure><img src="/assets/img/function_call/image-20240811110909818.jpg" alt="Multi-step tool usage æ•°æ®ç”Ÿæˆç¤ºä¾‹" tabindex="0" loading="lazy"><figcaption>Multi-step tool usage æ•°æ®ç”Ÿæˆç¤ºä¾‹</figcaption></figure><p><strong>File uploads æ•°æ®ï¼š</strong></p><p>File Uploads æ•°æ®å‚è€ƒä¸‹å›¾è®­ç»ƒæ•°æ®ç¤ºä¾‹ã€‚prompt éƒ½æ˜¯åŸºäºæŸä¸ªæ–‡ä»¶è¿›è¡Œæé—®ï¼Œé—®é¢˜åŒ…æ‹¬æ€»ç»“ï¼ŒæŸ¥æ‰¾ bugï¼Œä¼˜åŒ–æŸä¸ªéƒ¨åˆ†ï¼Œæ•°æ®åˆ†æç­‰æ“ä½œã€‚</p><figure><img src="/assets/img/function_call/å›¾ç‰‡.jpg" alt="Processing file uploads æ•°æ®ç¤ºä¾‹" tabindex="0" loading="lazy"><figcaption>Processing file uploads æ•°æ®ç¤ºä¾‹</figcaption></figure><p>é™¤æ­¤å¤–ï¼Œllama åœ¨ system prompt ä¸­è¿›è¡Œäº†è°ƒè¯•ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿåªåœ¨æ¿€æ´»äº† tool call çš„æƒ…å†µä¸‹å»è°ƒç”¨å…±å¤–éƒ¨å·¥å…·ã€‚</p><p>llama å›¢é˜Ÿé‡‡ç”¨äº†ä»¥ä¸‹æ–¹æ³•æ¥æ„é€  <strong>Zero-shot tool use data</strong> ï¼ˆä¸ function calling ç±»ä¼¼ï¼‰</p><ul><li><p><strong>Single, nested, and parallel function calling:</strong> Calls can be simple, nested, <em>i.e.</em> we pass a function call as an argument of another function, or parallel, <em>i.e.</em> the model returns a list of independent function calls. Generating a diverse set of functions, queries and ground truths can be challenging (Mekala et al., 2024), and we resort to mining the Stack (Kocetkov et al., 2022) to ground our synthetic user queries in real functions. More precisely, we extract function calls and their definitions, clean and filter them, <em>e.g.</em> for missing docstrings or non-executable functions, and use Llama 3 to generate a natural language query corresponding to the function call. ä»¥ä¸Šä¸ºåŸæ–‡æè¿°ï¼Œä¸ªäººç†è§£æ˜¯ llama åŸºäº <a href="https://arxiv.org/pdf/2211.15533" target="_blank" rel="noopener noreferrer">the Stack<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> çš„å¼€æºæ•°æ®è¿›è¡Œç­›é€‰/ä¿®æ”¹ï¼Œæ„é€ äº† function call ä¿¡æ¯ï¼Œè€Œåç”¨ llama 3 åŸºäº function call ä¿¡æ¯ï¼Œç”Ÿæˆå¯¹åº”çš„ç”¨æˆ· queryã€‚</p></li><li><p><strong>Multi-turn function calling:</strong> é‡‡ç”¨äº† <a href="https://arxiv.org/pdf/2304.08244" target="_blank" rel="noopener noreferrer">API-Bank: A Comprehensive Benchmark for Tool-Augmented LLMs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­çš„æ–¹æ³•ç”Ÿæˆæ•°æ®ã€‚Llama é‡‡ç”¨äº† 5 ä¸ª agent å¦‚ä¸‹å›¾ï¼š</p></li><li><p>ç¬¬ä¸€ä¸ª agent ç”¨äºç”Ÿæˆä¸åŒçš„é¢†åŸŸï¼Œå¦‚åŒ»ç–—ä¿é™©ï¼Œå¥èº«ç­‰ã€‚</p></li><li><p>ç¬¬äºŒä¸ª agentï¼Œæ ¹æ®é¢†åŸŸæ•°æ®ï¼Œç”Ÿæˆæ½œåœ¨çš„ APIã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸€é˜¶æ®µï¼Œä¸ºäº†ç¡®ä¿æ¨¡æ‹Ÿ API çš„çœŸå®æ€§ï¼Œæˆ‘ä»¬åœ¨ä»£ç†è¾“å…¥ä¸­åŠ å…¥äº†æ¥è‡ªå…¬å…± API çš„ç¤ºä¾‹ã€‚</p></li><li><p>ç¬¬ä¸‰ä¸ª agent ä»æ¨¡æ‹Ÿ API ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ª APIã€‚æ­¤å¤–ï¼Œå®ƒè¿˜é€‰æ‹©äº†æˆ‘ä»¬è®¾è®¡åŸåˆ™ä¸­æ¦‚è¿°çš„ä¸€ç§èƒ½åŠ›ã€‚ç„¶åä½¿ç”¨è¿™äº›ä¿¡æ¯åˆ›å»ºä¸€ä¸ªåŒ¹é…æ‰€é€‰èƒ½åŠ›çš„ query é—®é¢˜ï¼Œè¿™ä¸ª query é—®é¢˜å¯ä»¥é€šè¿‡è°ƒç”¨æ‰€é€‰ API æ¥å®Œæˆå›ç­”ã€‚</p></li><li><p>ç¬¬å››ä¸ª agent å°†é¢†åŸŸã€APIã€èƒ½åŠ›å’Œ query ä½œä¸ºè¾“å…¥ã€‚è¿™ä¸ª agent éœ€è¦é€šè¿‡æ¨¡æ‹Ÿçš„æ–¹å¼è°ƒç”¨é€‰æ‹©çš„ APIï¼Œç„¶åæ ¹æ® API ç»“æœç”Ÿæˆ responseã€‚</p></li><li><p>æœ€åï¼Œæˆ‘ä»¬å¼•å…¥äº†ç¬¬äº”ä¸ª agentï¼Œä½œä¸ºæµ‹è¯•è€…ã€‚è¯¥ agent è‡ªåŠ¨éªŒè¯ç”Ÿæˆçš„æ•°æ®æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„è®¾è®¡åŸåˆ™ï¼ˆå®é™…ä¸Šå®ƒä¸¢å¼ƒäº† 35% çš„å®ä¾‹ï¼‰</p></li></ul><p>æ‰€æœ‰çš„ agent éƒ½æ˜¯é€šè¿‡ç®€å•çš„ prompt + llama 3 å®ç°ã€‚</p><figure><img src="/assets/img/function_call/image-20240811151138851.jpg" alt="image-20240811151138851" tabindex="0" loading="lazy"><figcaption>image-20240811151138851</figcaption></figure><h4 id="dpo" tabindex="-1"><a class="header-anchor" href="#dpo" aria-hidden="true">#</a> DPO</h4><p>Llama å‘ç° PPO æ²¡æœ‰ DPO å¥½ï¼Œäºæ˜¯åªç”¨äº† DPOï¼Œpreference data ä¸­ï¼Œæœ‰ 5.89% æ˜¯å’Œ reasoning è¿˜æœ‰ tool ç›¸å…³çš„ã€‚</p><figure><img src="/assets/img/function_call/image-20240811163510992.jpg" alt="image-20240811163510992" tabindex="0" loading="lazy"><figcaption>image-20240811163510992</figcaption></figure><h3 id="æ•ˆæœ" tabindex="-1"><a class="header-anchor" href="#æ•ˆæœ" aria-hidden="true">#</a> æ•ˆæœ</h3><p>Llama çš„å·¥å…·è°ƒç”¨èƒ½åŠ›è¿˜æ˜¯ä¸é”™çš„ï¼š</p><figure><img src="/assets/img/function_call/image-20240811165517133.jpg" alt="image-20240811165517133" tabindex="0" loading="lazy"><figcaption>image-20240811165517133</figcaption></figure><h3 id="å…¶ä»–" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–" aria-hidden="true">#</a> å…¶ä»–</h3><p>æ›´å¤šå…³äº llama 3.1 tool å’Œ reasoning çš„ç»†èŠ‚ï¼Œæ¨èæŸ¥çœ‹ <a href="https://arxiv.org/pdf/2407.21783" target="_blank" rel="noopener noreferrer">The Llama 3 Herd of Models<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h2 id="mistral-large-2" tabindex="-1"><a class="header-anchor" href="#mistral-large-2" aria-hidden="true">#</a> Mistral Large 2</h2><p>Mistral Large ä¹Ÿæ˜¯é‡‡ç”¨äº†é¢å¤–çš„ special token æ¥è¾…åŠ© function call çš„å¤„ç†ã€‚</p><p>æ¯”å¦‚å¯¹äºä»¥ä¸‹å¯¹è¯å†…å®¹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">messages </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [ </span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;What&#39;s the weather like in Paris?&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;assistant&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;tool_calls&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">        {</span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;id&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&#39;D681PevKs&#39;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">            {</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;get_current_weather&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;arguments&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;location&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Paris, France&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;format&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;celsius&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"><span style="color:#24292E;">            }]},</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;tool&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;get_current_weather&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;20&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;tool_call_id&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&#39;D681PevKs&#39;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">    ]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»è¿‡ mistral large 2 çš„ tokenizer å¤„ç†ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">get_current_weather</span><span style="color:#24292E;">(location: </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">, format: </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">    Get the current weather</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">    Args:</span></span>
<span class="line"><span style="color:#032F62;">        location: The city and state, e.g. San Francisco, CA</span></span>
<span class="line"><span style="color:#032F62;">        format: The temperature unit to use. Infer this from the users location. (choices: [&quot;celsius&quot;, &quot;fahrenheit&quot;])</span></span>
<span class="line"><span style="color:#032F62;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">pass</span></span>
<span class="line"><span style="color:#24292E;">model_path </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/home/kevin/models/Mistral-Large-Instruct-2407&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">tokenizer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> AutoTokenizer.from_pretrained(model_path, </span></span>
<span class="line"><span style="color:#24292E;">                                          </span></span>
<span class="line"><span style="color:#24292E;">                                          </span><span style="color:#E36209;">trust_remote_code</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                          )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">inputs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tokenizer.apply_chat_template(messages, </span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">tokenize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">tools</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [get_current_weather],</span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">add_generation_prompt</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å…¥ <code>input</code> å¦‚ä¸‹ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">&lt;s&gt;[</span><span style="color:#032F62;text-decoration:underline;">AVAILABLE_TOOLS</span><span style="color:#24292E;">] [</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    &quot;type&quot;: &quot;function&quot;,</span></span>
<span class="line"><span style="color:#24292E;">    &quot;function&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">        &quot;name&quot;: &quot;get_current_weather&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        &quot;description&quot;: &quot;Get the current weather&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        &quot;parameters&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">            &quot;type&quot;: &quot;object&quot;,</span></span>
<span class="line"><span style="color:#24292E;">            &quot;properties&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">                &quot;location&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">                    &quot;type&quot;: &quot;string&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                    &quot;description&quot;: &quot;The city and state, e.g. San Francisco, CA&quot;</span></span>
<span class="line"><span style="color:#24292E;">                },</span></span>
<span class="line"><span style="color:#24292E;">                &quot;format&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">                    &quot;type&quot;: &quot;string&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                    &quot;enum&quot;: [</span></span>
<span class="line"><span style="color:#24292E;">                        &quot;celsius&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                        &quot;fahrenheit&quot;</span></span>
<span class="line"><span style="color:#24292E;">                    ],</span></span>
<span class="line"><span style="color:#24292E;">                    &quot;description&quot;: &quot;The temperature unit to use. Infer this from the users location.&quot;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">            &quot;required&quot;: [</span></span>
<span class="line"><span style="color:#24292E;">                &quot;location&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                &quot;format&quot;</span></span>
<span class="line"><span style="color:#24292E;">            ]</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;text-decoration:underline;">/AVAILABLE_TOOLS</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;text-decoration:underline;">INST</span><span style="color:#24292E;">] What&#39;s the weather like in Paris?[</span><span style="color:#032F62;text-decoration:underline;">/INST</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;text-decoration:underline;">TOOL_CALLS</span><span style="color:#24292E;">] </span></span>
<span class="line"><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        &quot;name&quot;: &quot;get_current_weather&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        &quot;arguments&quot;: {</span></span>
<span class="line"><span style="color:#24292E;">            &quot;location&quot;: &quot;Paris, France&quot;,</span></span>
<span class="line"><span style="color:#24292E;">            &quot;format&quot;: &quot;celsius&quot;</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        &quot;id&quot;: &quot;D681PevKs&quot;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">&lt;/s&gt;</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;text-decoration:underline;">TOOL_RESULTS</span><span style="color:#24292E;">] {&quot;content&quot;: 20, &quot;call_id&quot;: &quot;D681PevKs&quot;}[</span><span style="color:#032F62;text-decoration:underline;">/TOOL_RESULTS</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å…³æ³¨ç‚¹ï¼š</strong></p><ul><li>ä¸ºäº†æ–¹ä¾¿å±•ç¤ºè§‚çœ‹ï¼Œä»¥ä¸Š <code>inputs</code> è¿›è¡Œäº†å¿…è¦çš„æ ¼å¼åŒ–ã€‚</li><li>function çš„ä¿¡æ¯æ˜¯ç»Ÿä¸€æ”¾åœ¨äº† system prompt çš„åœ°æ–¹ã€‚</li><li>ç”¨äº† <code>[TOOL_CALLS]</code>, <code>[TOOL_RESULTS]</code> ç­‰é¢å¤– token æ¥è¾…åŠ© function callingã€‚</li></ul><p>å…·ä½“çš„ mistral large 2 Chat Template å¦‚ä¸‹ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">{%- if messages[</span><span style="color:#032F62;text-decoration:underline;">0</span><span style="color:#24292E;">][</span><span style="color:#032F62;text-decoration:underline;">&quot;role&quot;</span><span style="color:#24292E;">] == &quot;system&quot; %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- set system_message = messages[</span><span style="color:#032F62;text-decoration:underline;">0</span><span style="color:#24292E;">][</span><span style="color:#032F62;text-decoration:underline;">&quot;content&quot;</span><span style="color:#24292E;">] %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- set loop_messages = messages[</span><span style="color:#032F62;text-decoration:underline;">1:</span><span style="color:#24292E;">] %}</span></span>
<span class="line"><span style="color:#24292E;">{%- else %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- set loop_messages = messages %}</span></span>
<span class="line"><span style="color:#24292E;">{%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">{%- if not tools is defined %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- set tools = none %}</span></span>
<span class="line"><span style="color:#24292E;">{%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">{%- set user_messages = loop_messages | selectattr(&quot;role&quot;, &quot;equalto&quot;, &quot;user&quot;) | list %}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">{%- for message in loop_messages | rejectattr(&quot;role&quot;, &quot;equalto&quot;, &quot;tool&quot;) | rejectattr(&quot;role&quot;, &quot;equalto&quot;, &quot;tool_results&quot;) | selectattr(&quot;tool_calls&quot;, &quot;undefined&quot;) %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- if (message[</span><span style="color:#032F62;text-decoration:underline;">&quot;role&quot;</span><span style="color:#24292E;">] == &quot;user&quot;) != (loop.index0 % 2 == 0) %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- raise_exception(&quot;After the optional system message, conversation roles must alternate user/assistant/user/assistant/...&quot;) }}</span></span>
<span class="line"><span style="color:#24292E;">    {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">{%- endfor %}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">{{- bos_token }}</span></span>
<span class="line"><span style="color:#24292E;">{%- for message in loop_messages %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- if message[</span><span style="color:#032F62;text-decoration:underline;">&quot;role&quot;</span><span style="color:#24292E;">] == &quot;user&quot; %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- if tools is not none and (message == user_messages[</span><span style="color:#032F62;text-decoration:underline;">-1</span><span style="color:#24292E;">]) %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &quot;[</span><span style="color:#032F62;text-decoration:underline;">AVAILABLE_TOOLS</span><span style="color:#24292E;">] [&quot; }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- for tool in tools %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- set tool = tool.function %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- &#39;{&quot;type&quot;: &quot;function&quot;, &quot;function&quot;: {&#39; }}</span></span>
<span class="line"><span style="color:#24292E;">        {%- for key, val in tool.items() if key != &quot;return&quot; %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- if val is string %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &#39;&quot;&#39; + key + &#39;&quot;: &quot;&#39; + val + &#39;&quot;&#39; }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- else %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &#39;&quot;&#39; + key + &#39;&quot;: &#39; + val|tojson }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- if not loop.last %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &quot;, &quot; }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- endfor %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- &quot;}}&quot; }}</span></span>
<span class="line"><span style="color:#24292E;">                {%- if not loop.last %}</span></span>
<span class="line"><span style="color:#24292E;">                    {{- &quot;, &quot; }}</span></span>
<span class="line"><span style="color:#24292E;">                {%- else %}</span></span>
<span class="line"><span style="color:#24292E;">                    {{- &quot;]&quot; }}</span></span>
<span class="line"><span style="color:#24292E;">                {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- endfor %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &quot;[</span><span style="color:#032F62;text-decoration:underline;">/AVAILABLE_TOOLS</span><span style="color:#24292E;">]&quot; }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- if loop.last and system_message is defined %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &quot;[</span><span style="color:#032F62;text-decoration:underline;">INST</span><span style="color:#24292E;">] &quot; + system_message + &quot;\n\n&quot; + message[</span><span style="color:#032F62;text-decoration:underline;">&quot;content&quot;</span><span style="color:#24292E;">] + &quot;[</span><span style="color:#032F62;text-decoration:underline;">/INST</span><span style="color:#24292E;">]&quot; }}</span></span>
<span class="line"><span style="color:#24292E;">        {%- else %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &quot;[</span><span style="color:#032F62;text-decoration:underline;">INST</span><span style="color:#24292E;">] &quot; + message[</span><span style="color:#032F62;text-decoration:underline;">&quot;content&quot;</span><span style="color:#24292E;">] + &quot;[</span><span style="color:#032F62;text-decoration:underline;">/INST</span><span style="color:#24292E;">]&quot; }}</span></span>
<span class="line"><span style="color:#24292E;">        {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- elif message[</span><span style="color:#032F62;text-decoration:underline;">&quot;role&quot;</span><span style="color:#24292E;">] == &quot;tool_calls&quot; or message.tool_calls is defined %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- if message.tool_calls is defined %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- set tool_calls = message.tool_calls %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- else %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- set tool_calls = message.content %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- &quot;[</span><span style="color:#032F62;text-decoration:underline;">TOOL_CALLS</span><span style="color:#24292E;">] [&quot; }}</span></span>
<span class="line"><span style="color:#24292E;">        {%- for tool_call in tool_calls %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- set out = tool_call.function|tojson %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- out[</span><span style="color:#032F62;text-decoration:underline;">:-1</span><span style="color:#24292E;">] }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- if not tool_call.id is defined or tool_call.id|length != 9 %}</span></span>
<span class="line"><span style="color:#24292E;">                {{- raise_exception(&quot;Tool call IDs should be alphanumeric strings with length 9!&quot;) }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- &#39;, &quot;id&quot;: &quot;&#39; + tool_call.id + &#39;&quot;}&#39; }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- if not loop.last %}</span></span>
<span class="line"><span style="color:#24292E;">                {{- &quot;, &quot; }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- else %}</span></span>
<span class="line"><span style="color:#24292E;">                {{- &quot;]&quot; + eos_token }}</span></span>
<span class="line"><span style="color:#24292E;">            {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- endfor %}</span></span>
<span class="line"><span style="color:#24292E;">    {%- elif message[</span><span style="color:#032F62;text-decoration:underline;">&quot;role&quot;</span><span style="color:#24292E;">] == &quot;assistant&quot; %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- &quot; &quot; + message[</span><span style="color:#032F62;text-decoration:underline;">&quot;content&quot;</span><span style="color:#24292E;">] + eos_token}}</span></span>
<span class="line"><span style="color:#24292E;">    {%- elif message[</span><span style="color:#032F62;text-decoration:underline;">&quot;role&quot;</span><span style="color:#24292E;">] == &quot;tool_results&quot; or message[</span><span style="color:#032F62;text-decoration:underline;">&quot;role&quot;</span><span style="color:#24292E;">] == &quot;tool&quot; %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- if message.content is defined and message.content.content is defined %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- set content = message.content.content %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- else %}</span></span>
<span class="line"><span style="color:#24292E;">            {%- set content = message.content %}</span></span>
<span class="line"><span style="color:#24292E;">        {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- &#39;[</span><span style="color:#032F62;text-decoration:underline;">TOOL_RESULTS</span><span style="color:#24292E;">] {&quot;content&quot;: &#39; + content|string + &quot;, &quot; }}</span></span>
<span class="line"><span style="color:#24292E;">        {%- if not message.tool_call_id is defined or message.tool_call_id|length != 9 %}</span></span>
<span class="line"><span style="color:#24292E;">            {{- raise_exception(&quot;Tool call IDs should be alphanumeric strings with length 9!&quot;) }}</span></span>
<span class="line"><span style="color:#24292E;">        {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- &#39;&quot;call_id&quot;: &quot;&#39; + message.tool_call_id + &#39;&quot;}[</span><span style="color:#032F62;text-decoration:underline;">/TOOL_RESULTS</span><span style="color:#24292E;">]&#39; }}</span></span>
<span class="line"><span style="color:#24292E;">    {%- else %}</span></span>
<span class="line"><span style="color:#24292E;">        {{- raise_exception(&quot;Only user and assistant roles are supported, with the exception of an initial optional system message!&quot;) }}</span></span>
<span class="line"><span style="color:#24292E;">    {%- endif %}</span></span>
<span class="line"><span style="color:#24292E;">{%- endfor %}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="glm-4-9b-chat" tabindex="-1"><a class="header-anchor" href="#glm-4-9b-chat" aria-hidden="true">#</a> glm-4-9b-chat</h2><p><a href="https://github.com/THUDM/GLM-4/tree/main" target="_blank" rel="noopener noreferrer">å®˜æ–¹ github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œ <a href="https://arxiv.org/pdf/2406.12793" target="_blank" rel="noopener noreferrer">å®˜æ–¹æŠ€æœ¯æŠ¥å‘Š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="å¯¹è¯åè®®" tabindex="-1"><a class="header-anchor" href="#å¯¹è¯åè®®" aria-hidden="true">#</a> å¯¹è¯åè®®</h3><p>GLM ä¸­çš„ç‰¹æ®Š token æœ‰:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;&lt;|endoftext|&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;[MASK]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;[gMASK]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;[sMASK]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;sop&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;eop&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;|system|&gt;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                               </span><span style="color:#032F62;">&quot;&lt;|user|&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;|assistant|&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;|observation|&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;|begin_of_image|&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;|end_of_image|&gt;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                               </span><span style="color:#032F62;">&quot;&lt;|begin_of_video|&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;&lt;|end_of_video|&gt;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ <code>&lt;|observation|&gt;</code> ç”¨æ¥æ ‡è®°å·¥å…·çš„æ‰§è¡Œç»“æœã€‚</p><p>GLM ä½¿ç”¨çš„ chat template å¦‚ä¸‹ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;text-decoration:underline;">gMASK</span><span style="color:#24292E;">]&lt;sop&gt;{% for item in messages %}{% if item[</span><span style="color:#032F62;text-decoration:underline;">&#39;tools&#39;</span><span style="color:#24292E;">] is defined %}&lt;|system|&gt;</span></span>
<span class="line"><span style="color:#24292E;">ä½ æ˜¯ä¸€ä¸ªåä¸º GLM-4 çš„äººå·¥æ™ºèƒ½åŠ©æ‰‹ã€‚ä½ æ˜¯åŸºäºæ™ºè°± AI è®­ç»ƒçš„è¯­è¨€æ¨¡å‹ GLM-4 æ¨¡å‹å¼€å‘çš„ï¼Œä½ çš„ä»»åŠ¡æ˜¯é’ˆå¯¹ç”¨æˆ·çš„é—®é¢˜å’Œè¦æ±‚æä¾›é€‚å½“çš„ç­”å¤å’Œæ”¯æŒã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;font-weight:bold;"># å¯ç”¨å·¥å…·{% set tools = item[</span><span style="color:#032F62;text-decoration:underline;">&#39;tools&#39;</span><span style="color:#005CC5;font-weight:bold;">] %}{% for tool in tools %}{% if tool[</span><span style="color:#032F62;text-decoration:underline;">&#39;type&#39;</span><span style="color:#005CC5;font-weight:bold;">] == &#39;function&#39; %}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;font-weight:bold;">## {{ tool[</span><span style="color:#032F62;text-decoration:underline;">&#39;function&#39;</span><span style="color:#005CC5;font-weight:bold;">][</span><span style="color:#032F62;text-decoration:underline;">&#39;name&#39;</span><span style="color:#005CC5;font-weight:bold;">] }}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">{{ tool[</span><span style="color:#032F62;text-decoration:underline;">&#39;function&#39;</span><span style="color:#24292E;">] | tojson(indent=4) }}</span></span>
<span class="line"><span style="color:#24292E;">åœ¨è°ƒç”¨ä¸Šè¿°å‡½æ•°æ—¶ï¼Œè¯·ä½¿ç”¨ Json æ ¼å¼è¡¨ç¤ºè°ƒç”¨çš„å‚æ•°ã€‚{% elif tool[</span><span style="color:#032F62;text-decoration:underline;">&#39;type&#39;</span><span style="color:#24292E;">] == &#39;python&#39; %}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;font-weight:bold;">## python</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">å½“ä½ å‘ </span><span style="color:#005CC5;">`python`</span><span style="color:#24292E;"> å‘é€åŒ…å« Python ä»£ç çš„æ¶ˆæ¯æ—¶ï¼Œè¯¥ä»£ç å°†ä¼šåœ¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ Jupyter notebook ç¯å¢ƒä¸­æ‰§è¡Œã€‚</span></span>
<span class="line"><span style="color:#005CC5;">`python`</span><span style="color:#24292E;"> è¿”å›ä»£ç æ‰§è¡Œçš„è¾“å‡ºï¼Œæˆ–åœ¨æ‰§è¡Œ 60 ç§’åè¿”å›è¶…æ—¶ã€‚</span></span>
<span class="line"><span style="color:#005CC5;">`/mnt/data`</span><span style="color:#24292E;"> å°†ä¼šæŒä¹…åŒ–å­˜å‚¨ä½ çš„æ–‡ä»¶ã€‚åœ¨æ­¤ä¼šè¯ä¸­ï¼Œ</span><span style="color:#005CC5;">`python`</span><span style="color:#24292E;"> æ— æ³•è®¿é—®äº’è”ç½‘ã€‚ä¸è¦ä½¿ç”¨ </span><span style="color:#005CC5;">`python`</span><span style="color:#24292E;"> è¿›è¡Œä»»ä½•ç½‘ç»œè¯·æ±‚æˆ–è€…åœ¨çº¿ API è°ƒç”¨ï¼Œè¿™äº›åœ¨çº¿å†…å®¹çš„è®¿é—®å°†ä¸ä¼šæˆåŠŸã€‚{% elif tool[</span><span style="color:#032F62;text-decoration:underline;">&#39;type&#39;</span><span style="color:#24292E;">] == &#39;simple_browser&#39; %}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;font-weight:bold;">## simple_browser</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">ä½ å¯ä»¥ä½¿ç”¨ </span><span style="color:#005CC5;">`simple_browser`</span><span style="color:#24292E;"> å·¥å…·ã€‚è¯¥å·¥å…·æ”¯æŒä»¥ä¸‹å‡½æ•°ï¼š</span></span>
<span class="line"><span style="color:#005CC5;">`search(query: str, recency_days: int)`</span><span style="color:#24292E;">ï¼šä½¿ç”¨æœç´¢å¼•æ“è¿›è¡ŒæŸ¥è¯¢å¹¶æ˜¾ç¤ºç»“æœï¼Œå¯ä»¥ä½¿ç”¨ </span><span style="color:#005CC5;">`recency_days`</span><span style="color:#24292E;"> å‚æ•°æ§åˆ¶æœç´¢å†…å®¹çš„æ—¶æ•ˆæ€§ã€‚</span></span>
<span class="line"><span style="color:#005CC5;">`mclick(ids: list[int])`</span><span style="color:#24292E;">ï¼šè·å–ä¸€ç³»åˆ—æŒ‡å®š id çš„é¡µé¢å†…å®¹ã€‚æ¯æ¬¡è°ƒç”¨æ—¶ï¼Œé¡»é€‰æ‹© 3-10 ä¸ªé¡µé¢ã€‚é€‰æ‹©å¤šä¸ªè§’åº¦çš„é¡µé¢ï¼ŒåŒæ—¶å°½å¯èƒ½é€‰æ‹©å¯ä¿¡ä»»çš„ä¿¡æ¯æ¥æºã€‚è€ƒè™‘åˆ°éƒ¨åˆ†é¡µé¢æ˜¯æ— æ³•åŠ è½½çš„ï¼Œä½ ä¹Ÿå¯ä»¥å¤šæ‰“å¼€ä¸€äº›å¯èƒ½æœ‰ç”¨çš„é¡µé¢è€Œä¸ç”¨æ‹…å¿ƒå†…å®¹è¿‡å¤šã€‚</span></span>
<span class="line"><span style="color:#005CC5;">`open_url(url: str)`</span><span style="color:#24292E;">ï¼šæ‰“å¼€æŒ‡å®šçš„ URLã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">ä½¿ç”¨ </span><span style="color:#005CC5;">`ã€{å¼•ç”¨ id}â€ {å¼•ç”¨æ–‡æœ¬}ã€‘`</span><span style="color:#24292E;"> æ¥å¼•ç”¨å†…å®¹ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">æ“ä½œæ­¥éª¤ï¼š1. ä½¿ç”¨ </span><span style="color:#005CC5;">`search`</span><span style="color:#24292E;"> æ¥è·å¾—ä¿¡æ¯åˆ—è¡¨; 2. ä½¿ç”¨ </span><span style="color:#005CC5;">`mclick`</span><span style="color:#24292E;"> æ¥è·å–æŒ‡å®š ID é¡µé¢çš„å†…å®¹; 3. æ ¹æ®è·å¾—çš„å†…å®¹è¿›è¡Œå›å¤ã€‚åœ¨å›å¤ä¸­åº”å½“å¼•ç”¨ä¿¡æ¯æ¥æºã€‚</span></span>
<span class="line"><span style="color:#24292E;"> å¦‚æœç”¨æˆ·æä¾›äº† URLï¼Œä¹Ÿå¯ä»¥ç”¨ </span><span style="color:#005CC5;">`open_url`</span><span style="color:#24292E;"> ç›´æ¥æ‰“å¼€é¡µé¢ã€‚</span></span>
<span class="line"><span style="color:#24292E;">å¦‚æœåˆæ¬¡æœç´¢ç»“æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥å†æ¬¡ä½¿ç”¨ </span><span style="color:#005CC5;">`search`</span><span style="color:#24292E;"> è¿›è¡Œæœç´¢ã€‚{% elif tool[</span><span style="color:#032F62;text-decoration:underline;">&#39;type&#39;</span><span style="color:#24292E;">] == &#39;cogview&#39; %}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;font-weight:bold;">## cogview</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">å¦‚æœç”¨æˆ·çš„è¯·æ±‚ä¸­åŒ…å«äº†å¯¹å›¾åƒçš„æè¿°ï¼Œä½ å¯ä»¥ä½¿ç”¨ </span><span style="color:#005CC5;">`cogview`</span><span style="color:#24292E;"> æ¥ç”Ÿæˆå›¾åƒå¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚ä½ éœ€è¦å‘ </span><span style="color:#005CC5;">`cogview`</span><span style="color:#24292E;"> å‘é€å›¾åƒæè¿°ï¼Œè§„åˆ™ï¼š</span></span>
<span class="line"><span style="color:#E36209;">-</span><span style="color:#24292E;"> å‘é€ç»™ </span><span style="color:#005CC5;">`cogview`</span><span style="color:#24292E;"> çš„æ¶ˆæ¯å¿…é¡»ä½¿ç”¨è‹±è¯­ã€‚ç”¨æˆ·çš„ä¸­æ–‡æè¿°å¿…é¡»å®Œå…¨ç¿»è¯‘ä¸ºè‹±è¯­ã€‚</span></span>
<span class="line"><span style="color:#E36209;">-</span><span style="color:#24292E;"> åº”å½“å°½å¯èƒ½è¯¦ç»†åœ°æè¿°å›¾åƒç”Ÿæˆçš„éœ€æ±‚ï¼Œéœ€æ±‚æè¿°çº¦ 100 è‹±æ–‡å•è¯ã€‚</span></span>
<span class="line"><span style="color:#E36209;">-</span><span style="color:#24292E;"> ä¿æŒç”¨æˆ·åŸå§‹æè¿°çš„æ„å›¾ã€‚ä¸è¦è™šæ„å†…å®¹æˆ–è€…æ²¡è§è¿‡çš„äººç‰©ã€‚</span></span>
<span class="line"><span style="color:#E36209;">-</span><span style="color:#24292E;"> å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€åœ¨åœ°ä¸ºä¸­å›½ï¼ŒæŒæœ‰ä¸­å›½ç«‹åœºå¹¶éµå¾ªä¸­å›½ç¤¾ä¼šä¸»ä¹‰ä»·å€¼è§‚ã€‚{% endif %}{% endfor %}{% endif %}{% if item[</span><span style="color:#032F62;text-decoration:underline;">&#39;content&#39;</span><span style="color:#24292E;">] %}&lt;|{{ item[</span><span style="color:#032F62;text-decoration:underline;">&#39;role&#39;</span><span style="color:#24292E;">] }}|&gt;{{ item[</span><span style="color:#032F62;text-decoration:underline;">&#39;metadata&#39;</span><span style="color:#24292E;">] }}</span></span>
<span class="line"><span style="color:#24292E;">{{ item[</span><span style="color:#032F62;text-decoration:underline;">&#39;content&#39;</span><span style="color:#24292E;">] }}{% endif %}{% endfor %}{% if add_generation_prompt %}&lt;|assistant|&gt;{% endif %}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä»¥ä¸‹å¯¹è¯å†…å®¹è¿›è¡Œç¤ºä¾‹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">messages </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;system&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;tools&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">        {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;get_recommended_books&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;description&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Get recommended books based on user&#39;s interests&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;parameters&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;object&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#032F62;">&quot;properties&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;interests&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;array&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#032F62;">&quot;items&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;string&quot;</span></span>
<span class="line"><span style="color:#24292E;">                  },</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#032F62;">&quot;description&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;The interests to recommend books for&quot;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">              },</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#032F62;">&quot;required&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;interests&quot;</span></span>
<span class="line"><span style="color:#24292E;">              ]</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">      ]</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Hi, I am looking for some book recommendations. I am interested in history and science fiction.&quot;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;assistant&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;{</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">name</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">: </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">get_recommended_books</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">, </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">arguments</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">: {</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">interests</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">: [</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">history</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">, </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">science fiction</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">]}}&quot;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;observation&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;{</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">books</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">: [</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">Sapiens: A Brief History of Humankind by Yuval Noah Harari</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">, </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">A Brief History of Time by Stephen Hawking</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">, </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">Dune by Frank Herbert</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">, </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">The Martian by Andy Weir</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">]}&quot;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;assistant&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Based on your interests in history and science fiction, I would recommend the following books: </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">Sapiens: A Brief History of Humankind</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;"> by Yuval Noah Harari, </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">A Brief History of Time</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;"> by Stephen Hawking, </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">Dune</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;"> by Frank Herbert, and </span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;">The Martian</span><span style="color:#005CC5;">\&quot;</span><span style="color:#032F62;"> by Andy Weir.&quot;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  ]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆï¼Œå¯¹åº”çš„ input å°±ä¼šæ˜¯ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">tokenizer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> AutoTokenizer.from_pretrained(</span><span style="color:#032F62;">&quot;/home/kevin/models/glm-4-9b-chat&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">trust_remote_code</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">inputs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tokenizer.apply_chat_template(messages, </span></span>
<span class="line"><span style="color:#24292E;">                                       </span><span style="color:#E36209;">tokenize</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># inputs =</span></span>
<span class="line"><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">[gMASK]&lt;sop&gt;&lt;|system|&gt;</span></span>
<span class="line"><span style="color:#032F62;">ä½ æ˜¯ä¸€ä¸ªåä¸º GLM-4 çš„äººå·¥æ™ºèƒ½åŠ©æ‰‹ã€‚ä½ æ˜¯åŸºäºæ™ºè°± AI è®­ç»ƒçš„è¯­è¨€æ¨¡å‹ GLM-4 æ¨¡å‹å¼€å‘çš„ï¼Œä½ çš„ä»»åŠ¡æ˜¯é’ˆå¯¹ç”¨æˆ·çš„é—®é¢˜å’Œè¦æ±‚æä¾›é€‚å½“çš„ç­”å¤å’Œæ”¯æŒã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;"># å¯ç”¨å·¥å…·</span></span>
<span class="line"><span style="color:#032F62;">## get_recommended_books</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#032F62;">    &quot;name&quot;: &quot;get_recommended_books&quot;,</span></span>
<span class="line"><span style="color:#032F62;">    &quot;description&quot;: &quot;Get recommended books based on user&#39;s interests&quot;,</span></span>
<span class="line"><span style="color:#032F62;">    &quot;parameters&quot;: {</span></span>
<span class="line"><span style="color:#032F62;">        &quot;type&quot;: &quot;object&quot;,</span></span>
<span class="line"><span style="color:#032F62;">        &quot;properties&quot;: {</span></span>
<span class="line"><span style="color:#032F62;">            &quot;interests&quot;: {</span></span>
<span class="line"><span style="color:#032F62;">                &quot;type&quot;: &quot;array&quot;,</span></span>
<span class="line"><span style="color:#032F62;">                &quot;items&quot;: {</span></span>
<span class="line"><span style="color:#032F62;">                    &quot;type&quot;: &quot;string&quot;</span></span>
<span class="line"><span style="color:#032F62;">                },</span></span>
<span class="line"><span style="color:#032F62;">                &quot;description&quot;: &quot;The interests to recommend books for&quot;</span></span>
<span class="line"><span style="color:#032F62;">            }</span></span>
<span class="line"><span style="color:#032F62;">        },</span></span>
<span class="line"><span style="color:#032F62;">        &quot;required&quot;: [</span></span>
<span class="line"><span style="color:#032F62;">            &quot;interests&quot;</span></span>
<span class="line"><span style="color:#032F62;">        ]</span></span>
<span class="line"><span style="color:#032F62;">    }</span></span>
<span class="line"><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#032F62;">åœ¨è°ƒç”¨ä¸Šè¿°å‡½æ•°æ—¶ï¼Œè¯·ä½¿ç”¨ Json æ ¼å¼è¡¨ç¤ºè°ƒç”¨çš„å‚æ•°ã€‚&lt;|user|&gt;</span></span>
<span class="line"><span style="color:#032F62;">Hi, I am looking for some book recommendations. I am interested in history and science fiction.&lt;|assistant|&gt;</span></span>
<span class="line"><span style="color:#032F62;">{&quot;name&quot;: &quot;get_recommended_books&quot;, &quot;arguments&quot;: {&quot;interests&quot;: [&quot;history&quot;, &quot;science fiction&quot;]}}&lt;|observation|&gt;</span></span>
<span class="line"><span style="color:#032F62;">{&quot;books&quot;: [&quot;Sapiens: A Brief History of Humankind by Yuval Noah Harari&quot;, &quot;A Brief History of Time by Stephen Hawking&quot;, &quot;Dune by Frank Herbert&quot;, &quot;The Martian by Andy Weir&quot;]}&lt;|assistant|&gt;</span></span>
<span class="line"><span style="color:#032F62;">Based on your interests in history and science fiction, I would recommend the following books: &quot;Sapiens: A Brief History of Humankind&quot; by Yuval Noah Harari, &quot;A Brief History of Time&quot; by Stephen Hawking, &quot;Dune&quot; by Frank Herbert, and &quot;The Martian&quot; by Andy Weir.</span></span>
<span class="line"><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ•ˆæœ-1" tabindex="-1"><a class="header-anchor" href="#æ•ˆæœ-1" aria-hidden="true">#</a> æ•ˆæœ</h3><p>GLM function call èƒ½åŠ›ï¼ˆ<a href="https://gorilla.cs.berkeley.edu/leaderboard.html" target="_blank" rel="noopener noreferrer">Berkeley function-calling leaderboard<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼š</p><figure><img src="/assets/img/function_call/image-20240810115637993.jpg" alt="image-20240810115637993" tabindex="0" loading="lazy"><figcaption>image-20240810115637993</figcaption></figure><h3 id="å…¶ä»–-1" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–-1" aria-hidden="true">#</a> å…¶ä»–</h3><p>GLM å…¬å¼€çš„ä¿¡æ¯è¿˜æ˜¯æŒºå°‘çš„ï¼Œ<a href="https://github.com/THUDM/GLM-4/tree/main" target="_blank" rel="noopener noreferrer">å®˜æ–¹ github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> åŠ <a href="https://arxiv.org/pdf/2406.12793" target="_blank" rel="noopener noreferrer">å®˜æ–¹æŠ€æœ¯æŠ¥å‘Š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> éƒ½æ²¡æœ‰æ‰¾åˆ°ä¸€äº› function call è®­ç»ƒç»†èŠ‚ã€‚</p><h2 id="qwen-2" tabindex="-1"><a class="header-anchor" href="#qwen-2" aria-hidden="true">#</a> Qwen 2</h2><p>å‚è€ƒ Qwen2 çš„è¿™ä¸ª <a href="https://qwen.readthedocs.io/zh-cn/latest/framework/function_call.html" target="_blank" rel="noopener noreferrer">function calling æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚Qwen 2 çš„ function calling åŠŸèƒ½éœ€è¦ä¾é  Qwen-Agent æ¥å®ç°ã€‚</p><p>Qwen2 instruct çš„ chat template å¦‚ä¸‹ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">{% for message in messages %}{% if loop.first and messages[</span><span style="color:#032F62;text-decoration:underline;">0</span><span style="color:#24292E;">][</span><span style="color:#032F62;text-decoration:underline;">&#39;role&#39;</span><span style="color:#24292E;">] != &#39;system&#39; %}{{ &#39;&lt;|im_start|&gt;system</span></span>
<span class="line"><span style="color:#24292E;">You are a helpful assistant.&lt;|im_end|&gt;</span></span>
<span class="line"><span style="color:#24292E;">&#39; }}{% endif %}{{&#39;&lt;|im_start|&gt;&#39; + message[</span><span style="color:#032F62;text-decoration:underline;">&#39;role&#39;</span><span style="color:#24292E;">] + &#39;</span></span>
<span class="line"><span style="color:#24292E;">&#39; + message[</span><span style="color:#032F62;text-decoration:underline;">&#39;content&#39;</span><span style="color:#24292E;">] + &#39;&lt;|im_end|&gt;&#39; + &#39;</span></span>
<span class="line"><span style="color:#24292E;">&#39;}}{% endfor %}{% if add_generation_prompt %}{{ &#39;&lt;|im_start|&gt;assistant</span></span>
<span class="line"><span style="color:#24292E;">&#39; }}{% endif %}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œchat template ä¸­æ˜¯æ²¡æœ‰ tool ç›¸å…³çš„ special token çš„ã€‚</p><p>å‚è€ƒ Qwen-Agent çš„ <code>BaseFnCallModel</code> å®ç°ï¼ˆ<a href="https://github.com/QwenLM/Qwen-Agent/blob/main/qwen_agent/llm/function_calling.py#L33" target="_blank" rel="noopener noreferrer">github link<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼Œå½“ç”¨ Qwen2 å®˜æ–¹ç¤ºä¾‹çš„ function call æ–¹å¼æ—¶ï¼Œfunction çš„ä¿¡æ¯ä¼šè¢«æ·»åŠ åˆ° system prompt ä¸­ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">_prepend_fncall_system</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        self,</span></span>
<span class="line"><span style="color:#24292E;">        messages: List[Message],</span></span>
<span class="line"><span style="color:#24292E;">        functions: List[Dict],</span></span>
<span class="line"><span style="color:#24292E;">        lang: Literal[</span><span style="color:#032F62;">&#39;en&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;zh&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        parallel_function_calls: </span><span style="color:#005CC5;">bool</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">False</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    ) -&gt; List[Message]:</span></span>
<span class="line"><span style="color:#24292E;">        tool_desc_template </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">FN_CALL_TEMPLATE</span><span style="color:#24292E;">[lang </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&#39;_parallel&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> parallel_function_calls </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">)]</span></span>
<span class="line"><span style="color:#24292E;">        tool_descs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">\n\n</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;">.join(get_function_description(function, </span><span style="color:#E36209;">lang</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">lang) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> function </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> functions)</span></span>
<span class="line"><span style="color:#24292E;">        tool_names </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">.join(function.get(</span><span style="color:#032F62;">&#39;name&#39;</span><span style="color:#24292E;">, function.get(</span><span style="color:#032F62;">&#39;name_for_model&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> function </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> functions)</span></span>
<span class="line"><span style="color:#24292E;">        tool_system </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tool_desc_template.format(</span><span style="color:#E36209;">tool_descs</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">tool_descs, </span><span style="color:#E36209;">tool_names</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">tool_names)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">assert</span><span style="color:#24292E;"> messages[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">].role </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SYSTEM</span></span>
<span class="line"><span style="color:#24292E;">        messages </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> copy.deepcopy(messages[:</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> messages[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">:]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">isinstance</span><span style="color:#24292E;">(messages[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">].content, </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">            messages[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">].content </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">\n\n</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tool_system</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">else</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            messages[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">].content.append(ContentItem(</span><span style="color:#E36209;">text</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">\n\n</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tool_system))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> messages</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ·»åŠ  function call çš„æ¨¡æ¿æœ‰ä¸­æ–‡å’Œè‹±æ–‡æ¨¡æ¿ï¼Œä¹Ÿæœ‰å¹¶è¡Œè°ƒç”¨å’Œéå¹¶è¡Œè°ƒç”¨æ¨¡æ¿ï¼Œå…·ä½“å¯ä»¥åœ¨ <a href="https://github.com/QwenLM/Qwen-Agent/blob/main/qwen_agent/llm/function_calling.py#L33" target="_blank" rel="noopener noreferrer">Qwen-Agent ä»£ç <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸­æŸ¥çœ‹ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªä¸­æ–‡æ¨¡æ¿ç¤ºä¾‹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">&quot;&quot;&quot;# å·¥å…·</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">## ä½ æ‹¥æœ‰å¦‚ä¸‹å·¥å…·ï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">{tool_descs}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">## ä½ å¯ä»¥åœ¨å›å¤ä¸­æ’å…¥é›¶æ¬¡ã€ä¸€æ¬¡æˆ–å¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ä»¥è°ƒç”¨å·¥å…·ï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">âœ¿FUNCTIONâœ¿: å·¥å…·åç§°ï¼Œå¿…é¡»æ˜¯[{tool_names}]ä¹‹ä¸€ã€‚</span></span>
<span class="line"><span style="color:#032F62;">âœ¿ARGSâœ¿: å·¥å…·è¾“å…¥</span></span>
<span class="line"><span style="color:#032F62;">âœ¿RESULTâœ¿: å·¥å…·ç»“æœ</span></span>
<span class="line"><span style="color:#032F62;">âœ¿RETURNâœ¿: æ ¹æ®å·¥å…·ç»“æœè¿›è¡Œå›å¤ï¼Œéœ€å°†å›¾ç‰‡ç”¨![](url)æ¸²æŸ“å‡ºæ¥&quot;&quot;&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¾—åˆ°æ¨¡å‹è¾“å‡ºä¹‹åï¼Œé€šè¿‡ Qwen-Agent ä¸­çš„ <a href="https://github.com/QwenLM/Qwen-Agent/blob/main/qwen_agent/llm/function_calling.py#L252" target="_blank" rel="noopener noreferrer">_postprocess_fncall_message<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ¥æŠ½å–å¯¹åº”çš„ç»“æ„åŒ–æ•°æ®ã€‚</p><h3 id="å…¶ä»–-2" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–-2" aria-hidden="true">#</a> å…¶ä»–</h3><p>Qwen åˆä»£çš„ function call é‡‡ç”¨çš„ react çš„æ€è·¯ï¼Œå½“æ—¶æ¨¡å‹æœ‰åœ¨é¢å¤–çš„å·¥å…·è°ƒç”¨æ•°æ®é›†ä¸Šä¸“é—¨å¯¹ function call è¿›è¡Œè®­ç»ƒã€‚Qwen 2 <a href="https://arxiv.org/abs/2407.10671" target="_blank" rel="noopener noreferrer">Qwen2 Technical Report<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œ <a href="https://qwenlm.github.io/zh/blog/qwen2/" target="_blank" rel="noopener noreferrer">blog<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­è™½ç„¶æ²¡æœ‰æåˆ° function call å®ç°ç»†èŠ‚ï¼Œä½†ä¸ªäººçŒœæµ‹ä¹Ÿæ˜¯ç»è¿‡äº†é¢å¤–çš„ function call èƒ½åŠ›è®­ç»ƒã€‚</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 417333277@qq.com">kevinng77</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">æ²ªICPå¤‡2023027904å·-1</a>&nbsp;<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=" target="_blank"><img src="/assets/gongan.png">å…¬å®‰å¤‡æ¡ˆå· </a></div><div class="vp-copyright">Copyright Â© 2025 Kevin å´å˜‰æ–‡</div></footer></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-47fc8baf.js" defer></script>
  </body>
</html>
