<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://antarina.tech/posts/notes/articles/%E7%AC%94%E8%AE%B0k8s.html"><meta property="og:site_name" content="è®°å¿†ç¬”ä¹¦"><meta property="og:title" content="Kubernetes è¯¦ç»†æ•™ç¨‹(ä¸Š)"><meta property="og:description" content="æ¥æºç¬”è®° Kubernetes(K8S) å…¥é—¨è¿›é˜¶å®æˆ˜å®Œæ•´æ•™ç¨‹ï¼Œé»‘é©¬ç¨‹åºå‘˜ K8S å…¨å¥—æ•™ç¨‹ 1. Kubernetes ä»‹ç» 1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜ åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ä¸Šï¼Œä¸»è¦ç»å†äº†ä¸‰ä¸ªæ—¶ä»£ï¼š"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-03-26T07:48:04.000Z"><meta property="article:author" content="Kevin å´å˜‰æ–‡"><meta property="article:tag" content="Linux"><meta property="article:published_time" content="2022-12-25T00:00:00.000Z"><meta property="article:modified_time" content="2023-03-26T07:48:04.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Kubernetes è¯¦ç»†æ•™ç¨‹(ä¸Š)","image":[""],"datePublished":"2022-12-25T00:00:00.000Z","dateModified":"2023-03-26T07:48:04.000Z","author":[{"@type":"Person","name":"Kevin å´å˜‰æ–‡"}]}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link rel="icon" href="/logo.svg"><title>Kubernetes è¯¦ç»†æ•™ç¨‹(ä¸Š) | è®°å¿†ç¬”ä¹¦</title><meta name="description" content="æ¥æºç¬”è®° Kubernetes(K8S) å…¥é—¨è¿›é˜¶å®æˆ˜å®Œæ•´æ•™ç¨‹ï¼Œé»‘é©¬ç¨‹åºå‘˜ K8S å…¨å¥—æ•™ç¨‹ 1. Kubernetes ä»‹ç» 1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜ åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ä¸Šï¼Œä¸»è¦ç»å†äº†ä¸‰ä¸ªæ—¶ä»£ï¼š">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-99575b2e.css" as="style"><link rel="stylesheet" href="/assets/style-99575b2e.css">
    <link rel="modulepreload" href="/assets/app-436262f0.js"><link rel="modulepreload" href="/assets/ç¬”è®°k8s.html-2241c394.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/ç¬”è®°k8s.html-d3d25c97.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container no-sidebar has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><!----><!----><span class="vp-site-name">è®°å¿†ç¬”ä¹¦</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="ä¸»é¡µ" class="vp-link nav-link nav-link" href="/"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="å½’æ¡£" class="vp-link nav-link nav-link" href="/timeline/"><span class="font-icon icon iconfont icon-categoryselected" style=""></span>å½’æ¡£<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/kevinng77" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Kubernetes è¯¦ç»†æ•™ç¨‹(ä¸Š)</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Kevin å´å˜‰æ–‡</span></span><span property="author" content="Kevin å´å˜‰æ–‡"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-25T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 70 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT70M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category7 clickable" role="navigation">çŸ¥è¯†ç¬”è®°</span><!--]--><meta property="articleSection" content="çŸ¥è¯†ç¬”è®°"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag0 clickable" role="navigation">Linux</span><!--]--><meta property="keywords" content="Linux"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_1-kubernetes-ä»‹ç»">1. Kubernetes ä»‹ç»</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_1-1-åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜">1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_1-2-kubernetes-ç®€ä»‹">1.2 kubernetes ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_1-3-kubernetes-ç»„ä»¶">1.3 kubernetes ç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_1-4-kubernetes-æ¦‚å¿µ">1.4 kubernetes æ¦‚å¿µ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_2-kubernetes-é›†ç¾¤ç¯å¢ƒæ­å»º">2. kubernetes é›†ç¾¤ç¯å¢ƒæ­å»º</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_2-1-å‰ç½®çŸ¥è¯†ç‚¹">2.1 å‰ç½®çŸ¥è¯†ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_2-2-kubeadm-éƒ¨ç½²æ–¹å¼ä»‹ç»">2.2 kubeadm éƒ¨ç½²æ–¹å¼ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_2-3-å®‰è£…è¦æ±‚">2.3 å®‰è£…è¦æ±‚</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_2-4-æœ€ç»ˆç›®æ ‡">2.4 æœ€ç»ˆç›®æ ‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_2-5-å‡†å¤‡ç¯å¢ƒ">2.5 å‡†å¤‡ç¯å¢ƒ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_2-6-ç¯å¢ƒåˆå§‹åŒ–">2.6 ç¯å¢ƒåˆå§‹åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_2-7-é›†ç¾¤æµ‹è¯•">2.7 é›†ç¾¤æµ‹è¯•</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_3-èµ„æºç®¡ç†">3. èµ„æºç®¡ç†</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_3-1-èµ„æºç®¡ç†ä»‹ç»">3.1 èµ„æºç®¡ç†ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_3-2-yaml-è¯­è¨€ä»‹ç»">3.2 YAML è¯­è¨€ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_3-3-èµ„æºç®¡ç†æ–¹å¼">3.3 èµ„æºç®¡ç†æ–¹å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_4-å®æˆ˜å…¥é—¨">4. å®æˆ˜å…¥é—¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_4-1-namespace">4.1 Namespace</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_4-2-pod">4.2 Pod</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_4-3-label">4.3 Label</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_4-4-deployment">4.4 Deployment</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_4-5-service">4.5 Service</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_5-pod-è¯¦è§£">5. Pod è¯¦è§£</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_5-1-pod-ä»‹ç»">5.1 Pod ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_5-2-pod-é…ç½®">5.2 Pod é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_5-3-pod-ç”Ÿå‘½å‘¨æœŸ">5.3 Pod ç”Ÿå‘½å‘¨æœŸ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_5-4-pod-è°ƒåº¦">5.4 Pod è°ƒåº¦</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p>æ¥æºç¬”è®° <a href="https://www.bilibili.com/video/BV1Qv41167ck/?p=39&amp;spm_id_from=pageDriver&amp;vd_source=4418d5cd5be787be7e3ff4138eeb9b0a" target="_blank" rel="noopener noreferrer">Kubernetes(K8S) å…¥é—¨è¿›é˜¶å®æˆ˜å®Œæ•´æ•™ç¨‹ï¼Œé»‘é©¬ç¨‹åºå‘˜ K8S å…¨å¥—æ•™ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="_1-kubernetes-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-kubernetes-ä»‹ç»" aria-hidden="true">#</a> 1. Kubernetes ä»‹ç»</h2><h3 id="_1-1-åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜" tabindex="-1"><a class="header-anchor" href="#_1-1-åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜" aria-hidden="true">#</a> 1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜</h3><p>åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ä¸Šï¼Œä¸»è¦ç»å†äº†ä¸‰ä¸ªæ—¶ä»£ï¼š</p><ul><li><strong>ä¼ ç»Ÿéƒ¨ç½²</strong> ï¼šäº’è”ç½‘æ—©æœŸï¼Œä¼šç›´æ¥å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ç‰©ç†æœºä¸Š</li></ul><blockquote><p>ä¼˜ç‚¹ï¼šç®€å•ï¼Œä¸éœ€è¦å…¶å®ƒæŠ€æœ¯çš„å‚ä¸</p><p>ç¼ºç‚¹ï¼šä¸èƒ½ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰èµ„æºä½¿ç”¨è¾¹ç•Œï¼Œå¾ˆéš¾åˆç†åœ°åˆ†é…è®¡ç®—èµ„æºï¼Œè€Œä¸”ç¨‹åºä¹‹é—´å®¹æ˜“äº§ç”Ÿå½±å“</p></blockquote><ul><li><strong>è™šæ‹ŸåŒ–éƒ¨ç½²</strong> ï¼šå¯ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªç¯å¢ƒ</li></ul><blockquote><p>ä¼˜ç‚¹ï¼šç¨‹åºç¯å¢ƒä¸ä¼šç›¸äº’äº§ç”Ÿå½±å“ï¼Œæä¾›äº†ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§</p><p>ç¼ºç‚¹ï¼šå¢åŠ äº†æ“ä½œç³»ç»Ÿï¼Œæµªè´¹äº†éƒ¨åˆ†èµ„æº</p></blockquote><ul><li><strong>å®¹å™¨åŒ–éƒ¨ç½²</strong> ï¼šä¸è™šæ‹ŸåŒ–ç±»ä¼¼ï¼Œä½†æ˜¯å…±äº«äº†æ“ä½œç³»ç»Ÿ</li></ul><blockquote><p>ä¼˜ç‚¹ï¼š</p><p>å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰</p><p>è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„èµ„æºéƒ½è¢«å®¹å™¨åŒ…è£…ï¼Œå¹¶å’Œåº•å±‚åŸºç¡€æ¶æ„è§£è€¦</p><p>å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºå¯ä»¥è·¨äº‘æœåŠ¡å•†ã€è·¨ Linux æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆè¿›è¡Œéƒ¨ç½²</p></blockquote><figure><img src="/assets/img/k8s/image-20200505183738289.png" alt="image-20200505183738289" tabindex="0" loading="lazy"><figcaption>image-20200505183738289</figcaption></figure><p>å®¹å™¨åŒ–éƒ¨ç½²æ–¹å¼ç»™å¸¦æ¥å¾ˆå¤šçš„ä¾¿åˆ©ï¼Œä½†æ˜¯ä¹Ÿä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>ä¸€ä¸ªå®¹å™¨æ•…éšœåœæœºäº†ï¼Œæ€ä¹ˆæ ·è®©å¦å¤–ä¸€ä¸ªå®¹å™¨ç«‹åˆ»å¯åŠ¨å»æ›¿è¡¥åœæœºçš„å®¹å™¨</li><li>å½“å¹¶å‘è®¿é—®é‡å˜å¤§çš„æ—¶å€™ï¼Œæ€ä¹ˆæ ·åšåˆ°æ¨ªå‘æ‰©å±•å®¹å™¨æ•°é‡</li></ul><p>è¿™äº›å®¹å™¨ç®¡ç†çš„é—®é¢˜ç»Ÿç§°ä¸º <strong>å®¹å™¨ç¼–æ’</strong> é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›å®¹å™¨ç¼–æ’é—®é¢˜ï¼Œå°±äº§ç”Ÿäº†ä¸€äº›å®¹å™¨ç¼–æ’çš„è½¯ä»¶ï¼š</p><ul><li><strong>Swarm</strong> ï¼šDocker è‡ªå·±çš„å®¹å™¨ç¼–æ’å·¥å…·</li><li><strong>Mesos</strong> ï¼šApache çš„ä¸€ä¸ªèµ„æºç»Ÿä¸€ç®¡æ§çš„å·¥å…·ï¼Œéœ€è¦å’Œ Marathon ç»“åˆä½¿ç”¨</li><li><strong>Kubernetes</strong> ï¼šGoogle å¼€æºçš„çš„å®¹å™¨ç¼–æ’å·¥å…·</li></ul><figure><img src="/assets/img/k8s/image-20200524150339551.png" alt="image-20200524150339551" tabindex="0" loading="lazy"><figcaption>image-20200524150339551</figcaption></figure><h3 id="_1-2-kubernetes-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1-2-kubernetes-ç®€ä»‹" aria-hidden="true">#</a> 1.2 kubernetes ç®€ä»‹</h3><figure><img src="/assets/img/k8s/image-20200406232838722.png" alt="image-20200406232838722" tabindex="0" loading="lazy"><figcaption>image-20200406232838722</figcaption></figure><p>kubernetesï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„åŸºäºå®¹å™¨æŠ€æœ¯çš„åˆ†å¸ƒå¼æ¶æ„é¢†å…ˆæ–¹æ¡ˆï¼Œæ˜¯è°·æ­Œä¸¥æ ¼ä¿å¯†åå‡ å¹´çš„ç§˜å¯†æ­¦å™¨----Borg ç³»ç»Ÿçš„ä¸€ä¸ªå¼€æºç‰ˆæœ¬ï¼Œäº 2014 å¹´ 9 æœˆå‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œ2015 å¹´ 7 æœˆå‘å¸ƒç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ã€‚</p><p>kubernetes çš„æœ¬è´¨æ˜¯ <strong>ä¸€ç»„æœåŠ¡å™¨é›†ç¾¤</strong> ï¼Œå®ƒå¯ä»¥åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç‰¹å®šçš„ç¨‹åºï¼Œæ¥å¯¹èŠ‚ç‚¹ä¸­çš„å®¹å™¨è¿›è¡Œç®¡ç†ã€‚ç›®çš„æ˜¯å®ç°èµ„æºç®¡ç†çš„è‡ªåŠ¨åŒ–ï¼Œä¸»è¦æä¾›äº†å¦‚ä¸‹çš„ä¸»è¦åŠŸèƒ½ï¼š</p><ul><li><strong>è‡ªæˆ‘ä¿®å¤</strong> ï¼šä¸€æ—¦æŸä¸€ä¸ªå®¹å™¨å´©æºƒï¼Œèƒ½å¤Ÿåœ¨ 1 ç§’ä¸­å·¦å³è¿…é€Ÿå¯åŠ¨æ–°çš„å®¹å™¨</li><li><strong>å¼¹æ€§ä¼¸ç¼©</strong> ï¼šå¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªåŠ¨å¯¹é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ•°é‡è¿›è¡Œè°ƒæ•´</li><li><strong>æœåŠ¡å‘ç°</strong> ï¼šæœåŠ¡å¯ä»¥é€šè¿‡è‡ªåŠ¨å‘ç°çš„å½¢å¼æ‰¾åˆ°å®ƒæ‰€ä¾èµ–çš„æœåŠ¡</li><li><strong>è´Ÿè½½å‡è¡¡</strong> ï¼šå¦‚æœä¸€ä¸ªæœåŠ¡èµ·åŠ¨äº†å¤šä¸ªå®¹å™¨ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡</li><li><strong>ç‰ˆæœ¬å›é€€</strong> ï¼šå¦‚æœå‘ç°æ–°å‘å¸ƒçš„ç¨‹åºç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›é€€åˆ°åŸæ¥çš„ç‰ˆæœ¬</li><li><strong>å­˜å‚¨ç¼–æ’</strong> ï¼šå¯ä»¥æ ¹æ®å®¹å™¨è‡ªèº«çš„éœ€æ±‚è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å·</li></ul><h3 id="_1-3-kubernetes-ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-3-kubernetes-ç»„ä»¶" aria-hidden="true">#</a> 1.3 kubernetes ç»„ä»¶</h3><p>ä¸€ä¸ª kubernetes é›†ç¾¤ä¸»è¦æ˜¯ç”± <strong>æ§åˆ¶èŠ‚ç‚¹(master)</strong> ã€ <strong>å·¥ä½œèŠ‚ç‚¹(node)</strong> æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚</p><p><strong>masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† )</strong></p><blockquote><p><strong>ApiServer</strong> : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€API æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶</p><p><strong>Scheduler</strong> : è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°ç›¸åº”çš„ node èŠ‚ç‚¹ä¸Š</p><p><strong>ControllerManager</strong> : è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰</p><p><strong>Etcd</strong> ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯</p></blockquote><p><strong>nodeï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ( å¹²æ´» )</strong></p><blockquote><p><strong>Kubelet</strong> : è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶ dockerï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨</p><p><strong>KubeProxy</strong> : è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</p><p><strong>Docker</strong> : è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ</p></blockquote><figure><img src="/assets/img/k8s/image-20200406184656917.png" alt="ç›¸å…³å›¾ç‰‡" height="300" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><p>ä¸‹é¢ï¼Œä»¥éƒ¨ç½²ä¸€ä¸ª nginx æœåŠ¡æ¥è¯´æ˜ kubernetes ç³»ç»Ÿå„ä¸ªç»„ä»¶è°ƒç”¨å…³ç³»ï¼š</p><ol><li><p>é¦–å…ˆè¦æ˜ç¡®ï¼Œä¸€æ—¦ kubernetes ç¯å¢ƒå¯åŠ¨ä¹‹åï¼Œmaster å’Œ node éƒ½ä¼šå°†è‡ªèº«çš„ä¿¡æ¯å­˜å‚¨åˆ° etcd æ•°æ®åº“ä¸­</p></li><li><p>ä¸€ä¸ª nginx æœåŠ¡çš„å®‰è£…è¯·æ±‚ä¼šé¦–å…ˆè¢«å‘é€åˆ° master èŠ‚ç‚¹çš„ apiServer ç»„ä»¶</p></li><li><p>apiServer ç»„ä»¶ä¼šè°ƒç”¨ scheduler ç»„ä»¶æ¥å†³å®šåˆ°åº•åº”è¯¥æŠŠè¿™ä¸ªæœåŠ¡å®‰è£…åˆ°å“ªä¸ª node èŠ‚ç‚¹ä¸Š</p><p>åœ¨æ­¤æ—¶ï¼Œå®ƒä¼šä» etcd ä¸­è¯»å–å„ä¸ª node èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥ apiServer</p></li><li><p>apiServer è°ƒç”¨ controller-manager å»è°ƒåº¦ Node èŠ‚ç‚¹å®‰è£… nginx æœåŠ¡</p></li><li><p>kubelet æ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šé€šçŸ¥ dockerï¼Œç„¶åç”± docker æ¥å¯åŠ¨ä¸€ä¸ª nginx çš„ pod</p><p>pod æ˜¯ kubernetes çš„æœ€å°æ“ä½œå•å…ƒï¼Œå®¹å™¨å¿…é¡»è·‘åœ¨ pod ä¸­è‡³æ­¤ï¼Œ</p></li><li><p>ä¸€ä¸ª nginx æœåŠ¡å°±è¿è¡Œäº†ï¼Œå¦‚æœéœ€è¦è®¿é—® nginxï¼Œå°±éœ€è¦é€šè¿‡ kube-proxy æ¥å¯¹ pod äº§ç”Ÿè®¿é—®çš„ä»£ç†</p></li></ol><p>è¿™æ ·ï¼Œå¤–ç•Œç”¨æˆ·å°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„ nginx æœåŠ¡äº†</p><h3 id="_1-4-kubernetes-æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-4-kubernetes-æ¦‚å¿µ" aria-hidden="true">#</a> 1.4 kubernetes æ¦‚å¿µ</h3><p><strong>Master</strong> ï¼šé›†ç¾¤æ§åˆ¶èŠ‚ç‚¹ï¼Œæ¯ä¸ªé›†ç¾¤éœ€è¦è‡³å°‘ä¸€ä¸ª master èŠ‚ç‚¹è´Ÿè´£é›†ç¾¤çš„ç®¡æ§</p><p><strong>Node</strong> ï¼šå·¥ä½œè´Ÿè½½èŠ‚ç‚¹ï¼Œç”± master åˆ†é…å®¹å™¨åˆ°è¿™äº› node å·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œç„¶å node èŠ‚ç‚¹ä¸Šçš„ docker è´Ÿè´£å®¹å™¨çš„è¿è¡Œ</p><p><strong>Pod</strong> ï¼škubernetes çš„æœ€å°æ§åˆ¶å•å…ƒï¼Œå®¹å™¨éƒ½æ˜¯è¿è¡Œåœ¨ pod ä¸­çš„ï¼Œä¸€ä¸ª pod ä¸­å¯ä»¥æœ‰ 1 ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</p><p><strong>Controller</strong> ï¼šæ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒæ¥å®ç°å¯¹ pod çš„ç®¡ç†ï¼Œæ¯”å¦‚å¯åŠ¨ podã€åœæ­¢ podã€ä¼¸ç¼© pod çš„æ•°é‡ç­‰ç­‰</p><p><strong>Service</strong> ï¼špod å¯¹å¤–æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œä¸‹é¢å¯ä»¥ç»´æŠ¤è€…åŒä¸€ç±»çš„å¤šä¸ª pod</p><p><strong>Label</strong> ï¼šæ ‡ç­¾ï¼Œç”¨äºå¯¹ pod è¿›è¡Œåˆ†ç±»ï¼ŒåŒä¸€ç±» pod ä¼šæ‹¥æœ‰ç›¸åŒçš„æ ‡ç­¾</p><p><strong>NameSpace</strong> ï¼šå‘½åç©ºé—´ï¼Œç”¨æ¥éš”ç¦» pod çš„è¿è¡Œç¯å¢ƒ</p><h2 id="_2-kubernetes-é›†ç¾¤ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#_2-kubernetes-é›†ç¾¤ç¯å¢ƒæ­å»º" aria-hidden="true">#</a> 2. kubernetes é›†ç¾¤ç¯å¢ƒæ­å»º</h2><h3 id="_2-1-å‰ç½®çŸ¥è¯†ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-å‰ç½®çŸ¥è¯†ç‚¹" aria-hidden="true">#</a> 2.1 å‰ç½®çŸ¥è¯†ç‚¹</h3><p>ç›®å‰ç”Ÿäº§éƒ¨ç½² Kubernetes é›†ç¾¤ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p><strong>kubeadm</strong> ï¼ˆæ¨èï¼‰</p><p>Kubeadm æ˜¯ä¸€ä¸ª K8s éƒ¨ç½²å·¥å…·ï¼Œæä¾› kubeadm init å’Œ kubeadm joinï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½² Kubernetes é›†ç¾¤ã€‚</p><p>å®˜æ–¹åœ°å€ï¼šhttps://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/</p><p><strong>äºŒè¿›åˆ¶åŒ…</strong></p><p>ä» github ä¸‹è½½å‘è¡Œç‰ˆçš„äºŒè¿›åˆ¶åŒ…ï¼Œæ‰‹åŠ¨éƒ¨ç½²æ¯ä¸ªç»„ä»¶ï¼Œç»„æˆ Kubernetes é›†ç¾¤ã€‚</p><p>Kubeadm é™ä½éƒ¨ç½²é—¨æ§›ï¼Œä½†å±è”½äº†å¾ˆå¤šç»†èŠ‚ï¼Œé‡åˆ°é—®é¢˜å¾ˆéš¾æ’æŸ¥ã€‚å¦‚æœæƒ³æ›´å®¹æ˜“å¯æ§ï¼Œæ¨èä½¿ç”¨äºŒè¿›åˆ¶åŒ…éƒ¨ç½² Kubernetes é›†ç¾¤ï¼Œè™½ç„¶æ‰‹åŠ¨éƒ¨ç½²éº»çƒ¦ç‚¹ï¼ŒæœŸé—´å¯ä»¥å­¦ä¹ å¾ˆå¤šå·¥ä½œåŸç†ï¼Œä¹Ÿåˆ©äºåæœŸç»´æŠ¤ã€‚</p><figure><img src="/assets/img/k8s/image-20200404094800622.png" alt="ç›¸å…³å›¾ç‰‡" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><h3 id="_2-2-kubeadm-éƒ¨ç½²æ–¹å¼ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_2-2-kubeadm-éƒ¨ç½²æ–¹å¼ä»‹ç»" aria-hidden="true">#</a> 2.2 kubeadm éƒ¨ç½²æ–¹å¼ä»‹ç»</h3><p>kubeadm æ˜¯å®˜æ–¹ç¤¾åŒºæ¨å‡ºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½² kubernetes é›†ç¾¤çš„å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·èƒ½é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®Œæˆä¸€ä¸ª kubernetes é›†ç¾¤çš„éƒ¨ç½²ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ª Master èŠ‚ç‚¹ kubeadm init</li><li>å°† Node èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ä¸­$ kubeadm join &lt;Master èŠ‚ç‚¹çš„ IP å’Œç«¯å£&gt;</li></ul><h3 id="_2-3-å®‰è£…è¦æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-3-å®‰è£…è¦æ±‚" aria-hidden="true">#</a> 2.3 å®‰è£…è¦æ±‚</h3><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œéƒ¨ç½² Kubernetes é›†ç¾¤æœºå™¨éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p><ul><li>ä¸€å°æˆ–å¤šå°æœºå™¨ï¼Œæ“ä½œç³»ç»Ÿ CentOS7.x-86_x64</li><li>ç¡¬ä»¶é…ç½®ï¼š2GB æˆ–æ›´å¤š RAMï¼Œ2 ä¸ª CPU æˆ–æ›´å¤š CPUï¼Œç¡¬ç›˜ 30GB æˆ–æ›´å¤š</li><li>é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¹‹é—´ç½‘ç»œäº’é€š</li><li>å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒ</li><li>ç¦æ­¢ swap åˆ†åŒº</li></ul><h3 id="_2-4-æœ€ç»ˆç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#_2-4-æœ€ç»ˆç›®æ ‡" aria-hidden="true">#</a> 2.4 æœ€ç»ˆç›®æ ‡</h3><ul><li>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£… Docker å’Œ kubeadm</li><li>éƒ¨ç½² Kubernetes Master</li><li>éƒ¨ç½²å®¹å™¨ç½‘ç»œæ’ä»¶</li><li>éƒ¨ç½² Kubernetes Nodeï¼Œå°†èŠ‚ç‚¹åŠ å…¥ Kubernetes é›†ç¾¤ä¸­</li><li>éƒ¨ç½² Dashboard Web é¡µé¢ï¼Œå¯è§†åŒ–æŸ¥çœ‹ Kubernetes èµ„æº</li></ul><h3 id="_2-5-å‡†å¤‡ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_2-5-å‡†å¤‡ç¯å¢ƒ" aria-hidden="true">#</a> 2.5 å‡†å¤‡ç¯å¢ƒ</h3><figure><img src="/assets/img/k8s/image-20210609000002940.png" alt="ç›¸å…³å›¾ç‰‡" height="300" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><table><thead><tr><th style="text-align:left;">è§’è‰²</th><th style="text-align:left;">IP åœ°å€</th><th style="text-align:left;">ç»„ä»¶</th></tr></thead><tbody><tr><td style="text-align:left;">master01</td><td style="text-align:left;">192.168.5.3</td><td style="text-align:left;">dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet</td></tr><tr><td style="text-align:left;">node01</td><td style="text-align:left;">192.168.5.4</td><td style="text-align:left;">dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet</td></tr><tr><td style="text-align:left;">node02</td><td style="text-align:left;">192.168.5.5</td><td style="text-align:left;">dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet</td></tr></tbody></table><h3 id="_2-6-ç¯å¢ƒåˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-6-ç¯å¢ƒåˆå§‹åŒ–" aria-hidden="true">#</a> 2.6 ç¯å¢ƒåˆå§‹åŒ–</h3><p>å®‰è£… K8S é›†ç¾¤ï¼Œå…¶å®å°±æ˜¯å®‰è£… K8S å„ä¸ªç»„ä»¶ï¼Œå¹¶é…ç½®ã€‚</p><h4 id="_2-6-1-æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#_2-6-1-æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬" aria-hidden="true">#</a> 2.6.1 æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># æ­¤æ–¹å¼ä¸‹å®‰è£… kubernetes é›†ç¾¤è¦æ±‚ Centos ç‰ˆæœ¬è¦åœ¨ 7.5 æˆ–ä¹‹ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# cat /etc/redhat-release</span></span>
<span class="line"><span style="color:#6F42C1;">Centos</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Linux</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7.5</span><span style="color:#032F62;">.1804</span><span style="color:#24292E;"> (Core)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-2-ä¸»æœºåè§£æ" tabindex="-1"><a class="header-anchor" href="#_2-6-2-ä¸»æœºåè§£æ" aria-hidden="true">#</a> 2.6.2 ä¸»æœºåè§£æ</h4><p>ä¸ºäº†æ–¹ä¾¿é›†ç¾¤èŠ‚ç‚¹é—´çš„ç›´æ¥è°ƒç”¨ï¼Œåœ¨è¿™ä¸ªé…ç½®ä¸€ä¸‹ä¸»æœºåè§£æï¼Œä¼ä¸šä¸­æ¨èä½¿ç”¨å†…éƒ¨ DNS æœåŠ¡å™¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># ä¸»æœºåæˆè§£æ ç¼–è¾‘ä¸‰å°æœåŠ¡å™¨çš„/etc/hosts æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢å†…å®¹</span></span>
<span class="line"><span style="color:#6F42C1;">127.0.0.1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">localhost</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost.localdomain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost4.localdomain4</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.88.100</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.88.101</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node1</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.88.102</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node2</span></span>
<span class="line"><span style="color:#005CC5;">:</span><span style="color:#24292E;">:1         </span><span style="color:#032F62;">localhost</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost.localdomain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost6.localdomain6</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-3-æ—¶é—´åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_2-6-3-æ—¶é—´åŒæ­¥" aria-hidden="true">#</a> 2.6.3 æ—¶é—´åŒæ­¥</h4><p>kubernetes è¦æ±‚é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ—¶é—´å¿…é¡»ç²¾ç¡®ä¸€ç›´ï¼Œè¿™é‡Œä½¿ç”¨ chronyd æœåŠ¡ä»ç½‘ç»œåŒæ­¥æ—¶é—´</p><p>ä¼ä¸šä¸­å»ºè®®é…ç½®å†…éƒ¨çš„ä¼šè§åŒæ­¥æœåŠ¡å™¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># å¯åŠ¨ chronyd æœåŠ¡</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl start chronyd</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl enable chronyd</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# date</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-4-ç¦ç”¨-iptable-å’Œ-firewalld-æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_2-6-4-ç¦ç”¨-iptable-å’Œ-firewalld-æœåŠ¡" aria-hidden="true">#</a> 2.6.4 ç¦ç”¨ iptable å’Œ firewalld æœåŠ¡</h4><p>kubernetes å’Œ docker åœ¨è¿è¡Œçš„ä¸­ä¼šäº§ç”Ÿå¤§é‡çš„ iptables è§„åˆ™ï¼Œä¸ºäº†ä¸è®©ç³»ç»Ÿè§„åˆ™è·Ÿå®ƒä»¬æ··æ·†ï¼Œç›´æ¥å…³é—­ç³»ç»Ÿçš„è§„åˆ™</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1 å…³é—­ firewalld æœåŠ¡</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl stop firewalld</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl disable firewalld</span></span>
<span class="line"><span style="color:#6A737D;"># 2 å…³é—­ iptables æœåŠ¡</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl stop iptables</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl disable iptables</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-5-ç¦ç”¨-selinux" tabindex="-1"><a class="header-anchor" href="#_2-6-5-ç¦ç”¨-selinux" aria-hidden="true">#</a> 2.6.5 ç¦ç”¨ selinux</h4><p>selinux æ˜¯ linux ç³»ç»Ÿä¸‹çš„ä¸€ä¸ªå®‰å…¨æœåŠ¡ï¼Œå¦‚æœä¸å…³é—­å®ƒï¼Œåœ¨å®‰è£…é›†ç¾¤ä¸­ä¼šäº§ç”Ÿå„ç§å„æ ·çš„å¥‡è‘©é—®é¢˜ <code>setenforce 0</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># ç¼–è¾‘ /etc/selinux/config æ–‡ä»¶ï¼Œä¿®æ”¹ SELINUX çš„å€¼ä¸º disable</span></span>
<span class="line"><span style="color:#6A737D;"># æ³¨æ„ä¿®æ”¹å®Œæ¯•ä¹‹åéœ€è¦é‡å¯ linux æœåŠ¡</span></span>
<span class="line"><span style="color:#24292E;">SELINUX</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">disabled</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-6-ç¦ç”¨-swap-åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#_2-6-6-ç¦ç”¨-swap-åˆ†åŒº" aria-hidden="true">#</a> 2.6.6 ç¦ç”¨ swap åˆ†åŒº</h4><p>swap åˆ†åŒºæŒ‡çš„æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯ç‰©ç†å†…å­˜ä½¿ç”¨å®Œï¼Œä¹‹åå°†ç£ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜æ¥ä½¿ç”¨ï¼Œå¯ç”¨ swap è®¾å¤‡ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿéå¸¸è´Ÿé¢çš„å½±å“ï¼Œå› æ­¤ kubernetes è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç¦ç”¨ swap è®¾å¤‡ï¼Œä½†æ˜¯å¦‚æœå› ä¸ºæŸäº›åŸå› ç¡®å®ä¸èƒ½å…³é—­ swap åˆ†åŒºï¼Œå°±éœ€è¦åœ¨é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡æ˜ç¡®çš„å‚æ•°è¿›è¡Œé…ç½®è¯´æ˜</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># ç¼–è¾‘åˆ†åŒºé…ç½®æ–‡ä»¶/etc/fstabï¼Œæ³¨é‡Šæ‰ swap åˆ†åŒºä¸€è¡Œ</span></span>
<span class="line"><span style="color:#6A737D;"># æ³¨æ„ä¿®æ”¹å®Œæ¯•ä¹‹åéœ€è¦é‡å¯ linux æœåŠ¡</span></span>
<span class="line"><span style="color:#6F42C1;">vim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/fstab</span></span>
<span class="line"><span style="color:#6F42C1;">æ³¨é‡Šæ‰</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/mapper/centos-swap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">swap</span></span>
<span class="line"><span style="color:#6A737D;"># /dev/mapper/centos-swap swap</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-7-ä¿®æ”¹-linux-çš„å†…æ ¸å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_2-6-7-ä¿®æ”¹-linux-çš„å†…æ ¸å‚æ•°" aria-hidden="true">#</a> 2.6.7 ä¿®æ”¹ linux çš„å†…æ ¸å‚æ•°</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># ä¿®æ”¹ linux çš„å†…æ ¸é‡‡çº³æ•°ï¼Œæ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½</span></span>
<span class="line"><span style="color:#6A737D;"># ç¼–è¾‘/etc/sysctl.d/kubernetes.conf æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span>
<span class="line"><span style="color:#6F42C1;">net.bridge.bridge-nf-call-ip6tables</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">net.bridge.bridge-nf-call-iptables</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">net.ipv4.ip_forward</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># é‡æ–°åŠ è½½é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# sysctl -p</span></span>
<span class="line"><span style="color:#6A737D;"># åŠ è½½ç½‘æ¡¥è¿‡æ»¤æ¨¡å—</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# modprobe br_netfilter</span></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ç½‘æ¡¥è¿‡æ»¤æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# lsmod </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">br_netfilter</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-8-é…ç½®-ipvs-åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#_2-6-8-é…ç½®-ipvs-åŠŸèƒ½" aria-hidden="true">#</a> 2.6.8 é…ç½® ipvs åŠŸèƒ½</h4><p>åœ¨ Kubernetes ä¸­ Service æœ‰ä¸¤ç§å¸¦æ¥æ¨¡å‹ï¼Œä¸€ç§æ˜¯åŸºäº iptables çš„ï¼Œä¸€ç§æ˜¯åŸºäº ipvs çš„ä¸¤è€…æ¯”è¾ƒçš„è¯ï¼Œipvs çš„æ€§èƒ½æ˜æ˜¾è¦é«˜ä¸€äº›ï¼Œä½†æ˜¯å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥ ipvs æ¨¡å—</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1.å®‰è£… ipset å’Œ ipvsadm</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# yum install ipset ipvsadm -y</span></span>
<span class="line"><span style="color:#6A737D;"># 2.æ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—å†™å…¥è„šæœ¬æ–‡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# cat &lt;&lt;EOF</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="color:#6F42C1;">modprobe</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs</span></span>
<span class="line"><span style="color:#6F42C1;">modprobe</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs_rr</span></span>
<span class="line"><span style="color:#6F42C1;">modprobe</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs_wrr</span></span>
<span class="line"><span style="color:#6F42C1;">modprobe</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs_sh</span></span>
<span class="line"><span style="color:#6F42C1;">modprobe</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#6F42C1;">EOF</span></span>
<span class="line"><span style="color:#6A737D;"># 3.ä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# chmod +x /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#6A737D;"># 4.æ‰§è¡Œè„šæœ¬æ–‡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# /bin/bash /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#6A737D;"># 5.æŸ¥çœ‹å¯¹åº”çš„æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# lsmod </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack_ipv4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-9-å®‰è£…-docker" tabindex="-1"><a class="header-anchor" href="#_2-6-9-å®‰è£…-docker" aria-hidden="true">#</a> 2.6.9 å®‰è£… docker</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1ã€åˆ‡æ¢é•œåƒæº</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2ã€æŸ¥çœ‹å½“å‰é•œåƒæºä¸­æ”¯æŒçš„ docker ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# yum list docker-ce --showduplicates</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3ã€å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ docker-ce</span></span>
<span class="line"><span style="color:#6A737D;"># å¿…é¡»åˆ¶å®š--setopt=obsoletes=0ï¼Œå¦åˆ™ yum ä¼šè‡ªåŠ¨å®‰è£…æ›´é«˜ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4ã€æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#6A737D;">#Docker åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ Vgroup Driver ä¸º cgroupfsï¼Œè€Œ Kubernetes æ¨èä½¿ç”¨ systemd æ¥æ›¿ä»£ cgroupfs</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# mkdir /etc/docker</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# cat &lt;&lt;EOF</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;exec-opts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&quot;native.cgroupdriver=systemd&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;registry-mirrors&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&quot;https://kn0t2bca.mirror.aliyuncs.com&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6F42C1;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 5ã€å¯åŠ¨ dokcer</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl restart docker</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl enable docker</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-10-å®‰è£…-kubernetes-ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-6-10-å®‰è£…-kubernetes-ç»„ä»¶" aria-hidden="true">#</a> 2.6.10 å®‰è£… Kubernetes ç»„ä»¶</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1ã€ç”±äº kubernetes çš„é•œåƒåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™é‡Œåˆ‡æ¢æˆå›½å†…çš„é•œåƒæº</span></span>
<span class="line"><span style="color:#6A737D;"># 2ã€ç¼–è¾‘/etc/yum.repos.d/kubernetes.repo,æ·»åŠ ä¸‹é¢çš„é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">[kubernetes]</span></span>
<span class="line"><span style="color:#24292E;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">Kubernetes</span></span>
<span class="line"><span style="color:#24292E;">baseurl</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span>
<span class="line"><span style="color:#24292E;">enabled</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">gpgchech</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">repo_gpgcheck</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">gpgkey</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3ã€å®‰è£… kubeadmã€kubelet å’Œ kubectl</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 4ã€é…ç½® kubelet çš„ cgroup</span></span>
<span class="line"><span style="color:#6A737D;">#ç¼–è¾‘/etc/sysconfig/kubelet, æ·»åŠ ä¸‹é¢çš„é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">KUBELET_CGROUP_ARGS</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;--cgroup-driver=systemd&quot;</span></span>
<span class="line"><span style="color:#24292E;">KUBE_PROXY_MODE</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;ipvs&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 5ã€è®¾ç½® kubelet å¼€æœºè‡ªå¯</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl enable kubelet</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-11-å‡†å¤‡é›†ç¾¤é•œåƒ" tabindex="-1"><a class="header-anchor" href="#_2-6-11-å‡†å¤‡é›†ç¾¤é•œåƒ" aria-hidden="true">#</a> 2.6.11 å‡†å¤‡é›†ç¾¤é•œåƒ</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åœ¨å®‰è£… kubernetes é›†ç¾¤ä¹‹å‰ï¼Œå¿…é¡»è¦æå‰å‡†å¤‡å¥½é›†ç¾¤éœ€è¦çš„é•œåƒï¼Œæ‰€éœ€é•œåƒå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubeadm config images list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ä¸‹è½½é•œåƒ</span></span>
<span class="line"><span style="color:#6A737D;"># æ­¤é•œåƒ kubernetes çš„ä»“åº“ä¸­ï¼Œç”±äºç½‘ç»œåŸå› ï¼Œæ— æ³•è¿æ¥ï¼Œä¸‹é¢æä¾›äº†ä¸€ç§æ›¿æ¢æ–¹æ¡ˆ</span></span>
<span class="line"><span style="color:#24292E;">images</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">kube-apiserver:v1.17.7</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">kube-controller-manager:v1.17.4</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">kube-scheduler:v1.17.4</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">kube-proxy:v1.17.4</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">pause:3.1</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">etcd:3.4.3-0</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">coredns:1.6.5</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> imageName </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> ${images[@]};</span><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pull</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span style="color:#24292E;">$imageName</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span style="color:#24292E;">$imageName </span><span style="color:#032F62;">k8s.gcr.io/</span><span style="color:#24292E;">$imageName</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rmi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span style="color:#24292E;">$imageName </span></span>
<span class="line"><span style="color:#D73A49;">done</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-11-é›†ç¾¤åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-6-11-é›†ç¾¤åˆå§‹åŒ–" aria-hidden="true">#</a> 2.6.11 é›†ç¾¤åˆå§‹åŒ–</h4><blockquote><p>ä¸‹é¢çš„æ“ä½œåªéœ€è¦åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œå³å¯</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»ºé›†ç¾¤</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubeadm init \</span></span>
<span class="line"><span style="color:#24292E;">	--apiserver-advertise-address</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.88.100</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">--image-repository</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry.aliyuncs.com/google_containers</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">--kubernetes-version=v1.17.4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">--service-cidr=10.96.0.0/12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">--pod-network-cidr=10.244.0.0/16</span></span>
<span class="line"><span style="color:#6A737D;"># åˆ›å»ºå¿…è¦æ–‡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# mkdir -p $HOME/.kube</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# sudo chown </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">id</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-u</span><span style="color:#032F62;">)</span><span style="color:#24292E;">:</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">id</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-g</span><span style="color:#032F62;">)</span><span style="color:#24292E;"> $HOME/.kube/config</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®‰è£…æˆåŠŸæç¤º</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">Your</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Kubernetes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">control-plane</span><span style="color:#24292E;"> </span><span style="color:#032F62;">has</span><span style="color:#24292E;"> </span><span style="color:#032F62;">initialized</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">To</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">need</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">regular</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> $HOME</span><span style="color:#032F62;">/.kube</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/kubernetes/admin.conf</span><span style="color:#24292E;"> $HOME</span><span style="color:#032F62;">/.kube/config</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chown</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">id</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-u</span><span style="color:#032F62;">):$(</span><span style="color:#6F42C1;">id</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-g</span><span style="color:#032F62;">)</span><span style="color:#24292E;"> $HOME</span><span style="color:#032F62;">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">You</span><span style="color:#24292E;"> </span><span style="color:#032F62;">should</span><span style="color:#24292E;"> </span><span style="color:#032F62;">now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deploy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster.</span></span>
<span class="line"><span style="color:#6F42C1;">Run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;kubectl apply -f [podnetwork].yaml&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">one</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">options</span><span style="color:#24292E;"> </span><span style="color:#032F62;">listed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Then</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">can</span><span style="color:#24292E;"> </span><span style="color:#032F62;">join</span><span style="color:#24292E;"> </span><span style="color:#032F62;">any</span><span style="color:#24292E;"> </span><span style="color:#032F62;">number</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">worker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">each</span><span style="color:#24292E;"> </span><span style="color:#032F62;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">join</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.88.100:6443</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--token</span><span style="color:#24292E;"> </span><span style="color:#032F62;">q4c7nz.tz79x3psc611pp3q</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--discovery-token-ca-cert-hash</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sha256:2862978240fba6e4e135f9ba89c444e96cab1a8f6121d69b13ed437c80c5f051</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ ¹æ®è¯´æ˜ï¼Œç½‘ K8S ä¸­æ·»åŠ èŠ‚ç‚¹ã€‚ä¸‹é¢çš„æ“ä½œåªéœ€è¦åœ¨ node èŠ‚ç‚¹ä¸Šæ‰§è¡Œå³å¯</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">join</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.88.100:6443</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--token</span><span style="color:#24292E;"> </span><span style="color:#032F62;">q4c7nz.tz79x3psc611pp3q</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--discovery-token-ca-cert-hash</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sha256:2862978240fba6e4e135f9ba89c444e96cab1a8f6121d69b13ed437c80c5f051</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ master ä¸ŠæŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get nodes</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ROLES</span><span style="color:#24292E;">     </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VERSION</span></span>
<span class="line"><span style="color:#6F42C1;">master</span><span style="color:#24292E;">  </span><span style="color:#032F62;">NotReady</span><span style="color:#24292E;">  </span><span style="color:#032F62;">master</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">m</span><span style="color:#24292E;">    </span><span style="color:#032F62;">v1.17.4</span></span>
<span class="line"><span style="color:#6F42C1;">node1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">NotReady</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">22</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.17.4</span></span>
<span class="line"><span style="color:#6F42C1;">node2</span><span style="color:#24292E;">   </span><span style="color:#032F62;">NotReady</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.17.4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-13-å®‰è£…ç½‘ç»œæ’ä»¶-åªåœ¨-master-èŠ‚ç‚¹æ“ä½œå³å¯" tabindex="-1"><a class="header-anchor" href="#_2-6-13-å®‰è£…ç½‘ç»œæ’ä»¶-åªåœ¨-master-èŠ‚ç‚¹æ“ä½œå³å¯" aria-hidden="true">#</a> 2.6.13 å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œåªåœ¨ master èŠ‚ç‚¹æ“ä½œå³å¯</h4><p>k8s æ”¯æŒå¤šç§ç½‘ç»œæ’ä»¶ï¼Œå¦‚ flannelã€calicoã€canal ç­‰ï¼Œä»¥ä¸‹é€‰æ‹© flannelã€‚æ’ä»¶ä½¿ç”¨çš„æ˜¯ DaemonSet æ§åˆ¶å™¨ï¼Œä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç”±äºå¤–ç½‘ä¸å¥½è®¿é—®ï¼Œå¦‚æœå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸‹é¢çš„ è®°å¾—æ–‡ä»¶åæ˜¯ kube-flannel.ymlï¼Œä½ç½®ï¼š/root/kube-flannel.yml å†…å®¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">https://github.com/flannel-io/flannel/tree/master/Documentation/kube-flannel.yml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¹Ÿå¯æ‰‹åŠ¨æ‹‰å–æŒ‡å®šç‰ˆæœ¬ <code>docker pull quay.io/coreos/flannel:v0.14.0</code> #æ‹‰å– flannel ç½‘ç»œï¼Œä¸‰å°ä¸»æœº <code>docker images</code> #æŸ¥çœ‹ä»“åº“æ˜¯å¦æ‹‰å»ä¸‹æ¥</p><p><strong>ä¸ªäººç¬”è®°</strong> è‹¥æ˜¯é›†ç¾¤çŠ¶æ€ä¸€ç›´æ˜¯ notready,ç”¨ä¸‹é¢è¯­å¥æŸ¥çœ‹åŸå› ï¼Œ journalctl -f -u kubelet.service è‹¥åŸå› æ˜¯ï¼š cni.go:237] Unable to update cni config: no networks found in /etc/cni/net.d mkdir -p /etc/cni/net.d #åˆ›å»ºç›®å½•ç»™ flannel åšé…ç½®æ–‡ä»¶</p><h4 id="_2-6-14-ä½¿ç”¨-kubeadm-reset-é‡ç½®é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_2-6-14-ä½¿ç”¨-kubeadm-reset-é‡ç½®é›†ç¾¤" aria-hidden="true">#</a> 2.6.14 ä½¿ç”¨ kubeadm reset é‡ç½®é›†ç¾¤</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">systemctl stop kubelet</span></span>
<span class="line"><span style="color:#24292e;">rm -rf kubelet.conf </span></span>
<span class="line"><span style="color:#24292e;">rm -rf pki/ca.crt</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">swapoff -a</span></span>
<span class="line"><span style="color:#24292e;">kubeadm reset</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">rm /etc/cni/net.d/* -f</span></span>
<span class="line"><span style="color:#24292e;">systemctl daemon-reload</span></span>
<span class="line"><span style="color:#24292e;">systemctl restart kubelet</span></span>
<span class="line"><span style="color:#24292e;">systemctl restart docker</span></span>
<span class="line"><span style="color:#24292e;">iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-15-é‡å¯-kubelet-å’Œ-docker" tabindex="-1"><a class="header-anchor" href="#_2-6-15-é‡å¯-kubelet-å’Œ-docker" aria-hidden="true">#</a> 2.6.15 é‡å¯ kubelet å’Œ docker</h4><p>master é‡æ–°é…ç½® <code>kubeadm reset</code> åˆ é™¤$home/.kube/ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œç„¶åé‡æ–°æ ¹æ®ä¸Šé¢çš„ initã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨ fannel</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-flannel.yml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç­‰å¾…å®ƒå®‰è£…å®Œæ¯• å‘ç°å·²ç»æ˜¯ é›†ç¾¤çš„çŠ¶æ€å·²ç»æ˜¯ Ready</p><figure><img src="https:////wsl$/Ubuntu-20.04/home/kevin/learning/golang/k8sè¯¦ç»†æ•™ç¨‹-è°ƒæ•´ç‰ˆ/images/2232696-20210621233106024-1676033717.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="_2-6-16-kubeadm-ä¸­çš„å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_2-6-16-kubeadm-ä¸­çš„å‘½ä»¤" aria-hidden="true">#</a> 2.6.16 kubeadm ä¸­çš„å‘½ä»¤</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># ç”Ÿæˆ æ–°çš„ token</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubeadm token create --print-join-command</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-7-é›†ç¾¤æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-7-é›†ç¾¤æµ‹è¯•" aria-hidden="true">#</a> 2.7 é›†ç¾¤æµ‹è¯•</h3><h4 id="_2-7-1-åˆ›å»ºä¸€ä¸ª-nginx-æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_2-7-1-åˆ›å»ºä¸€ä¸ª-nginx-æœåŠ¡" aria-hidden="true">#</a> 2.7.1 åˆ›å»ºä¸€ä¸ª nginx æœåŠ¡</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--image=nginx:1.14-alpine</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-7-2-æš´éœ²ç«¯å£" tabindex="-1"><a class="header-anchor" href="#_2-7-2-æš´éœ²ç«¯å£" aria-hidden="true">#</a> 2.7.2 æš´éœ²ç«¯å£</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deploy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--port=80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--target-port=80</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--type=NodePort</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-7-3-æŸ¥çœ‹æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_2-7-3-æŸ¥çœ‹æœåŠ¡" aria-hidden="true">#</a> 2.7.3 æŸ¥çœ‹æœåŠ¡</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod,svc</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-7-4-æŸ¥çœ‹-pod" tabindex="-1"><a class="header-anchor" href="#_2-7-4-æŸ¥çœ‹-pod" aria-hidden="true">#</a> 2.7.4 æŸ¥çœ‹ pod</h4><figure><img src="https:////wsl$/Ubuntu-20.04/home/kevin/learning/golang/k8sè¯¦ç»†æ•™ç¨‹-è°ƒæ•´ç‰ˆ/images/2232696-20210621233130477-111035427.png" alt="ç›¸å…³å›¾ç‰‡" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><h2 id="_3-èµ„æºç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_3-èµ„æºç®¡ç†" aria-hidden="true">#</a> 3. èµ„æºç®¡ç†</h2><h3 id="_3-1-èµ„æºç®¡ç†ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-1-èµ„æºç®¡ç†ä»‹ç»" aria-hidden="true">#</a> 3.1 èµ„æºç®¡ç†ä»‹ç»</h3><p><strong>å­¦ä¹  K8Sï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•ä½¿ç”¨å…¶ä¸­çš„å„ç±»èµ„æºã€‚</strong></p><p>åœ¨ kubernetes ä¸­ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œç”¨æˆ·éœ€è¦é€šè¿‡æ“ä½œèµ„æºæ¥ç®¡ç† kubernetesã€‚</p><blockquote><p>kubernetes çš„æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å„ç§æœåŠ¡ï¼Œæ‰€è°“çš„éƒ¨ç½²æœåŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨ kubernetes é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªä¸ªçš„å®¹å™¨ï¼Œå¹¶å°†æŒ‡å®šçš„ç¨‹åºè·‘åœ¨å®¹å™¨ä¸­ã€‚</p><p>kubernetes çš„æœ€å°ç®¡ç†å•å…ƒæ˜¯ pod è€Œä¸æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥åªèƒ½å°†å®¹å™¨æ”¾åœ¨<code>Pod</code>ä¸­ï¼Œè€Œ kubernetes ä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ç®¡ç† Podï¼Œè€Œæ˜¯é€šè¿‡<code>Pod æ§åˆ¶å™¨</code>æ¥ç®¡ç† Pod çš„ã€‚</p><p>Pod å¯ä»¥æä¾›æœåŠ¡ä¹‹åï¼Œå°±è¦è€ƒè™‘å¦‚ä½•è®¿é—® Pod ä¸­æœåŠ¡ï¼Œkubernetes æä¾›äº†<code>Service</code>èµ„æºå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœ Pod ä¸­ç¨‹åºçš„æ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œkubernetes è¿˜æä¾›äº†å„ç§<code>å­˜å‚¨</code>ç³»ç»Ÿã€‚</p></blockquote><figure><img src="/assets/img/k8s/image-20200406225334627.png" alt="ç›¸å…³å›¾ç‰‡" height="300" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><blockquote><p>å­¦ä¹  kubernetes çš„æ ¸å¿ƒï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•å¯¹é›†ç¾¤ä¸Šçš„<code>Podã€Pod æ§åˆ¶å™¨ã€Serviceã€å­˜å‚¨</code>ç­‰å„ç§èµ„æºè¿›è¡Œæ“ä½œ</p></blockquote><h3 id="_3-2-yaml-è¯­è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-2-yaml-è¯­è¨€ä»‹ç»" aria-hidden="true">#</a> 3.2 YAML è¯­è¨€ä»‹ç»</h3><p>YAML æ˜¯ä¸€ä¸ªç±»ä¼¼ XMLã€JSON çš„æ ‡è®°æ€§è¯­è¨€ã€‚å®ƒå¼ºè°ƒä»¥ <strong>æ•°æ®</strong> ä¸ºä¸­å¿ƒï¼Œå¹¶ä¸æ˜¯ä»¥æ ‡è¯†è¯­è¨€ä¸ºé‡ç‚¹ã€‚å› è€Œ YAML æœ¬èº«çš„å®šä¹‰æ¯”è¾ƒç®€å•ï¼Œå·ç§°&quot;ä¸€ç§äººæ€§åŒ–çš„æ•°æ®æ ¼å¼è¯­è¨€&quot;ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">heima</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">age</span><span style="color:#24292E;">&gt;15&lt;/</span><span style="color:#22863A;">age</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">address</span><span style="color:#24292E;">&gt;Beijing&lt;/</span><span style="color:#22863A;">address</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">heima</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">heima</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">age</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">15</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">address</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Beijing</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>YAML çš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p><ul><li>å¤§å°å†™æ•æ„Ÿ</li><li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li><strong>ç¼©è¿›ä¸å…è®¸ä½¿ç”¨ tabï¼Œåªå…è®¸ç©ºæ ¼( ä½ç‰ˆæœ¬é™åˆ¶ )</strong></li><li>ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯</li><li>&#39;#&#39;è¡¨ç¤ºæ³¨é‡Š</li></ul><blockquote><p><strong>å°æç¤ºï¼š</strong></p><ul><li>ä¹¦å†™ yaml åˆ‡è®°<code>:</code> åé¢è¦åŠ ä¸€ä¸ªç©ºæ ¼</li><li>å¦‚æœéœ€è¦å°†å¤šæ®µ yaml é…ç½®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸­é—´è¦ä½¿ç”¨<code>---</code>åˆ†éš”</li><li>ä¸‹é¢æ˜¯ä¸€ä¸ª yaml è½¬ json çš„ç½‘ç«™ï¼Œå¯ä»¥é€šè¿‡å®ƒéªŒè¯ yaml æ˜¯å¦ä¹¦å†™æ­£ç¡®</li><li>https://www.json2yaml.com/convert-yaml-to-json</li></ul></blockquote><p>YAML æ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p><ul><li>çº¯é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</li><li>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/ å“ˆå¸Œï¼ˆhashï¼‰ / å­—å…¸ï¼ˆdictionaryï¼‰</li><li>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ / åˆ—è¡¨ï¼ˆlistï¼‰</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># çº¯é‡, å°±æ˜¯æŒ‡çš„ä¸€ä¸ªç®€å•çš„å€¼ï¼Œå­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€Nullã€æ—¶é—´ã€æ—¥æœŸ</span></span>
<span class="line"><span style="color:#6A737D;"># 1 å¸ƒå°”ç±»å‹</span></span>
<span class="line"><span style="color:#22863A;">c1</span><span style="color:#24292E;">: </span><span style="color:#032F62;">true (æˆ–è€… True)</span></span>
<span class="line"><span style="color:#6A737D;"># 2 æ•´å‹</span></span>
<span class="line"><span style="color:#22863A;">c2</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">234</span></span>
<span class="line"><span style="color:#6A737D;"># 3 æµ®ç‚¹å‹</span></span>
<span class="line"><span style="color:#22863A;">c3</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3.14</span></span>
<span class="line"><span style="color:#6A737D;"># 4 null ç±»å‹ </span></span>
<span class="line"><span style="color:#22863A;">c4</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">~</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># ä½¿ç”¨~è¡¨ç¤º null</span></span>
<span class="line"><span style="color:#6A737D;"># 5 æ—¥æœŸç±»å‹</span></span>
<span class="line"><span style="color:#22863A;">c5</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2018-02-17</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># æ—¥æœŸå¿…é¡»ä½¿ç”¨ ISO 8601 æ ¼å¼ï¼Œå³ yyyy-MM-dd</span></span>
<span class="line"><span style="color:#6A737D;"># 6 æ—¶é—´ç±»å‹</span></span>
<span class="line"><span style="color:#22863A;">c6</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2018-02-17T15:02:31+08:00</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># æ—¶é—´ä½¿ç”¨ ISO 8601 æ ¼å¼ï¼Œæ—¶é—´å’Œæ—¥æœŸä¹‹é—´ä½¿ç”¨ T è¿æ¥ï¼Œæœ€åä½¿ç”¨+ä»£è¡¨æ—¶åŒº</span></span>
<span class="line"><span style="color:#6A737D;"># 7 å­—ç¬¦ä¸²ç±»å‹</span></span>
<span class="line"><span style="color:#22863A;">c7</span><span style="color:#24292E;">: </span><span style="color:#032F62;">heima</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># ç®€å•å†™æ³•ï¼Œç›´æ¥å†™å€¼ , å¦‚æœå­—ç¬¦ä¸²ä¸­é—´æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æˆ–è€…å•å¼•å·åŒ…è£¹ </span></span>
<span class="line"><span style="color:#22863A;">c8</span><span style="color:#24292E;">: </span><span style="color:#032F62;">line1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">line2</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># å­—ç¬¦ä¸²è¿‡å¤šçš„æƒ…å†µå¯ä»¥æ‹†æˆå¤šè¡Œï¼Œæ¯ä¸€è¡Œä¼šè¢«è½¬åŒ–æˆä¸€ä¸ªç©ºæ ¼</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;"># å½¢å¼ä¸€(æ¨è):</span></span>
<span class="line"><span style="color:#22863A;">heima</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">age</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">15</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">address</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Beijing</span></span>
<span class="line"><span style="color:#6A737D;"># å½¢å¼äºŒ(äº†è§£):</span></span>
<span class="line"><span style="color:#22863A;">heima</span><span style="color:#24292E;">: {</span><span style="color:#22863A;">age</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">15</span><span style="color:#24292E;">,</span><span style="color:#22863A;">address</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Beijing</span><span style="color:#24292E;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># æ•°ç»„</span></span>
<span class="line"><span style="color:#6A737D;"># å½¢å¼ä¸€(æ¨è):</span></span>
<span class="line"><span style="color:#22863A;">address</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">é¡ºä¹‰</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">æ˜Œå¹³</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># å½¢å¼äºŒ(äº†è§£):</span></span>
<span class="line"><span style="color:#22863A;">address</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">é¡ºä¹‰</span><span style="color:#24292E;">,</span><span style="color:#032F62;">æ˜Œå¹³</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-èµ„æºç®¡ç†æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_3-3-èµ„æºç®¡ç†æ–¹å¼" aria-hidden="true">#</a> 3.3 èµ„æºç®¡ç†æ–¹å¼</h3><ul><li><p>å‘½ä»¤å¼å¯¹è±¡ç®¡ç†ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤å»æ“ä½œ kubernetes èµ„æº</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image=nginx:1.17.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=80</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å‘½ä»¤å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡å‘½ä»¤é…ç½®å’Œé…ç½®æ–‡ä»¶å»æ“ä½œ kubernetes èµ„æº</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create/patch</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-pod.yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å£°æ˜å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡ apply å‘½ä»¤å’Œé…ç½®æ–‡ä»¶å» <strong>åˆ›å»ºå’Œæ›´æ–°</strong> kubernetes èµ„æº</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-pod.yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><table><thead><tr><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">æ“ä½œå¯¹è±¡</th><th style="text-align:left;">é€‚ç”¨ç¯å¢ƒ</th><th style="text-align:left;">ä¼˜ç‚¹</th><th style="text-align:left;">ç¼ºç‚¹</th></tr></thead><tbody><tr><td style="text-align:left;">å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</td><td style="text-align:left;">å¯¹è±¡</td><td style="text-align:left;">æµ‹è¯•</td><td style="text-align:left;">ç®€å•</td><td style="text-align:left;">åªèƒ½æ“ä½œæ´»åŠ¨å¯¹è±¡ï¼Œæ— æ³•å®¡è®¡ã€è·Ÿè¸ª</td></tr><tr><td style="text-align:left;">å‘½ä»¤å¼å¯¹è±¡é…ç½®</td><td style="text-align:left;">æ–‡ä»¶</td><td style="text-align:left;">å¼€å‘</td><td style="text-align:left;">å¯ä»¥å®¡è®¡ã€è·Ÿè¸ª</td><td style="text-align:left;">é¡¹ç›®å¤§æ—¶ï¼Œé…ç½®æ–‡ä»¶å¤šï¼Œæ“ä½œéº»çƒ¦</td></tr><tr><td style="text-align:left;">å£°æ˜å¼å¯¹è±¡é…ç½®</td><td style="text-align:left;">ç›®å½•</td><td style="text-align:left;">å¼€å‘</td><td style="text-align:left;">æ”¯æŒç›®å½•æ“ä½œ</td><td style="text-align:left;">æ„å¤–æƒ…å†µä¸‹éš¾ä»¥è°ƒè¯•</td></tr></tbody></table><h4 id="_3-3-1-å‘½ä»¤å¼å¯¹è±¡ç®¡ç†-å‘½ä»¤ç¬”è®°æ•´åˆ" tabindex="-1"><a class="header-anchor" href="#_3-3-1-å‘½ä»¤å¼å¯¹è±¡ç®¡ç†-å‘½ä»¤ç¬”è®°æ•´åˆ" aria-hidden="true">#</a> 3.3.1 å‘½ä»¤å¼å¯¹è±¡ç®¡ç† [å‘½ä»¤ç¬”è®°æ•´åˆ]</h4><p><strong>kubectl å‘½ä»¤</strong></p><p>kubectl æ˜¯ kubernetes é›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…éƒ¨ç½²ã€‚kubectl å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> [command] [type] [name] [flags]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>comand</strong> ï¼šæŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚ createã€getã€delete</p><p><strong>type</strong> ï¼šæŒ‡å®šèµ„æºç±»å‹ï¼Œæ¯”å¦‚ deploymentã€podã€service</p><p><strong>name</strong> ï¼šæŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ</p><p><strong>flags</strong> ï¼šæŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•°</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹æ‰€æœ‰ pod</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹æŸä¸ª pod</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod_name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹æŸä¸ª pod,ä»¥ yaml æ ¼å¼å±•ç¤ºç»“æœ</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>èµ„æºç±»å‹</strong></p><p>kubernetes ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">api-resources</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»å¸¸ä½¿ç”¨çš„èµ„æºæœ‰ä¸‹é¢è¿™äº›ï¼š</p><table><thead><tr><th style="text-align:left;">èµ„æºåˆ†ç±»</th><th style="text-align:left;">èµ„æºåç§°</th><th style="text-align:left;">ç¼©å†™</th><th style="text-align:left;">èµ„æºä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:left;">é›†ç¾¤çº§åˆ«èµ„æº</td><td style="text-align:left;">nodes</td><td style="text-align:left;">no</td><td style="text-align:left;">é›†ç¾¤ç»„æˆéƒ¨åˆ†</td></tr><tr><td style="text-align:left;">namespaces</td><td style="text-align:left;">ns</td><td style="text-align:left;">éš”ç¦» Pod</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">pod èµ„æº</td><td style="text-align:left;">pods</td><td style="text-align:left;">po</td><td style="text-align:left;">è£…è½½å®¹å™¨</td></tr><tr><td style="text-align:left;">pod èµ„æºæ§åˆ¶å™¨</td><td style="text-align:left;">replicationcontrollers</td><td style="text-align:left;">rc</td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">replicasets</td><td style="text-align:left;">rs</td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">deployments</td><td style="text-align:left;">deploy</td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">daemonsets</td><td style="text-align:left;">ds</td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">jobs</td><td style="text-align:left;"></td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">cronjobs</td><td style="text-align:left;">cj</td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">horizontalpodautoscalers</td><td style="text-align:left;">hpa</td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">statefulsets</td><td style="text-align:left;">sts</td><td style="text-align:left;">æ§åˆ¶ pod èµ„æº</td></tr><tr><td style="text-align:left;">æœåŠ¡å‘ç°èµ„æº</td><td style="text-align:left;">services</td><td style="text-align:left;">svc</td><td style="text-align:left;">ç»Ÿä¸€ pod å¯¹å¤–æ¥å£</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">ingress</td><td style="text-align:left;">ing</td><td style="text-align:left;">ç»Ÿä¸€ pod å¯¹å¤–æ¥å£</td></tr><tr><td style="text-align:left;">å­˜å‚¨èµ„æº</td><td style="text-align:left;">volumeattachments</td><td style="text-align:left;"></td><td style="text-align:left;">å­˜å‚¨</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">persistentvolumes</td><td style="text-align:left;">pv</td><td style="text-align:left;">å­˜å‚¨</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">persistentvolumeclaims</td><td style="text-align:left;">pvc</td><td style="text-align:left;">å­˜å‚¨</td></tr><tr><td style="text-align:left;">é…ç½®èµ„æº</td><td style="text-align:left;">configmaps</td><td style="text-align:left;">cm</td><td style="text-align:left;">é…ç½®</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">secrets</td><td style="text-align:left;"></td><td style="text-align:left;">é…ç½®</td></tr></tbody></table><p><strong>æ“ä½œ</strong></p><p>kubernetes å…è®¸å¯¹èµ„æºè¿›è¡Œå¤šç§æ“ä½œï¼Œå¯ä»¥é€šè¿‡--help æŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--help</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»å¸¸ä½¿ç”¨çš„æ“ä½œæœ‰ä¸‹é¢è¿™äº›ï¼š</p><table><thead><tr><th style="text-align:left;">å‘½ä»¤åˆ†ç±»</th><th style="text-align:left;">å‘½ä»¤</th><th style="text-align:left;">ç¿»è¯‘</th><th style="text-align:left;">å‘½ä»¤ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:left;">åŸºæœ¬å‘½ä»¤</td><td style="text-align:left;">create</td><td style="text-align:left;">åˆ›å»º</td><td style="text-align:left;">åˆ›å»ºä¸€ä¸ªèµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">edit</td><td style="text-align:left;">ç¼–è¾‘</td><td style="text-align:left;">ç¼–è¾‘ä¸€ä¸ªèµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">get</td><td style="text-align:left;">è·å–</td><td style="text-align:left;">è·å–ä¸€ä¸ªèµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">patch</td><td style="text-align:left;">æ›´æ–°</td><td style="text-align:left;">æ›´æ–°ä¸€ä¸ªèµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">delete</td><td style="text-align:left;">åˆ é™¤</td><td style="text-align:left;">åˆ é™¤ä¸€ä¸ªèµ„æº</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">explain</td><td style="text-align:left;">è§£é‡Š</td><td style="text-align:left;">å±•ç¤ºèµ„æºæ–‡æ¡£</td></tr><tr><td style="text-align:left;">è¿è¡Œå’Œè°ƒè¯•</td><td style="text-align:left;">run</td><td style="text-align:left;">è¿è¡Œ</td><td style="text-align:left;">åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">expose</td><td style="text-align:left;">æš´éœ²</td><td style="text-align:left;">æš´éœ²èµ„æºä¸º Service</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">describe</td><td style="text-align:left;">æè¿°</td><td style="text-align:left;">æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">logs</td><td style="text-align:left;">æ—¥å¿—è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—</td><td style="text-align:left;">è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">attach</td><td style="text-align:left;">ç¼ ç»•è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td><td style="text-align:left;">è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">exec</td><td style="text-align:left;">æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td><td style="text-align:left;">æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">cp</td><td style="text-align:left;">å¤åˆ¶</td><td style="text-align:left;">åœ¨ Pod å†…å¤–å¤åˆ¶æ–‡ä»¶</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">rollout</td><td style="text-align:left;">é¦–æ¬¡å±•ç¤º</td><td style="text-align:left;">ç®¡ç†èµ„æºçš„å‘å¸ƒ</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">scale</td><td style="text-align:left;">è§„æ¨¡</td><td style="text-align:left;">æ‰©(ç¼©)å®¹ Pod çš„æ•°é‡</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">autoscale</td><td style="text-align:left;">è‡ªåŠ¨è°ƒæ•´</td><td style="text-align:left;">è‡ªåŠ¨è°ƒæ•´ Pod çš„æ•°é‡</td></tr><tr><td style="text-align:left;">é«˜çº§å‘½ä»¤</td><td style="text-align:left;">apply</td><td style="text-align:left;">rc</td><td style="text-align:left;">é€šè¿‡æ–‡ä»¶å¯¹èµ„æºè¿›è¡Œé…ç½®</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">label</td><td style="text-align:left;">æ ‡ç­¾</td><td style="text-align:left;">æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾</td></tr><tr><td style="text-align:left;">å…¶ä»–å‘½ä»¤</td><td style="text-align:left;">cluster-info</td><td style="text-align:left;">é›†ç¾¤ä¿¡æ¯</td><td style="text-align:left;">æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">version</td><td style="text-align:left;">ç‰ˆæœ¬</td><td style="text-align:left;">æ˜¾ç¤ºå½“å‰ Server å’Œ Client çš„ç‰ˆæœ¬</td></tr></tbody></table><p>ä¸‹é¢ä»¥ä¸€ä¸ª namespace / pod çš„åˆ›å»ºå’Œåˆ é™¤ç®€å•æ¼”ç¤ºä¸‹å‘½ä»¤çš„ä½¿ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»ºä¸€ä¸ª namespace</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create namespace dev</span></span>
<span class="line"><span style="color:#6F42C1;">namespace/dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># è·å– namespace</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get ns</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">              </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">default</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">dev</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-lease</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-public</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># åœ¨æ­¤ namespace ä¸‹åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ª nginx çš„ Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl run pod --image=nginx:latest -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--generator=deployment/apps.v1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DEPRECATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">will</span><span style="color:#24292E;"> </span><span style="color:#032F62;">be</span><span style="color:#24292E;"> </span><span style="color:#032F62;">removed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">future</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--generator=run-pod/v1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">or</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">instead.</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹æ–°åˆ›å»ºçš„ pod</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">  </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># åˆ é™¤æŒ‡å®šçš„ pod</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete pod pod-864f9875b9-pcw7x</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pod&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># åˆ é™¤æŒ‡å®šçš„ namespace</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete ns dev</span></span>
<span class="line"><span style="color:#6F42C1;">namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;dev&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-2-å‘½ä»¤å¼å¯¹è±¡é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-3-2-å‘½ä»¤å¼å¯¹è±¡é…ç½®" aria-hidden="true">#</a> 3.3.2 å‘½ä»¤å¼å¯¹è±¡é…ç½®</h4><p>å‘½ä»¤å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨å‘½ä»¤é…åˆé…ç½®æ–‡ä»¶ä¸€èµ·æ¥æ“ä½œ kubernetes èµ„æºã€‚</p><p>1ï¼‰ åˆ›å»ºä¸€ä¸ª nginxpod.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Namespace</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginxpod</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-containers</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰æ‰§è¡Œ create å‘½ä»¤ï¼Œåˆ›å»ºèµ„æºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f nginxpod.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">namespace/dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginxpod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶å‘ç°åˆ›å»ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯ namespace å’Œ pod</p><p>3ï¼‰æ‰§è¡Œ get å‘½ä»¤ï¼ŒæŸ¥çœ‹èµ„æºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]#  kubectl get -f nginxpod.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">            </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">namespace/dev</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">            </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginxpod</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">s</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å°±æ˜¾ç¤ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡çš„ä¿¡æ¯</p><p>4ï¼‰æ‰§è¡Œ delete å‘½ä»¤ï¼Œåˆ é™¤èµ„æºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete -f nginxpod.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;dev&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;nginxpod&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶å‘ç°ä¸¤ä¸ªèµ„æºå¯¹è±¡è¢«åˆ é™¤äº†</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">æ€»ç»“:</span></span>
<span class="line"><span style="color:#24292e;">    å‘½ä»¤å¼å¯¹è±¡é…ç½®çš„æ–¹å¼æ“ä½œèµ„æºï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºï¼šå‘½ä»¤  +  yaml é…ç½®æ–‡ä»¶ï¼ˆé‡Œé¢æ˜¯å‘½ä»¤éœ€è¦çš„å„ç§å‚æ•°ï¼‰</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-3-å£°æ˜å¼å¯¹è±¡é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-3-3-å£°æ˜å¼å¯¹è±¡é…ç½®" aria-hidden="true">#</a> 3.3.3 å£°æ˜å¼å¯¹è±¡é…ç½®</h4><p>å£°æ˜å¼å¯¹è±¡é…ç½®è·Ÿå‘½ä»¤å¼å¯¹è±¡é…ç½®å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤ applyã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># é¦–å…ˆæ‰§è¡Œä¸€æ¬¡ kubectl apply -f yaml æ–‡ä»¶ï¼Œå‘ç°åˆ›å»ºäº†èµ„æº</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]#  kubectl apply -f nginxpod.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">namespace/dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginxpod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å†æ¬¡æ‰§è¡Œä¸€æ¬¡ kubectl apply -f yaml æ–‡ä»¶ï¼Œå‘ç°è¯´èµ„æºæ²¡æœ‰å˜åŠ¨</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]#  kubectl apply -f nginxpod.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">namespace/dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unchanged</span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginxpod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unchanged</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">æ€»ç»“:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">å…¶å®å£°æ˜å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#032F62;">æè¿°ä¸€ä¸ªèµ„æºæœ€ç»ˆçš„çŠ¶æ€ï¼ˆåœ¨</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yaml</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ä¸­å®šä¹‰çŠ¶æ€ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ä½¿ç”¨</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#032F62;">æ“ä½œèµ„æºï¼š</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºï¼Œç›¸å½“äº</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">å¦‚æœèµ„æºå·²å­˜åœ¨ï¼Œå°±æ›´æ–°ï¼Œç›¸å½“äº</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patch</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ‰©å±•ï¼škubectl å¯ä»¥åœ¨ node èŠ‚ç‚¹ä¸Šè¿è¡Œå— ?</p></blockquote><p>kubectl çš„è¿è¡Œæ˜¯éœ€è¦è¿›è¡Œé…ç½®çš„ï¼Œå®ƒçš„é…ç½®æ–‡ä»¶æ˜¯$HOME/.kubeï¼Œå¦‚æœæƒ³è¦åœ¨ node èŠ‚ç‚¹è¿è¡Œæ­¤å‘½ä»¤ï¼Œéœ€è¦å°† master ä¸Šçš„.kube æ–‡ä»¶å¤åˆ¶åˆ° node èŠ‚ç‚¹ä¸Šï¼Œå³åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸‹é¢æ“ä½œï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">scp</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;">  </span><span style="color:#032F62;">HOME/.kube</span><span style="color:#24292E;">   </span><span style="color:#032F62;">node1:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">HOME/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>ä½¿ç”¨æ¨è: ä¸‰ç§æ–¹å¼åº”è¯¥æ€ä¹ˆç”¨ ?</p></blockquote><p>åˆ›å»º/æ›´æ–°èµ„æº ä½¿ç”¨å£°æ˜å¼å¯¹è±¡é…ç½® kubectl apply -f XXX.yaml</p><p>åˆ é™¤èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡é…ç½® kubectl delete -f XXX.yaml</p><p>æŸ¥è¯¢èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡ç®¡ç† kubectl get(describe) èµ„æºåç§°</p><h2 id="_4-å®æˆ˜å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_4-å®æˆ˜å…¥é—¨" aria-hidden="true">#</a> 4. å®æˆ˜å…¥é—¨</h2><p>æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•åœ¨ kubernetes é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª nginx æœåŠ¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</p><h3 id="_4-1-namespace" tabindex="-1"><a class="header-anchor" href="#_4-1-namespace" aria-hidden="true">#</a> 4.1 Namespace</h3><p>Namespace æ˜¯ kubernetes ç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç° <strong>å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»</strong> æˆ–è€… <strong>å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»</strong> ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œkubernetes é›†ç¾¤ä¸­çš„æ‰€æœ‰çš„ Pod éƒ½æ˜¯å¯ä»¥ç›¸äº’è®¿é—®çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œå¯èƒ½ä¸æƒ³è®©ä¸¤ä¸ª Pod ä¹‹é—´è¿›è¡Œäº’ç›¸çš„è®¿é—®ï¼Œé‚£æ­¤æ—¶å°±å¯ä»¥å°†ä¸¤ä¸ª Pod åˆ’åˆ†åˆ°ä¸åŒçš„ namespace ä¸‹ã€‚ <strong>kubernetes é€šè¿‡å°†é›†ç¾¤å†…éƒ¨çš„èµ„æºåˆ†é…åˆ°ä¸åŒçš„ Namespace ä¸­ï¼Œå¯ä»¥å½¢æˆé€»è¾‘ä¸Šçš„&quot;ç»„&quot;ï¼Œä»¥æ–¹ä¾¿ä¸åŒçš„ç»„çš„èµ„æºè¿›è¡Œéš”ç¦»ä½¿ç”¨å’Œç®¡ç†ã€‚</strong></p><p>å¯ä»¥é€šè¿‡ kubernetes çš„æˆæƒæœºåˆ¶ï¼Œå°†ä¸åŒçš„ namespace äº¤ç»™ä¸åŒç§Ÿæˆ·è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±å®ç°äº†å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚æ­¤æ—¶è¿˜èƒ½ç»“åˆ kubernetes çš„èµ„æºé…é¢æœºåˆ¶ï¼Œé™å®šä¸åŒç§Ÿæˆ·èƒ½å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚ CPU ä½¿ç”¨é‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ç­‰ï¼Œæ¥å®ç°ç§Ÿæˆ·å¯ç”¨èµ„æºçš„ç®¡ç†ã€‚</p><figure><img src="/assets/img/k8s/image-20200407100850484.png" alt="image-20200407100850484" tabindex="0" loading="lazy"><figcaption>image-20200407100850484</figcaption></figure><p>kubernetes åœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œä¼šé»˜è®¤åˆ›å»ºå‡ ä¸ª namespace</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl  get namespace</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">              </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">default</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#  æ‰€æœ‰æœªæŒ‡å®š Namespace çš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨ default å‘½åç©ºé—´</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-lease</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#  é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œv1.13 å¼€å§‹å¼•å…¥</span></span>
<span class="line"><span style="color:#6F42C1;">kube-public</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#  æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#  æ‰€æœ‰ç”± Kubernetes ç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ¥çœ‹ namespace èµ„æºçš„å…·ä½“æ“ä½œï¼š</p><h4 id="_4-1-1-æŸ¥çœ‹" tabindex="-1"><a class="header-anchor" href="#_4-1-1-æŸ¥çœ‹" aria-hidden="true">#</a> 4.1.1 <strong>æŸ¥çœ‹</strong></h4><p>æŸ¥çœ‹æ‰€æœ‰çš„ ns å‘½ä»¤ï¼š<code>kubectl get ns</code></p><p>æŸ¥çœ‹æŒ‡å®šçš„ ns å‘½ä»¤ï¼š<code>kubectl get ns ns åç§°</code></p><p>æŒ‡å®šè¾“å‡ºæ ¼å¼ å‘½ä»¤ï¼š<code>kubectl get ns ns åç§° -o æ ¼å¼å‚æ•°</code></p><p>æŸ¥çœ‹ ns è¯¦æƒ… å‘½ä»¤ï¼š<code>kubectl describe ns ns åç§°</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 1 æŸ¥çœ‹æ‰€æœ‰çš„ ns  å‘½ä»¤ï¼škubectl get ns</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get ns</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">              </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">default</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-lease</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-public</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span><span style="color:#24292E;">     </span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span><span style="color:#24292E;">     </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 2 æŸ¥çœ‹æŒ‡å®šçš„ ns   å‘½ä»¤ï¼škubectl get ns ns åç§°</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get ns default</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">      </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">default</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 3 æŒ‡å®šè¾“å‡ºæ ¼å¼  å‘½ä»¤ï¼škubectl get ns ns åç§°  -o æ ¼å¼å‚æ•°</span></span>
<span class="line"><span style="color:#6A737D;"># kubernetes æ”¯æŒçš„æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯ wideã€jsonã€yaml</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get ns default -o yaml</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Namespace</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">creationTimestamp:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2021-05-08T04:44:16Z&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">resourceVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;151&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">selfLink:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/api/v1/namespaces/default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">uid:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7405</span><span style="color:#032F62;">f73a-e486-43d4-9db6-145f1409f090</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">finalizers:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes</span></span>
<span class="line"><span style="color:#6F42C1;">status:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">phase:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Active</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># 4 æŸ¥çœ‹ ns è¯¦æƒ…  å‘½ä»¤ï¼škubectl describe ns ns åç§°</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe ns default</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># Active å‘½åç©ºé—´æ­£åœ¨ä½¿ç”¨ä¸­  Terminating æ­£åœ¨åˆ é™¤å‘½åç©ºé—´</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ResourceQuota é’ˆå¯¹ namespace åšçš„èµ„æºé™åˆ¶</span></span>
<span class="line"><span style="color:#6A737D;"># LimitRange é’ˆå¯¹ namespace ä¸­çš„æ¯ä¸ªç»„ä»¶åšçš„èµ„æºé™åˆ¶</span></span>
<span class="line"><span style="color:#6F42C1;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resource</span><span style="color:#24292E;"> </span><span style="color:#032F62;">quota.</span></span>
<span class="line"><span style="color:#6F42C1;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LimitRange</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resource.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-1-2-åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#_4-1-2-åˆ›å»º" aria-hidden="true">#</a> 4.1.2 <strong>åˆ›å»º</strong></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º namespace</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create ns dev</span></span>
<span class="line"><span style="color:#6F42C1;">namespace/dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-1-3-åˆ é™¤" tabindex="-1"><a class="header-anchor" href="#_4-1-3-åˆ é™¤" aria-hidden="true">#</a> 4.1.3 <strong>åˆ é™¤</strong></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ é™¤ namespace</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete ns dev</span></span>
<span class="line"><span style="color:#6F42C1;">namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;dev&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-1-4-é…ç½®æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_4-1-4-é…ç½®æ–¹å¼" aria-hidden="true">#</a> 4.1.4 <strong>é…ç½®æ–¹å¼</strong></h4><p>é¦–å…ˆå‡†å¤‡ä¸€ä¸ª yaml æ–‡ä»¶ï¼šns-dev.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Namespace</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p><p>åˆ›å»ºï¼škubectl create -f ns-dev.yaml</p><p>åˆ é™¤ï¼škubectl delete -f ns-dev.yaml</p><h3 id="_4-2-pod" tabindex="-1"><a class="header-anchor" href="#_4-2-pod" aria-hidden="true">#</a> 4.2 Pod</h3><p>Pod æ˜¯ kubernetes é›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒï¼Œç¨‹åºè¦è¿è¡Œå¿…é¡»éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œè€Œå®¹å™¨å¿…é¡»å­˜åœ¨äº Pod ä¸­ã€‚</p><p>Pod å¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„å°è£…ï¼Œä¸€ä¸ª Pod ä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚</p><figure><img src="/assets/img/k8s/image-20200407121501907.png" alt="ç›¸å…³å›¾ç‰‡" height="300" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><p>kubernetes åœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªç»„ä»¶ä¹Ÿéƒ½æ˜¯ä»¥ Pod æ–¹å¼è¿è¡Œçš„ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod -n kube-system</span></span>
<span class="line"><span style="color:#6F42C1;">NAMESPACE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">NAME</span><span style="color:#24292E;">                             </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">coredns-6955765f44-68g6v</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">coredns-6955765f44-cs5r8</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">etcd-master</span><span style="color:#24292E;">                      </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-apiserver-master</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-controller-manager-master</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-flannel-ds-amd64-47r25</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-flannel-ds-amd64-ls5lh</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-proxy-685tk</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-proxy-87spt</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-scheduler-master</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d1h</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-1-åˆ›å»ºå¹¶è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#_4-2-1-åˆ›å»ºå¹¶è¿è¡Œ" aria-hidden="true">#</a> 4.2.1 åˆ›å»ºå¹¶è¿è¡Œ</h4><p>kubernetes æ²¡æœ‰æä¾›å•ç‹¬è¿è¡Œ Pod çš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡ Pod æ§åˆ¶å™¨æ¥å®ç°çš„</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># å‘½ä»¤æ ¼å¼ï¼š kubectl run (pod æ§åˆ¶å™¨åç§°) [å‚æ•°] </span></span>
<span class="line"><span style="color:#6A737D;"># --image  æŒ‡å®š Pod çš„é•œåƒ</span></span>
<span class="line"><span style="color:#6A737D;"># --port   æŒ‡å®šç«¯å£</span></span>
<span class="line"><span style="color:#6A737D;"># --namespace  æŒ‡å®š namespace</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev </span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-2-æŸ¥çœ‹-pod-ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_4-2-2-æŸ¥çœ‹-pod-ä¿¡æ¯" aria-hidden="true">#</a> 4.2.2 æŸ¥çœ‹ pod ä¿¡æ¯</h4><p>æŸ¥çœ‹ Pod åŸºæœ¬ä¿¡æ¯ <code>kubectl get pods -n dev</code></p><p>æŸ¥çœ‹ Pod çš„è¯¦ç»†ä¿¡æ¯ <code>kubectl describe pod nginx -n dev</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod åŸºæœ¬ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">43</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod çš„è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe pod nginx -n dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-3-è®¿é—®-pod" tabindex="-1"><a class="header-anchor" href="#_4-2-3-è®¿é—®-pod" aria-hidden="true">#</a> 4.2.3 è®¿é—® Pod</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># è·å– podIP</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -n dev -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">    </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">             </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">    </span><span style="color:#032F62;">...</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">190</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.1.23</span><span style="color:#24292E;">   </span><span style="color:#032F62;">node1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#è®¿é—® POD</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl http://10.244.1.23:80</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-4-åˆ é™¤æŒ‡å®š-pod" tabindex="-1"><a class="header-anchor" href="#_4-2-4-åˆ é™¤æŒ‡å®š-pod" aria-hidden="true">#</a> 4.2.4 åˆ é™¤æŒ‡å®š Pod</h4><blockquote><p>è¿™æ˜¯å› ä¸ºå½“å‰ Pod æ˜¯ç”± Pod æ§åˆ¶å™¨åˆ›å»ºçš„ï¼Œæ§åˆ¶å™¨ä¼šç›‘æ§ Pod çŠ¶å†µï¼Œä¸€æ—¦å‘ç° Pod æ­»äº¡ï¼Œä¼šç«‹å³é‡å»ºã€‚æ­¤æ—¶è¦æƒ³åˆ é™¤ Podï¼Œå¿…é¡»åˆ é™¤ Pod æ§åˆ¶å™¨</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ é™¤æŒ‡å®š Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete pod nginx -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;nginx&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ­¤æ—¶ï¼Œæ˜¾ç¤ºåˆ é™¤ Pod æˆåŠŸï¼Œä½†æ˜¯å†æŸ¥è¯¢ï¼Œå‘ç°åˆæ–°äº§ç”Ÿäº†ä¸€ä¸ª </span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å…ˆæ¥æŸ¥è¯¢ä¸€ä¸‹å½“å‰ namespace ä¸‹çš„ Pod æ§åˆ¶å™¨</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get deploy -n  dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">UP-TO-DATE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AVAILABLE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">m7s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ¥ä¸‹æ¥ï¼Œåˆ é™¤æ­¤ PodPod æ§åˆ¶å™¨</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete deploy nginx -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;nginx&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ç¨ç­‰ç‰‡åˆ»ï¼Œå†æŸ¥è¯¢ Podï¼Œå‘ç° Pod è¢«åˆ é™¤äº†</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resources</span><span style="color:#24292E;"> </span><span style="color:#032F62;">found</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-5-é…ç½®æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_4-2-5-é…ç½®æ“ä½œ" aria-hidden="true">#</a> 4.2.5 é…ç½®æ“ä½œ</h4><p>åˆ›å»ºä¸€ä¸ª pod-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p><p>åˆ›å»ºï¼škubectl create -f pod-nginx.yaml</p><p>åˆ é™¤ï¼škubectl delete -f pod-nginx.yaml</p><h3 id="_4-3-label" tabindex="-1"><a class="header-anchor" href="#_4-3-label" aria-hidden="true">#</a> 4.3 Label</h3><blockquote><p>ç»™ pod æ·»åŠ æ ‡ç­¾ï¼Œå¹¶å¯ä»¥æ ¹æ®æ ‡ç­¾è¿›è¡Œé€‰æ‹©ã€‚</p></blockquote><p>Label æ˜¯ kubernetes ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨èµ„æºä¸Šæ·»åŠ æ ‡è¯†ï¼Œç”¨æ¥å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†å’Œé€‰æ‹©ã€‚</p><p><strong>Label çš„ç‰¹ç‚¹ï¼š</strong></p><ul><li>ä¸€ä¸ª Label ä¼šä»¥ key/value é”®å€¼å¯¹çš„å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Šï¼Œå¦‚ Nodeã€Podã€Service ç­‰ç­‰</li><li>ä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„ Label ï¼ŒåŒä¸€ä¸ª Label ä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå»</li><li>Label é€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤</li></ul><p>å¯ä»¥é€šè¿‡ Label å®ç°èµ„æºçš„å¤šç»´åº¦åˆ†ç»„ï¼Œä»¥ä¾¿çµæ´»ã€æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ã€é…ç½®ã€éƒ¨ç½²ç­‰ç®¡ç†å·¥ä½œã€‚</p><blockquote><p>ä¸€äº›å¸¸ç”¨çš„ Label ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><ul><li>ç‰ˆæœ¬æ ‡ç­¾ï¼š&quot;version&quot;:&quot;release&quot;, &quot;version&quot;:&quot;stable&quot;......</li><li>ç¯å¢ƒæ ‡ç­¾ï¼š&quot;environment&quot;:&quot;dev&quot;ï¼Œ&quot;environment&quot;:&quot;test&quot;ï¼Œ&quot;environment&quot;:&quot;pro&quot;</li><li>æ¶æ„æ ‡ç­¾ï¼š&quot;tier&quot;:&quot;frontend&quot;ï¼Œ&quot;tier&quot;:&quot;backend&quot;</li></ul></blockquote><h5 id="æŸ¥è¯¢æ ‡ç­¾" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢æ ‡ç­¾" aria-hidden="true">#</a> <strong>æŸ¥è¯¢æ ‡ç­¾</strong></h5><p>æ ‡ç­¾å®šä¹‰å®Œæ¯•ä¹‹åï¼Œè¿˜è¦è€ƒè™‘åˆ°æ ‡ç­¾çš„é€‰æ‹©ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ° Label Selectorï¼Œå³ï¼š</p><p>Label ç”¨äºç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰æ ‡è¯†</p><p>Label Selector ç”¨äºæŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›æ ‡ç­¾çš„èµ„æºå¯¹è±¡</p><p>å½“å‰æœ‰ä¸¤ç§ Label Selectorï¼š</p><ul><li><p>åŸºäºç­‰å¼çš„ Label Selector</p><p><code>name = slave</code>: é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­ key=&quot;name&quot;ä¸” value=&quot;slave&quot;çš„å¯¹è±¡</p><p><code>env != production</code>: é€‰æ‹©æ‰€æœ‰åŒ…æ‹¬ Label ä¸­çš„ key=&quot;env&quot;ä¸” value ä¸ç­‰äº&quot;production&quot;çš„å¯¹è±¡</p></li><li><p>åŸºäºé›†åˆçš„ Label Selector</p><p><code>name in (master, slave)</code>: é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­çš„ key=&quot;name&quot;ä¸” value=&quot;master&quot;æˆ–&quot;slave&quot;çš„å¯¹è±¡</p><p><code>name not in (frontend)</code>: é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­çš„ key=&quot;name&quot;ä¸” value ä¸ç­‰äº&quot;frontend&quot;çš„å¯¹è±¡</p></li></ul><p>æ ‡ç­¾çš„é€‰æ‹©æ¡ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œæ­¤æ—¶å°†å¤šä¸ª Label Selector è¿›è¡Œç»„åˆï¼Œä½¿ç”¨é€—å·&quot;,&quot;è¿›è¡Œåˆ†éš”å³å¯ã€‚ä¾‹å¦‚ï¼š</p><p>name=slaveï¼Œenv!=production</p><p>name not in (frontend)ï¼Œenv!=production</p><h4 id="_4-3-1-å‘½ä»¤æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_4-3-1-å‘½ä»¤æ–¹å¼" aria-hidden="true">#</a> 4.3.1 å‘½ä»¤æ–¹å¼</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># ä¸º pod èµ„æºæ‰“æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl label pod nginx-pod version=1.0 -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginx-pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">labeled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ä¸º pod èµ„æºæ›´æ–°æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite</span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginx-pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">labeled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod nginx-pod  -n dev --show-labels</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">        </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">LABELS</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-pod</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">10</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">version=</span><span style="color:#005CC5;">2.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ç­›é€‰æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod -n dev -l version=2.0  --show-labels</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">        </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">LABELS</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-pod</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">version=</span><span style="color:#005CC5;">2.0</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod -n dev -l version</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">=2.0 </span><span style="color:#005CC5;">--show-labels</span></span>
<span class="line"><span style="color:#6F42C1;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resources</span><span style="color:#24292E;"> </span><span style="color:#032F62;">found</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#åˆ é™¤æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl label pod nginx-pod version- -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginx-pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">labeled</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-2-é…ç½®æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_4-3-2-é…ç½®æ–¹å¼" aria-hidden="true">#</a> 4.3.2 é…ç½®æ–¹å¼</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">version</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;3.0&quot;</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;test&quot;</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„æ›´æ–°å‘½ä»¤äº†ï¼škubectl apply -f pod-nginx.yaml</p><h3 id="_4-4-deployment" tabindex="-1"><a class="header-anchor" href="#_4-4-deployment" aria-hidden="true">#</a> 4.4 Deployment</h3><p>åœ¨ kubernetes ä¸­ï¼ŒPod æ˜¯æœ€å°çš„æ§åˆ¶å•å…ƒï¼Œä½†æ˜¯ kubernetes å¾ˆå°‘ç›´æ¥æ§åˆ¶ Podï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ Pod æ§åˆ¶å™¨æ¥å®Œæˆçš„ã€‚Pod æ§åˆ¶å™¨ç”¨äº pod çš„ç®¡ç†ï¼Œç¡®ä¿ pod èµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€ï¼Œå½“ pod çš„èµ„æºå‡ºç°æ•…éšœæ—¶ï¼Œä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–é‡å»º podã€‚</p><p>åœ¨ kubernetes ä¸­ Pod æ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼Œæœ¬ç« èŠ‚åªä»‹ç»ä¸€ç§ï¼šDeploymentã€‚</p><figure><img src="/assets/img/k8s/image-20200408193950807.png" alt="ç›¸å…³å›¾ç‰‡" height="300" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><h4 id="_4-4-1-æ“ä½œå‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_4-4-1-æ“ä½œå‘½ä»¤" aria-hidden="true">#</a> 4.4.1 æ“ä½œå‘½ä»¤</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># å‘½ä»¤æ ¼å¼: kubectl create deployment åç§°  [å‚æ•°] </span></span>
<span class="line"><span style="color:#6A737D;"># --image  æŒ‡å®š pod çš„é•œåƒ</span></span>
<span class="line"><span style="color:#6A737D;"># --port   æŒ‡å®šç«¯å£</span></span>
<span class="line"><span style="color:#6A737D;"># --replicas  æŒ‡å®šåˆ›å»º pod æ•°é‡</span></span>
<span class="line"><span style="color:#6A737D;"># --namespace  æŒ‡å®š namespace</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹åˆ›å»ºçš„ Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-5ff7956ff6-6k8cb</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-5ff7956ff6-jxfjt</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-5ff7956ff6-v6jqw</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ deployment çš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get deploy -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">UP-TO-DATE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AVAILABLE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">/3</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m42s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># UP-TO-DATEï¼šæˆåŠŸå‡çº§çš„å‰¯æœ¬æ•°é‡</span></span>
<span class="line"><span style="color:#6A737D;"># AVAILABLEï¼šå¯ç”¨å‰¯æœ¬çš„æ•°é‡</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get deploy -n dev -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;"> </span><span style="color:#032F62;">UP-TO-DATE</span><span style="color:#24292E;">  </span><span style="color:#032F62;">AVAILABLE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">CONTAINERS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IMAGES</span><span style="color:#24292E;">              </span><span style="color:#032F62;">SELECTOR</span></span>
<span class="line"><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">/3</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m51s</span><span style="color:#24292E;">   </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;">        </span><span style="color:#032F62;">nginx:latest</span><span style="color:#24292E;">        </span><span style="color:#032F62;">run=nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ deployment çš„è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe deploy nginx -n dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># åˆ é™¤ </span></span>
<span class="line"><span style="color:#24292E;">[root@master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete deploy nginx -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;nginx&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-2-é…ç½®æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_4-4-2-é…ç½®æ“ä½œ" aria-hidden="true">#</a> 4.4.2 é…ç½®æ“ä½œ</h4><p>åˆ›å»ºä¸€ä¸ª deploy-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p><p>åˆ›å»ºï¼š<code>kubectl create -f deploy-nginx.yaml</code></p><p>åˆ é™¤ï¼š<code>kubectl delete -f deploy-nginx.yaml</code></p><h3 id="_4-5-service" tabindex="-1"><a class="header-anchor" href="#_4-5-service" aria-hidden="true">#</a> 4.5 Service</h3><p>è™½ç„¶æ¯ä¸ª Pod éƒ½ä¼šåˆ†é…ä¸€ä¸ªå•ç‹¬çš„ Pod IPï¼Œç„¶è€Œå´å­˜åœ¨å¦‚ä¸‹ä¸¤é—®é¢˜ï¼š</p><ul><li>Pod IP ä¼šéšç€ Pod çš„é‡å»ºäº§ç”Ÿå˜åŒ–</li><li>Pod IP ä»…ä»…æ˜¯é›†ç¾¤å†…å¯è§çš„è™šæ‹Ÿ IPï¼Œå¤–éƒ¨æ— æ³•è®¿é—®</li></ul><blockquote><p>Service å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„åŒç±» Pod <strong>å¯¹å¤–çš„è®¿é—®æ¥å£</strong> ã€‚å€ŸåŠ© Serviceï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</p></blockquote><figure><img src="/assets/img/k8s/image-20200408194716912.png" alt="ç›¸å…³å›¾ç‰‡" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><p>Service é€šè¿‡ IP é€‰æ‹©å™¨å‘ç° Pod</p><h4 id="_4-5-1-åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„-service" tabindex="-1"><a class="header-anchor" href="#_4-5-1-åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„-service" aria-hidden="true">#</a> 4.5.1 åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„ Service</h4><p>æš´éœ² Service</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deploy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name=svc-nginx1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--type=ClusterIP</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--target-port=80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥çœ‹ service</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc-nginx1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc-nginx1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">SELECTOR</span></span>
<span class="line"><span style="color:#6F42C1;">svc-nginx1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.109</span><span style="color:#032F62;">.179.231</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">80</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m51s</span><span style="color:#24292E;">   </span><span style="color:#032F62;">run=nginx</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ª CLUSTER-IPï¼Œè¿™å°±æ˜¯ service çš„ IPï¼Œåœ¨ Service çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸ä¼šå˜åŠ¨çš„ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ª IP è®¿é—®å½“å‰ service å¯¹åº”çš„ POD</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.109</span><span style="color:#032F62;">.179.231:80</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_4-5-2-åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„-service" tabindex="-1"><a class="header-anchor" href="#_4-5-2-åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„-service" aria-hidden="true">#</a> 4.5.2 åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„ Service</h4><p>ä¸Šé¢åˆ›å»ºçš„ Service çš„ type ç±»å‹ä¸º ClusterIPï¼Œè¿™ä¸ª ip åœ°å€åªç”¨é›†ç¾¤å†…éƒ¨å¯è®¿é—®ï¼Œå¦‚æœéœ€è¦åˆ›å»ºå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®çš„ Serviceï¼Œéœ€è¦ä¿®æ”¹ type ä¸º NodePortã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deploy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name=svc-nginx2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--type=NodePort</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--target-port=80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤æ—¶æŸ¥çœ‹ï¼Œä¼šå‘ç°å‡ºç°äº† NodePort ç±»å‹çš„ Serviceï¼Œè€Œä¸”æœ‰ä¸€å¯¹ Portï¼ˆ80:31928/TCï¼‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc</span><span style="color:#24292E;">  </span><span style="color:#032F62;">svc-nginx2</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">          </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)        </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">    </span><span style="color:#032F62;">SELECTOR</span></span>
<span class="line"><span style="color:#6F42C1;">svc-nginx2</span><span style="color:#24292E;">    </span><span style="color:#032F62;">NodePort</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">10.100</span><span style="color:#032F62;">.94.0</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">80</span><span style="color:#032F62;">:31928/TCP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">s</span><span style="color:#24292E;">     </span><span style="color:#032F62;">run=nginx</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡é›†ç¾¤å¤–çš„ä¸»æœºè®¿é—® èŠ‚ç‚¹ IP:31928 è®¿é—®æœåŠ¡äº†</p><p>ä¾‹å¦‚åœ¨çš„ç”µè„‘ä¸»æœºä¸Šé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸‹é¢çš„åœ°å€</p><h4 id="_4-5-3-åˆ é™¤-service" tabindex="-1"><a class="header-anchor" href="#_4-5-3-åˆ é™¤-service" aria-hidden="true">#</a> 4.5.3 åˆ é™¤ Service</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc-nginx1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dev</span><span style="color:#24292E;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_4-5-4-é…ç½®æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_4-5-4-é…ç½®æ–¹å¼" aria-hidden="true">#</a> 4.5.4 é…ç½®æ–¹å¼</h4><p>åˆ›å»ºä¸€ä¸ª svc-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">svc-nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.109.179.231</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#å›ºå®š svc çš„å†…ç½‘ ip</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterIP</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p><p>åˆ›å»ºï¼š<code>kubectl create -f svc-nginx.yaml</code></p><p>åˆ é™¤ï¼š<code>kubectl delete -f svc-nginx.yaml</code></p><blockquote><p><strong>å°ç»“</strong></p><p>è‡³æ­¤ï¼Œå·²ç»æŒæ¡äº† Namespaceã€Podã€Deploymentã€Service èµ„æºçš„åŸºæœ¬æ“ä½œï¼Œæœ‰äº†è¿™äº›æ“ä½œï¼Œå°±å¯ä»¥åœ¨ kubernetes é›†ç¾¤ä¸­å®ç°ä¸€ä¸ªæœåŠ¡çš„ç®€å•éƒ¨ç½²å’Œè®¿é—®äº†ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦æ›´å¥½çš„ä½¿ç”¨ kubernetesï¼Œå°±éœ€è¦æ·±å…¥å­¦ä¹ è¿™å‡ ç§èµ„æºçš„ç»†èŠ‚å’ŒåŸç†ã€‚</p></blockquote><h2 id="_5-pod-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_5-pod-è¯¦è§£" aria-hidden="true">#</a> 5. Pod è¯¦è§£</h2><h3 id="_5-1-pod-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_5-1-pod-ä»‹ç»" aria-hidden="true">#</a> 5.1 Pod ä»‹ç»</h3><h4 id="_5-1-1-pod-ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_5-1-1-pod-ç»“æ„" aria-hidden="true">#</a> 5.1.1 Pod ç»“æ„</h4><figure><img src="/assets/img/k8s/image-20200407121501907-1626781151898.png" alt="ç›¸å…³å›¾ç‰‡" height="300" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure><p>æ¯ä¸ª Pod ä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><p>ç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨ï¼Œæ•°é‡å¯å¤šå¯å°‘</p></li><li><p>Pause å®¹å™¨ï¼Œè¿™æ˜¯æ¯ä¸ª Pod éƒ½ä¼šæœ‰çš„ä¸€ä¸ª <strong>æ ¹å®¹å™¨</strong> ï¼Œå®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>å¯ä»¥ä»¥å®ƒä¸ºä¾æ®ï¼Œè¯„ä¼°æ•´ä¸ª Pod çš„å¥åº·çŠ¶æ€</p></li><li><p>å¯ä»¥åœ¨æ ¹å®¹å™¨ä¸Šè®¾ç½® Ip åœ°å€ï¼Œå…¶å®ƒå®¹å™¨éƒ½æ­¤ Ipï¼ˆPod IPï¼‰ï¼Œä»¥å®ç° Pod å†…éƒ¨çš„ç½‘è·¯é€šä¿¡</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">è¿™é‡Œæ˜¯ Pod å†…éƒ¨çš„é€šè®¯ï¼ŒPod çš„ä¹‹é—´çš„é€šè®¯é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œæˆ‘ä»¬å½“å‰ç¯å¢ƒç”¨çš„æ˜¯ Flannel</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li></ul><h4 id="_5-1-2-pod-å®šä¹‰-yaml-æ¶æ„æ€»è§ˆ" tabindex="-1"><a class="header-anchor" href="#_5-1-2-pod-å®šä¹‰-yaml-æ¶æ„æ€»è§ˆ" aria-hidden="true">#</a> 5.1.2 Pod å®šä¹‰(YAML æ¶æ„æ€»è§ˆ)</h4><p>ä¸‹é¢æ˜¯ Pod çš„èµ„æºæ¸…å•ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span><span style="color:#24292E;">       ã€€ </span><span style="color:#6A737D;">#å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:       ã€€ </span><span style="color:#6A737D;">#å¿…é€‰ï¼Œå…ƒæ•°æ®</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#å¿…é€‰ï¼ŒPod åç§°</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#Pod æ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&quot;default&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:       ã€€ã€€  </span><span style="color:#6A737D;">#è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">      ã€€          </span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#å¿…é€‰ï¼ŒPod ä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#å¿…é€‰ï¼ŒPod ä¸­å®¹å™¨åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#å¿…é€‰ï¼Œå®¹å™¨åç§°</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: [ </span><span style="color:#032F62;">Always|Never|IfNotPresent</span><span style="color:#24292E;"> ]  </span><span style="color:#6A737D;">#è·å–é•œåƒçš„ç­–ç•¥ </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">string</span><span style="color:#24292E;">]   </span><span style="color:#6A737D;">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">args</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">string</span><span style="color:#24292E;">]      </span><span style="color:#6A737D;">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">workingDir</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#å®¹å™¨çš„å·¥ä½œç›®å½•</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">      </span><span style="color:#6A737D;">#å¼•ç”¨ pod å®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨ volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#å­˜å‚¨å·åœ¨å®¹å™¨å†… mount çš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº 512 å­—ç¬¦</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#032F62;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">        </span><span style="color:#6A737D;">#ç«¯å£çš„åç§°</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostPort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;">       </span><span style="color:#6A737D;">#å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸ Container ç›¸åŒ</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#ç«¯å£åè®®ï¼Œæ”¯æŒ TCP å’Œ UDPï¼Œé»˜è®¤ TCP</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:   </span><span style="color:#6A737D;">#å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#ç¯å¢ƒå˜é‡åç§°</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#ç¯å¢ƒå˜é‡çš„å€¼</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#èµ„æºé™åˆ¶çš„è®¾ç½®</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#Cpu çš„é™åˆ¶ï¼Œå•ä½ä¸º core æ•°ï¼Œå°†ç”¨äº docker run --cpu-shares å‚æ•°</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸º Mib/Gibï¼Œå°†ç”¨äº docker run --memory å‚æ•°</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#èµ„æºè¯·æ±‚çš„è®¾ç½®</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#Cpu è¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">lifecycle</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#ç”Ÿå‘½å‘¨æœŸé’©å­</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">postStart</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">preStop</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#å¯¹ Pod å†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">:       ã€€ </span><span style="color:#6A737D;">#å¯¹ Pod å®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸º exec æ–¹å¼</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">string</span><span style="color:#24292E;">]  </span><span style="color:#6A737D;">#exec æ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#å¯¹ Pod å†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸º HttpGetï¼Œéœ€è¦åˆ¶å®š Pathã€port</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">number</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">HttpHeaders</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:     </span><span style="color:#6A737D;">#å¯¹ Pod å†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸º tcpSocket æ–¹å¼</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">number</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">       </span><span style="color:#6A737D;">#å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#22863A;">timeoutSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">    ã€€ã€€    </span><span style="color:#6A737D;">#å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ 1 ç§’</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#22863A;">periodSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">     ã€€ã€€    </span><span style="color:#6A737D;">#å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ 10 ç§’ä¸€æ¬¡</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#22863A;">successThreshold</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#22863A;">failureThreshold</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#22863A;">securityContext</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#22863A;">privileged</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">Always | Never | OnFailure</span><span style="color:#24292E;">]  </span><span style="color:#6A737D;">#Pod çš„é‡å¯ç­–ç•¥</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#è®¾ç½® NodeName è¡¨ç¤ºå°†è¯¥ Pod è°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„ node èŠ‚ç‚¹ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeSelector</span><span style="color:#24292E;">: </span><span style="color:#032F62;">obeject</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#è®¾ç½® NodeSelector è¡¨ç¤ºå°†è¯¥ Pod è°ƒåº¦åˆ°åŒ…å«è¿™ä¸ª label çš„ node ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">imagePullSecrets</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#Pull é•œåƒæ—¶ä½¿ç”¨çš„ secret åç§°ï¼Œä»¥ keyï¼šsecretkey æ ¼å¼æŒ‡å®š</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">hostNetwork</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸º falseï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:   </span><span style="color:#6A737D;">#åœ¨è¯¥ pod ä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumes ç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">emptyDir</span><span style="color:#24292E;">: {}       </span><span style="color:#6A737D;">#ç±»å‹ä¸º emtyDir çš„å­˜å‚¨å·ï¼Œä¸ Pod åŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#ç±»å‹ä¸º hostPath çš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½ Pod æ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">      ã€€ã€€        </span><span style="color:#6A737D;">#Pod æ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­ mount çš„ç›®å½•</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secret</span><span style="color:#24292E;">:       ã€€ã€€ã€€#</span><span style="color:#032F62;">ç±»å‹ä¸º secret çš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„ secret å¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">scretname</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:     </span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:         </span><span style="color:#6A737D;">#ç±»å‹ä¸º configMap çš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„ configMap å¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;">#å°æç¤ºï¼š</span></span>
<span class="line"><span style="color:#6A737D;">#   åœ¨è¿™é‡Œï¼Œå¯é€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹æ¯ç§èµ„æºçš„å¯é…ç½®é¡¹</span></span>
<span class="line"><span style="color:#6A737D;">#   kubectl explain èµ„æºç±»å‹         æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§å±æ€§</span></span>
<span class="line"><span style="color:#6A737D;">#   kubectl explain èµ„æºç±»å‹.å±æ€§     æŸ¥çœ‹å±æ€§çš„å­å±æ€§</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl explain pod</span></span>
<span class="line"><span style="color:#22863A;">KIND</span><span style="color:#24292E;">:     </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">VERSION</span><span style="color:#24292E;">:  </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">FIELDS</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">apiVersion   &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">kind &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">metadata     &lt;Object&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">spec &lt;Object&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">status       &lt;Object&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl explain pod.metadata</span></span>
<span class="line"><span style="color:#22863A;">KIND</span><span style="color:#24292E;">:     </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">VERSION</span><span style="color:#24292E;">:  </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">RESOURCE</span><span style="color:#24292E;">: </span><span style="color:#032F62;">metadata &lt;Object&gt;</span></span>
<span class="line"><span style="color:#22863A;">FIELDS</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">annotations  &lt;map[string]string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">clusterName  &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">creationTimestamp    &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">deletionGracePeriodSeconds   &lt;integer&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">deletionTimestamp    &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">finalizers   &lt;[]string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">generateName &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">generation   &lt;integer&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">labels       &lt;map[string]string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">managedFields        &lt;[]Object&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">name &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">namespace    &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">ownerReferences      &lt;[]Object&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">resourceVersion      &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">selfLink     &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">uid  &lt;string&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ kubernetes ä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å« 5 éƒ¨åˆ†ï¼š</p><ul><li><code>apiVersion &lt;string&gt; ç‰ˆæœ¬</code>ï¼Œç”± kubernetes å†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ°</li><li><code>kind &lt;string&gt; ç±»å‹</code>ï¼Œç”± kubernetes å†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ°</li><li><code>metadata &lt;Object&gt; å…ƒæ•°æ®</code>ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰ nameã€namespaceã€labels ç­‰</li><li><code>spec &lt;Object&gt; æè¿°</code>ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿°</li><li><code>status &lt;Object&gt; çŠ¶æ€ä¿¡æ¯</code>ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”± kubernetes è‡ªåŠ¨ç”Ÿæˆ</li></ul><p>åœ¨ä¸Šé¢çš„å±æ€§ä¸­ï¼Œspec æ˜¯æ¥ä¸‹æ¥ç ”ç©¶çš„é‡ç‚¹ï¼Œç»§ç»­çœ‹ä¸‹å®ƒçš„å¸¸è§å­å±æ€§:</p><ul><li><code>containers &lt;[]Object&gt;</code> å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</li><li><code>nodeName &lt;String&gt; </code>æ ¹æ® nodeName çš„å€¼å°† pod è°ƒåº¦åˆ°æŒ‡å®šçš„ Node èŠ‚ç‚¹ä¸Š</li><li><code>nodeSelector &lt;map[]&gt;</code> æ ¹æ® NodeSelector ä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥ Pod è°ƒåº¦åˆ°åŒ…å«è¿™äº› label çš„ Node ä¸Š</li><li><code>hostNetwork &lt;boolean&gt;</code> æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸º falseï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</li><li><code>volumes &lt;[]Object&gt;</code> å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰ Pod ä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯</li><li><code>restartPolicy &lt;string&gt;</code> é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤º Pod åœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥</li></ul><h3 id="_5-2-pod-é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-2-pod-é…ç½®" aria-hidden="true">#</a> 5.2 Pod é…ç½®</h3><p>æœ¬å°èŠ‚ä¸»è¦æ¥ç ”ç©¶<code>pod.spec.containers</code>å±æ€§ï¼Œè¿™ä¹Ÿæ˜¯ pod é…ç½®ä¸­æœ€ä¸ºå…³é”®çš„ä¸€é¡¹é…ç½®ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl explain pod.spec.containers</span></span>
<span class="line"><span style="color:#6F42C1;">KIND:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#6F42C1;">VERSION:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">RESOURCE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containers</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># æ•°ç»„ï¼Œä»£è¡¨å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨</span></span>
<span class="line"><span style="color:#6F42C1;">FIELDS:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># å®¹å™¨åç§°</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">image</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">imagePullPolicy</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># é•œåƒæ‹‰å–ç­–ç•¥ </span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">command</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">args</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤éœ€è¦çš„å‚æ•°åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">env</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å®¹å™¨ç¯å¢ƒå˜é‡çš„é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">ports</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># å®¹å™¨éœ€è¦æš´éœ²çš„ç«¯å£å·åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">resources</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">      </span><span style="color:#6A737D;"># èµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„è®¾ç½®</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-1-åŸºæœ¬é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-2-1-åŸºæœ¬é…ç½®" aria-hidden="true">#</a> 5.2.1 åŸºæœ¬é…ç½®</h4><p>åˆ›å»º pod-base.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-base</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">user</span><span style="color:#24292E;">: </span><span style="color:#032F62;">heima</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:1.30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæ¯”è¾ƒç®€å• Pod çš„é…ç½®ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå®¹å™¨ï¼š</p><ul><li>nginxï¼šç”¨ 1.17.1 ç‰ˆæœ¬çš„ nginx é•œåƒåˆ›å»ºï¼Œï¼ˆnginx æ˜¯ä¸€ä¸ªè½»é‡çº§ web å®¹å™¨ï¼‰</li><li>busyboxï¼šç”¨ 1.30 ç‰ˆæœ¬çš„ busybox é•œåƒåˆ›å»ºï¼Œï¼ˆbusybox æ˜¯ä¸€ä¸ªå°å·§çš„ linux å‘½ä»¤é›†åˆï¼‰</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 pod</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl apply -f pod-base.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-base created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod çŠ¶å†µ</span></span>
<span class="line"><span style="color:#6A737D;"># READY 1/2 : è¡¨ç¤ºå½“å‰ Pod ä¸­æœ‰ 2 ä¸ªå®¹å™¨ï¼Œå…¶ä¸­ 1 ä¸ªå‡†å¤‡å°±ç»ªï¼Œ1 ä¸ªæœªå°±ç»ª</span></span>
<span class="line"><span style="color:#6A737D;"># RESTARTS  : é‡å¯æ¬¡æ•°ï¼Œå› ä¸ºæœ‰ 1 ä¸ªå®¹å™¨æ•…éšœäº†ï¼ŒPod ä¸€ç›´åœ¨é‡å¯è¯•å›¾æ¢å¤å®ƒ</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 pod</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pod -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME       READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-base   1/2     Running   4          95s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å¯ä»¥é€šè¿‡ describe æŸ¥çœ‹å†…éƒ¨çš„è¯¦æƒ…</span></span>
<span class="line"><span style="color:#6A737D;"># æ­¤æ—¶å·²ç»è¿è¡Œèµ·æ¥äº†ä¸€ä¸ªåŸºæœ¬çš„ Podï¼Œè™½ç„¶å®ƒæš‚æ—¶æœ‰é—®é¢˜</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 pod</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe pod pod-base -n dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-2-é•œåƒæ‹‰å–" tabindex="-1"><a class="header-anchor" href="#_5-2-2-é•œåƒæ‹‰å–" aria-hidden="true">#</a> 5.2.2 é•œåƒæ‹‰å–</h4><p>åˆ›å»º pod-imagepullpolicy.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-imagepullpolicy</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:1.30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>imagePullPolicyï¼Œç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥ï¼Œkubernetes æ”¯æŒé…ç½®ä¸‰ç§æ‹‰å–ç­–ç•¥ï¼š</p><ul><li>Alwaysï¼šæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆä¸€ç›´è¿œç¨‹ä¸‹è½½ï¼‰</li><li>IfNotPresentï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆæœ¬åœ°æœ‰å°±æœ¬åœ° æœ¬åœ°æ²¡è¿œç¨‹ä¸‹è½½ï¼‰</li><li>Neverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒï¼Œä»ä¸å»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œæœ¬åœ°æ²¡æœ‰å°±æŠ¥é”™ ï¼ˆä¸€ç›´ä½¿ç”¨æœ¬åœ°ï¼‰</li></ul><blockquote><p>é»˜è®¤å€¼è¯´æ˜ï¼š</p><p>å¦‚æœé•œåƒ tag ä¸ºå…·ä½“ç‰ˆæœ¬å·ï¼Œ é»˜è®¤ç­–ç•¥æ˜¯ï¼šIfNotPresent</p><p>å¦‚æœé•œåƒ tag ä¸ºï¼šlatestï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰ ï¼Œé»˜è®¤ç­–ç•¥æ˜¯ always</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 pod</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-imagepullpolicy.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-imagepullpolicy created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod è¯¦æƒ…</span></span>
<span class="line"><span style="color:#6A737D;"># æ­¤æ—¶æ˜æ˜¾å¯ä»¥çœ‹åˆ° nginx é•œåƒæœ‰ä¸€æ­¥ Pulling image &quot;nginx:1.17.1&quot;çš„è¿‡ç¨‹</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 pod</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe pod pod-imagepullpolicy -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#22863A;">Events</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Type     Reason     Age               From               Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">----     ------     ----              ----               -------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Scheduled  &lt;unknown&gt;         default-scheduler  Successfully assigned dev/pod-imagePullPolicy to node1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Pulling    32s               kubelet, node1     Pulling image &quot;nginx:1.17.1&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Pulled     26s               kubelet, node1     Successfully pulled image &quot;nginx:1.17.1&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Created    26s               kubelet, node1     Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Started    25s               kubelet, node1     Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Pulled     7s (x3 over 25s)  kubelet, node1     Container image &quot;busybox:1.30&quot; already present on machine</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Created    7s (x3 over 25s)  kubelet, node1     Created container busybox</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Started    7s (x3 over 25s)  kubelet, node1     Started container busybox</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-3-å¯åŠ¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_5-2-3-å¯åŠ¨å‘½ä»¤" aria-hidden="true">#</a> 5.2.3 å¯åŠ¨å‘½ä»¤</h4><p>åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯çš„ busybox å®¹å™¨ä¸€ç›´æ²¡æœ‰æˆåŠŸè¿è¡Œï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´è¿™ä¸ªå®¹å™¨çš„æ•…éšœå‘¢ï¼Ÿ</p><p>åŸæ¥ busybox å¹¶ä¸æ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œæ˜¯ç±»ä¼¼äºä¸€ä¸ªå·¥å…·ç±»çš„é›†åˆï¼Œkubernetes é›†ç¾¤å¯åŠ¨ç®¡ç†åï¼Œå®ƒä¼šè‡ªåŠ¨å…³é—­ã€‚è§£å†³æ–¹æ³•å°±æ˜¯è®©å…¶ä¸€ç›´åœ¨è¿è¡Œï¼Œè¿™å°±ç”¨åˆ°äº† command é…ç½®ã€‚</p><p>åˆ›å»º pod-command.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-command</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:1.30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;/bin/sh&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 30; done;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>commandï¼Œç”¨äºåœ¨ pod ä¸­çš„å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ä¹‹åè¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</p><blockquote><p>ç¨å¾®è§£é‡Šä¸‹ä¸Šé¢å‘½ä»¤çš„æ„æ€ï¼š</p><p>&quot;/bin/sh&quot;,&quot;-c&quot;, ä½¿ç”¨ sh æ‰§è¡Œå‘½ä»¤</p><p>touch /tmp/hello.txt; åˆ›å»ºä¸€ä¸ª/tmp/hello.txt æ–‡ä»¶</p><p>while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done; æ¯éš” 3 ç§’å‘æ–‡ä»¶ä¸­å†™å…¥å½“å‰æ—¶é—´</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-command</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod çŠ¶æ€</span></span>
<span class="line"><span style="color:#6A737D;"># æ­¤æ—¶å‘ç°ä¸¤ä¸ª pod éƒ½æ­£å¸¸è¿è¡Œäº†</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 pod]# kubectl get pods pod-command -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">          </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod-command</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">/2</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Runing</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">s</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿›å…¥ pod ä¸­çš„ busybox å®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹</p><p>è¡¥å……ä¸€ä¸ªå‘½ä»¤: kubectl exec pod åç§° -n å‘½åç©ºé—´ -it -c å®¹å™¨åç§° /bin/sh åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤</p><p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥è¿›å…¥æŸä¸ªå®¹å™¨çš„å†…éƒ¨ï¼Œç„¶åè¿›è¡Œç›¸å…³æ“ä½œäº†</p><p>æ¯”å¦‚ï¼Œå¯ä»¥æŸ¥çœ‹ txt æ–‡ä»¶çš„å†…å®¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># tail -f /tmp/hello.txt</span></span>
<span class="line"><span style="color:#6F42C1;">14:44:19</span></span>
<span class="line"><span style="color:#6F42C1;">14:44:22</span></span>
<span class="line"><span style="color:#6F42C1;">14:44:25</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç‰¹åˆ«è¯´æ˜ï¼š</strong></p><p>é€šè¿‡ä¸Šé¢å‘ç° command å·²ç»å¯ä»¥å®Œæˆå¯åŠ¨å‘½ä»¤å’Œä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦æä¾›ä¸€ä¸ª args é€‰é¡¹ï¼Œç”¨äºä¼ é€’å‚æ•°å‘¢?è¿™å…¶å®è·Ÿ docker æœ‰ç‚¹å…³ç³»ï¼Œkubernetes ä¸­çš„ commandã€args ä¸¤é¡¹å…¶å®æ˜¯å®ç°è¦†ç›– Dockerfile ä¸­ ENTRYPOINT çš„åŠŸèƒ½ã€‚</p><ol><li>å¦‚æœ command å’Œ args å‡æ²¡æœ‰å†™ï¼Œé‚£ä¹ˆç”¨ Dockerfile çš„é…ç½®ã€‚</li><li>å¦‚æœ command å†™äº†ï¼Œä½† args æ²¡æœ‰å†™ï¼Œé‚£ä¹ˆ Dockerfile é»˜è®¤çš„é…ç½®ä¼šè¢«å¿½ç•¥ï¼Œæ‰§è¡Œè¾“å…¥çš„ command</li><li>å¦‚æœ command æ²¡å†™ï¼Œä½† args å†™äº†ï¼Œé‚£ä¹ˆ Dockerfile ä¸­é…ç½®çš„ ENTRYPOINT çš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œï¼Œä½¿ç”¨å½“å‰ args çš„å‚æ•°</li><li>å¦‚æœ command å’Œ args éƒ½å†™äº†ï¼Œé‚£ä¹ˆ Dockerfile çš„é…ç½®è¢«å¿½ç•¥ï¼Œæ‰§è¡Œ command å¹¶è¿½åŠ ä¸Š args å‚æ•°</li></ol><h4 id="_5-2-4-ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#_5-2-4-ç¯å¢ƒå˜é‡" aria-hidden="true">#</a> 5.2.4 ç¯å¢ƒå˜é‡</h4><p>åˆ›å»º pod-env.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-env</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:1.30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;/bin/sh&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;while true;do /bin/echo $(date +%T);sleep 60; done;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># è®¾ç½®ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;username&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;admin&quot;</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;password&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>envï¼Œç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨ pod ä¸­çš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-env.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-env</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># è¿›å…¥å®¹å™¨ï¼Œè¾“å‡ºç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl exec pod-env -n dev -c busybox -it /bin/sh</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># echo $username</span></span>
<span class="line"><span style="color:#6F42C1;">admin</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># echo $password</span></span>
<span class="line"><span style="color:#6F42C1;">123456</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆæ¨èï¼Œæ¨èå°†è¿™äº›é…ç½®å•ç‹¬å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–¹å¼å°†åœ¨åé¢ä»‹ç»ã€‚</p><h4 id="_5-2-5-ç«¯å£è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_5-2-5-ç«¯å£è®¾ç½®" aria-hidden="true">#</a> 5.2.5 ç«¯å£è®¾ç½®</h4><p>æœ¬å°èŠ‚æ¥ä»‹ç»å®¹å™¨çš„ç«¯å£è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯ containers çš„ ports é€‰é¡¹ã€‚</p><p>é¦–å…ˆçœ‹ä¸‹ ports æ”¯æŒçš„å­é€‰é¡¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl explain pod.spec.containers.ports</span></span>
<span class="line"><span style="color:#6F42C1;">KIND:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#6F42C1;">VERSION:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">RESOURCE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ports</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">FIELDS:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œå¿…é¡»ä¿è¯ name åœ¨ pod ä¸­æ˜¯å”¯ä¸€çš„		</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">containerPort&lt;integer&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å®¹å™¨è¦ç›‘å¬çš„ç«¯å£(0&lt;x&lt;65536)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">hostPort</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">intege</span><span style="color:#24292E;">r</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å®¹å™¨è¦åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ï¼Œä¸»æœºä¸Šåªèƒ½è¿è¡Œå®¹å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ä¸€èˆ¬çœç•¥) </span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">hostIP</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># è¦å°†å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°çš„ä¸»æœº IP(ä¸€èˆ¬çœç•¥)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">protocol</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># ç«¯å£åè®®ã€‚å¿…é¡»æ˜¯ UDPã€TCP æˆ– SCTPã€‚é»˜è®¤ä¸ºâ€œTCPâ€ã€‚</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»º pod-ports.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-ports</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># è®¾ç½®å®¹å™¨æš´éœ²çš„ç«¯å£åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¿é—®å®¹å™¨ä¸­çš„ç¨‹åºéœ€è¦ä½¿ç”¨çš„æ˜¯<code>Podip:containerPort</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-ports.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-ports</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod</span></span>
<span class="line"><span style="color:#6A737D;"># åœ¨ä¸‹é¢å¯ä»¥æ˜æ˜¾çœ‹åˆ°é…ç½®ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod pod-ports -n dev -o yaml</span></span>
<span class="line"><span style="color:#005CC5;">......</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">containers:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">imagePullPolicy:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ports:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerPort:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># è®¿é—®å®¹å™¨ä¸­çš„ç¨‹åºéœ€è¦ä½¿ç”¨çš„æ˜¯`Podip:containerPort`</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">protocol:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TCP</span></span>
<span class="line"><span style="color:#005CC5;">......</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-6-èµ„æºé…é¢" tabindex="-1"><a class="header-anchor" href="#_5-2-6-èµ„æºé…é¢" aria-hidden="true">#</a> 5.2.6 èµ„æºé…é¢</h4><p>å®¹å™¨ä¸­çš„ç¨‹åºè¦è¿è¡Œï¼Œè‚¯å®šæ˜¯è¦å ç”¨ä¸€å®šèµ„æºçš„ï¼Œæ¯”å¦‚ cpu å’Œå†…å­˜ç­‰ï¼Œå¦‚æœä¸å¯¹æŸä¸ªå®¹å™¨çš„èµ„æºåšé™åˆ¶ï¼Œé‚£ä¹ˆå®ƒå°±å¯èƒ½åƒæ‰å¤§é‡èµ„æºï¼Œå¯¼è‡´å…¶å®ƒå®¹å™¨æ— æ³•è¿è¡Œã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetes æä¾›äº†å¯¹å†…å­˜å’Œ cpu çš„èµ„æºè¿›è¡Œé…é¢çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¸»è¦é€šè¿‡ resources é€‰é¡¹å®ç°ï¼Œä»–æœ‰ä¸¤ä¸ªå­é€‰é¡¹ï¼š</p><ul><li><strong>limitsï¼š</strong> ç”¨äºé™åˆ¶è¿è¡Œæ—¶å®¹å™¨çš„æœ€å¤§å ç”¨èµ„æºï¼Œå½“å®¹å™¨å ç”¨èµ„æºè¶…è¿‡ limits æ—¶ä¼šè¢«ç»ˆæ­¢ï¼Œå¹¶è¿›è¡Œé‡å¯</li><li><strong>requests ï¼š</strong> ç”¨äºè®¾ç½®å®¹å™¨éœ€è¦çš„æœ€å°èµ„æºï¼Œå¦‚æœç¯å¢ƒèµ„æºä¸å¤Ÿï¼Œå®¹å™¨å°†æ— æ³•å¯åŠ¨</li></ul><p>å¯ä»¥é€šè¿‡ä¸Šé¢ä¸¤ä¸ªé€‰é¡¹è®¾ç½®èµ„æºçš„ä¸Šä¸‹é™ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»º pod-resources.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-resources</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># èµ„æºé…é¢</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;"># é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># CPU é™åˆ¶ï¼Œå•ä½æ˜¯ core æ•°</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;10Gi&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å†…å­˜é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;1&quot;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># CPU é™åˆ¶ï¼Œå•ä½æ˜¯ core æ•°</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;10Mi&quot;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># å†…å­˜é™åˆ¶</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™å¯¹ cpu å’Œ memory çš„å•ä½åšä¸€ä¸ªè¯´æ˜ï¼š</p><ul><li>cpuï¼šcore æ•°ï¼Œå¯ä»¥ä¸ºæ•´æ•°æˆ–å°æ•°</li><li>memoryï¼š å†…å­˜å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨ Giã€Miã€Gã€M ç­‰å½¢å¼</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># è¿è¡Œ Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create  -f pod-resources.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-resources</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹å‘ç° pod è¿è¡Œæ­£å¸¸</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod pod-resources -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">            </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">pod-resources</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">39</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ¥ä¸‹æ¥ï¼Œåœæ­¢ Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete  -f pod-resources.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pod-resources&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ç¼–è¾‘ podï¼Œä¿®æ”¹ resources.requests.memory çš„å€¼ä¸º 10Gi</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# vim pod-resources.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å†æ¬¡å¯åŠ¨ pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create  -f pod-resources.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-resources</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod çŠ¶æ€ï¼Œå‘ç° Pod å¯åŠ¨å¤±è´¥</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod pod-resources -n dev -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">            </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">          </span></span>
<span class="line"><span style="color:#6F42C1;">pod-resources</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">20</span><span style="color:#032F62;">s</span><span style="color:#24292E;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod è¯¦æƒ…ä¼šå‘ç°ï¼Œå¦‚ä¸‹æç¤º</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe pod pod-resources -n dev</span></span>
<span class="line"><span style="color:#005CC5;">......</span></span>
<span class="line"><span style="color:#6F42C1;">Warning</span><span style="color:#24292E;">  </span><span style="color:#032F62;">FailedScheduling</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#032F62;">default-scheduler</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">available:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">had</span><span style="color:#24292E;"> </span><span style="color:#032F62;">taint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{node-role.kubernetes.io/master:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">that</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">didn&#39;t tolerate, 2 Insufficient memory.(å†…å­˜ä¸è¶³)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-pod-ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_5-3-pod-ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> 5.3 Pod ç”Ÿå‘½å‘¨æœŸ</h3><p>æˆ‘ä»¬ä¸€èˆ¬å°† pod å¯¹è±¡ä»åˆ›å»ºè‡³ç»ˆçš„è¿™æ®µæ—¶é—´èŒƒå›´ç§°ä¸º pod çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¸»è¦åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p><ul><li>pod åˆ›å»ºè¿‡ç¨‹</li><li>è¿è¡Œåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰è¿‡ç¨‹</li><li>è¿è¡Œä¸»å®¹å™¨ï¼ˆmain containerï¼‰ <ul><li>å®¹å™¨å¯åŠ¨åé’©å­ï¼ˆpost startï¼‰ã€å®¹å™¨ç»ˆæ­¢å‰é’©å­ï¼ˆpre stopï¼‰</li><li>å®¹å™¨çš„å­˜æ´»æ€§æ¢æµ‹ï¼ˆliveness probeï¼‰ã€å°±ç»ªæ€§æ¢æµ‹ï¼ˆreadiness probeï¼‰</li></ul></li><li>pod ç»ˆæ­¢è¿‡ç¨‹</li></ul><p>åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒPod ä¼šå‡ºç° 5 ç§ <strong>çŠ¶æ€</strong> ï¼ˆ <strong>ç›¸ä½</strong> ï¼‰ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>æŒ‚èµ·ï¼ˆPendingï¼‰ï¼šapiserver å·²ç»åˆ›å»ºäº† pod èµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­</li><li>è¿è¡Œä¸­ï¼ˆRunningï¼‰ï¼špod å·²ç»è¢«è°ƒåº¦è‡³æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢« kubelet åˆ›å»ºå®Œæˆ</li><li><strong>æˆåŠŸï¼ˆSucceededï¼‰</strong> ï¼špod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯</li><li>å¤±è´¥ï¼ˆFailedï¼‰ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é 0 å€¼çš„é€€å‡ºçŠ¶æ€</li><li>æœªçŸ¥ï¼ˆUnknownï¼‰ï¼šapiserver æ— æ³•æ­£å¸¸è·å–åˆ° pod å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±ç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´</li></ul><h4 id="_5-3-1-åˆ›å»ºå’Œç»ˆæ­¢" tabindex="-1"><a class="header-anchor" href="#_5-3-1-åˆ›å»ºå’Œç»ˆæ­¢" aria-hidden="true">#</a> 5.3.1 åˆ›å»ºå’Œç»ˆæ­¢</h4><p><strong>pod çš„åˆ›å»ºè¿‡ç¨‹</strong></p><ol><li><p>ç”¨æˆ·é€šè¿‡ kubectl æˆ–å…¶ä»– api å®¢æˆ·ç«¯æäº¤éœ€è¦åˆ›å»ºçš„ pod ä¿¡æ¯ç»™ apiServer</p></li><li><p>apiServer å¼€å§‹ç”Ÿæˆ pod å¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯å­˜å…¥ etcdï¼Œç„¶åè¿”å›ç¡®è®¤ä¿¡æ¯è‡³å®¢æˆ·ç«¯</p></li><li><p>apiServer å¼€å§‹åæ˜  etcd ä¸­çš„ pod å¯¹è±¡çš„å˜åŒ–ï¼Œå…¶å®ƒç»„ä»¶ä½¿ç”¨ watch æœºåˆ¶æ¥è·Ÿè¸ªæ£€æŸ¥ apiServer ä¸Šçš„å˜åŠ¨</p></li><li><p>scheduler å‘ç°æœ‰æ–°çš„ pod å¯¹è±¡è¦åˆ›å»ºï¼Œå¼€å§‹ä¸º Pod åˆ†é…ä¸»æœºå¹¶å°†ç»“æœä¿¡æ¯æ›´æ–°è‡³ apiServer</p></li><li><p>node èŠ‚ç‚¹ä¸Šçš„ kubelet å‘ç°æœ‰ pod è°ƒåº¦è¿‡æ¥ï¼Œå°è¯•è°ƒç”¨ docker å¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†ç»“æœå›é€è‡³ apiServer</p></li><li><p>apiServer å°†æ¥æ”¶åˆ°çš„ pod çŠ¶æ€ä¿¡æ¯å­˜å…¥ etcd ä¸­</p><figure><img src="/assets/img/k8s/image-20200406184656917-1626782168787.png" alt="ç›¸å…³å›¾ç‰‡" height="300" tabindex="0" loading="lazy"><figcaption>ç›¸å…³å›¾ç‰‡</figcaption></figure></li></ol><p><strong>pod çš„ç»ˆæ­¢è¿‡ç¨‹</strong></p><ol><li>ç”¨æˆ·å‘ apiServer å‘é€åˆ é™¤ pod å¯¹è±¡çš„å‘½ä»¤</li><li>apiServcer ä¸­çš„ pod å¯¹è±¡ä¿¡æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ›´æ–°ï¼Œåœ¨å®½é™æœŸå†…ï¼ˆé»˜è®¤ 30sï¼‰ï¼Œpod è¢«è§†ä¸º dead</li><li>å°† pod æ ‡è®°ä¸º terminating çŠ¶æ€</li><li>kubelet åœ¨ç›‘æ§åˆ° pod å¯¹è±¡è½¬ä¸º terminating çŠ¶æ€çš„åŒæ—¶å¯åŠ¨ pod å…³é—­è¿‡ç¨‹</li><li>ç«¯ç‚¹æ§åˆ¶å™¨ç›‘æ§åˆ° pod å¯¹è±¡çš„å…³é—­è¡Œä¸ºæ—¶å°†å…¶ä»æ‰€æœ‰åŒ¹é…åˆ°æ­¤ç«¯ç‚¹çš„ service èµ„æºçš„ç«¯ç‚¹åˆ—è¡¨ä¸­ç§»é™¤</li><li>å¦‚æœå½“å‰ pod å¯¹è±¡å®šä¹‰äº† preStop é’©å­å¤„ç†å™¨ï¼Œåˆ™åœ¨å…¶æ ‡è®°ä¸º terminating åå³ä¼šä»¥åŒæ­¥çš„æ–¹å¼å¯åŠ¨æ‰§è¡Œ</li><li>pod å¯¹è±¡ä¸­çš„å®¹å™¨è¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·</li><li>å®½é™æœŸç»“æŸåï¼Œè‹¥ pod ä¸­è¿˜å­˜åœ¨ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆ pod å¯¹è±¡ä¼šæ”¶åˆ°ç«‹å³ç»ˆæ­¢çš„ä¿¡å·</li><li>kubelet è¯·æ±‚ apiServer å°†æ­¤ pod èµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º 0 ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶ pod å¯¹äºç”¨æˆ·å·²ä¸å¯è§</li></ol><h4 id="_5-3-2-åˆå§‹åŒ–å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_5-3-2-åˆå§‹åŒ–å®¹å™¨" aria-hidden="true">#</a> 5.3.2 åˆå§‹åŒ–å®¹å™¨</h4><p>åˆå§‹åŒ–å®¹å™¨æ˜¯åœ¨ pod çš„ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰è¦è¿è¡Œçš„å®¹å™¨ï¼Œä¸»è¦æ˜¯åšä¸€äº›ä¸»å®¹å™¨çš„å‰ç½®å·¥ä½œï¼Œå®ƒå…·æœ‰ä¸¤å¤§ç‰¹å¾ï¼š</p><ol><li>åˆå§‹åŒ–å®¹å™¨å¿…é¡»è¿è¡Œå®Œæˆç›´è‡³ç»“æŸï¼Œè‹¥æŸåˆå§‹åŒ–å®¹å™¨è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆ kubernetes éœ€è¦é‡å¯å®ƒç›´åˆ°æˆåŠŸå®Œæˆ</li><li>åˆå§‹åŒ–å®¹å™¨å¿…é¡»æŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œå½“ä¸”ä»…å½“å‰ä¸€ä¸ªæˆåŠŸä¹‹åï¼Œåé¢çš„ä¸€ä¸ªæ‰èƒ½è¿è¡Œ</li></ol><p>åˆå§‹åŒ–å®¹å™¨æœ‰å¾ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æœ€å¸¸è§çš„å‡ ä¸ªï¼š</p><ul><li>æä¾›ä¸»å®¹å™¨é•œåƒä¸­ä¸å…·å¤‡çš„å·¥å…·ç¨‹åºæˆ–è‡ªå®šä¹‰ä»£ç </li><li>åˆå§‹åŒ–å®¹å™¨è¦å…ˆäºåº”ç”¨å®¹å™¨ä¸²è¡Œå¯åŠ¨å¹¶è¿è¡Œå®Œæˆï¼Œå› æ­¤å¯ç”¨äºå»¶ååº”ç”¨å®¹å™¨çš„å¯åŠ¨ç›´è‡³å…¶ä¾èµ–çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³</li></ul><p>æ¥ä¸‹æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¨¡æ‹Ÿä¸‹é¢è¿™ä¸ªéœ€æ±‚ï¼š</p><p>å‡è®¾è¦ä»¥ä¸»å®¹å™¨æ¥è¿è¡Œ nginxï¼Œä½†æ˜¯è¦æ±‚åœ¨è¿è¡Œ nginx ä¹‹å‰å…ˆè¦èƒ½å¤Ÿè¿æ¥ä¸Š mysql å’Œ redis æ‰€åœ¨æœåŠ¡å™¨</p><p>ä¸ºäº†ç®€åŒ–æµ‹è¯•ï¼Œäº‹å…ˆè§„å®šå¥½ mysql<code>(192.168.90.14)</code>å’Œ redis<code>(192.168.90.15)</code>æœåŠ¡å™¨çš„åœ°å€</p><p>åˆ›å»º pod-initcontainer.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-initcontainer</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">main-container</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">initContainers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test-mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:1.30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&#39;sh&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;-c&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;until ping 192.168.88.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test-redis</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:1.30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&#39;sh&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;-c&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;until ping 192.168.88.15 -c 1 ; do echo waiting for reids...; sleep 2; done;&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-initcontainer.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-initcontainer created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod çŠ¶æ€</span></span>
<span class="line"><span style="color:#6A737D;"># å‘ç° pod å¡åœ¨å¯åŠ¨ç¬¬ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨è¿‡ç¨‹ä¸­ï¼Œåé¢çš„å®¹å™¨ä¸ä¼šè¿è¡Œ</span></span>
<span class="line"><span style="color:#032F62;">root@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">.....</span></span>
<span class="line"><span style="color:#22863A;">Events</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Type    Reason     Age   From               Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">----    ------     ----  ----               -------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal  Scheduled  49s   default-scheduler  Successfully assigned dev/pod-initcontainer to node1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal  Pulled     48s   kubelet, node1     Container image &quot;busybox:1.30&quot; already present on machine</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal  Created    48s   kubelet, node1     Created container test-mysql</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal  Started    48s   kubelet, node1     Started container test-mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># åŠ¨æ€æŸ¥çœ‹ pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-initcontainer -n dev -w</span></span>
<span class="line"><span style="color:#032F62;">NAME                             READY   STATUS     RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-initcontainer                0/1     Init:0/2   0          15s</span></span>
<span class="line"><span style="color:#032F62;">pod-initcontainer                0/1     Init:1/2   0          52s</span></span>
<span class="line"><span style="color:#032F62;">pod-initcontainer                0/1     Init:1/2   0          53s</span></span>
<span class="line"><span style="color:#032F62;">pod-initcontainer                0/1     PodInitializing   0          89s</span></span>
<span class="line"><span style="color:#032F62;">pod-initcontainer                1/1     Running           0          90s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ¥ä¸‹æ¥æ–°å¼€ä¸€ä¸ª shellï¼Œä¸ºå½“å‰æœåŠ¡å™¨æ–°å¢ä¸¤ä¸ª ipï¼Œè§‚å¯Ÿ pod çš„å˜åŒ–</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">ifconfig ens33:1 192.168.88.14 netmask 255.255.255.0 up</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">ifconfig ens33:2 192.168.88.15 netmask 255.255.255.0 up</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-3-é’©å­å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_5-3-3-é’©å­å‡½æ•°" aria-hidden="true">#</a> 5.3.3 é’©å­å‡½æ•°</h4><p>é’©å­å‡½æ•°èƒ½å¤Ÿæ„ŸçŸ¥è‡ªèº«ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ï¼Œå¹¶åœ¨ç›¸åº”çš„æ—¶åˆ»åˆ°æ¥æ—¶è¿è¡Œç”¨æˆ·æŒ‡å®šçš„ç¨‹åºä»£ç ã€‚</p><p>kubernetes åœ¨ä¸»å®¹å™¨çš„å¯åŠ¨ä¹‹åå’Œåœæ­¢ä¹‹å‰æä¾›äº†ä¸¤ä¸ªé’©å­å‡½æ•°ï¼š</p><ul><li>post startï¼šå®¹å™¨åˆ›å»ºä¹‹åæ‰§è¡Œï¼Œå¦‚æœå¤±è´¥äº†ä¼šé‡å¯å®¹å™¨</li><li>pre stop ï¼šå®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åå®¹å™¨å°†æˆåŠŸç»ˆæ­¢ï¼Œåœ¨å…¶å®Œæˆä¹‹å‰ä¼šé˜»å¡åˆ é™¤å®¹å™¨çš„æ“ä½œ</li></ul><p>é’©å­å¤„ç†å™¨æ”¯æŒä½¿ç”¨ä¸‹é¢ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š</p><ul><li><p>Exec å‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">lifecycle</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">postStart</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">cat</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">/tmp/healthy</span></span>
<span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>TCPSocketï¼šåœ¨å½“å‰å®¹å™¨å°è¯•è®¿é—®æŒ‡å®šçš„ socket</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">â€¦â€¦</span><span style="color:#24292E;">      </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">lifecycle</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">postStart</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>HTTPGetï¼šåœ¨å½“å‰å®¹å™¨ä¸­å‘æŸ url å‘èµ· http è¯·æ±‚</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">lifecycle</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">postStart</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#URI åœ°å€</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#ç«¯å£å·</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">192.168.5.3</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#ä¸»æœºåœ°å€</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HTTP</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#æ”¯æŒçš„åè®®ï¼Œhttp æˆ–è€… https</span></span>
<span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>æ¥ä¸‹æ¥ï¼Œä»¥ exec æ–¹å¼ä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹é’©å­å‡½æ•°çš„ä½¿ç”¨ï¼Œåˆ›å»º pod-hook-exec.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-hook-exec</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">main-container</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">lifecycle</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">postStart</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä¿®æ”¹æ‰ nginx çš„é»˜è®¤é¦–é¡µå†…å®¹</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;/bin/sh&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;echo postStart... &gt; /usr/share/nginx/html/index.html&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">preStop</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># åœ¨å®¹å™¨åœæ­¢ä¹‹å‰åœæ­¢ nginx æœåŠ¡</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;/usr/sbin/nginx&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-s&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;quit&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-hook-exec.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-hook-exec created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods  pod-hook-exec -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME           READY   STATUS     RESTARTS   AGE    IP            NODE</span><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#032F62;">pod-hook-exec  1/1     Running    0          29s    10.244.2.48   node2</span><span style="color:#24292E;">   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># è®¿é—® pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">curl 10.244.2.48</span></span>
<span class="line"><span style="color:#032F62;">postStart...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-4-å®¹å™¨æ¢æµ‹" tabindex="-1"><a class="header-anchor" href="#_5-3-4-å®¹å™¨æ¢æµ‹" aria-hidden="true">#</a> 5.3.4 å®¹å™¨æ¢æµ‹</h4><p>å®¹å™¨æ¢æµ‹ç”¨äºæ£€æµ‹å®¹å™¨ä¸­çš„åº”ç”¨å®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯ä¿éšœä¸šåŠ¡å¯ç”¨æ€§çš„ä¸€ç§ä¼ ç»Ÿæœºåˆ¶ã€‚å¦‚æœç»è¿‡æ¢æµ‹ï¼Œå®ä¾‹çš„çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆ kubernetes å°±ä¼šæŠŠè¯¥é—®é¢˜å®ä¾‹&quot; æ‘˜é™¤ &quot;ï¼Œä¸æ‰¿æ‹…ä¸šåŠ¡æµé‡ã€‚</p><p><strong>kubernetes æä¾›äº†ä¸¤ç§æ¢é’ˆæ¥å®ç°å®¹å™¨æ¢æµ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</strong></p><ul><li>liveness probesï¼šå­˜æ´»æ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œk8s ä¼šé‡å¯å®¹å™¨</li><li>readiness probesï¼šå°±ç»ªæ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¯ä»¥æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœä¸èƒ½ï¼Œk8s ä¸ä¼šè½¬å‘æµé‡</li></ul><blockquote><p><strong>livenessProbe å†³å®šæ˜¯å¦é‡å¯å®¹å™¨ï¼ŒreadinessProbe å†³å®šæ˜¯å¦å°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨</strong> ã€‚</p></blockquote><p>ä¸Šé¢ä¸¤ç§æ¢é’ˆç›®å‰å‡æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹å¼ï¼š</p><ul><li><p>Exec å‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º 0ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">command</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">cat</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">/tmp/healthy</span></span>
<span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>TCPSocketï¼šå°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">â€¦â€¦</span><span style="color:#24292E;">      </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>HTTPGetï¼šè°ƒç”¨å®¹å™¨å†… Web åº”ç”¨çš„ URLï¼Œå¦‚æœè¿”å›çš„çŠ¶æ€ç åœ¨ 200 å’Œ 399 ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#URI åœ°å€</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#ç«¯å£å·</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">127.0.0.1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#ä¸»æœºåœ°å€</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HTTP</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#æ”¯æŒçš„åè®®ï¼Œhttp æˆ–è€… https</span></span>
<span class="line"><span style="color:#032F62;">â€¦â€¦</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>ä¸‹é¢ä»¥ liveness probes ä¸ºä¾‹ï¼Œåšå‡ ä¸ªæ¼”ç¤ºï¼š</p><p><strong>æ–¹å¼ä¸€ï¼šExec</strong></p><p>åˆ›å»º pod-liveness-exec.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-liveness-exec</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;/bin/cat&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;/tmp/hello.txt&quot;</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># æ‰§è¡Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»º podï¼Œè§‚å¯Ÿæ•ˆæœ</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-liveness-exec.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-liveness-exec created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod è¯¦æƒ…</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe pods pod-liveness-exec -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Created    20s (x2 over 50s)  kubelet, node1     Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Started    20s (x2 over 50s)  kubelet, node1     Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Killing    20s                kubelet, node1     Container nginx failed liveness probe, will be restarted</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">Warning  Unhealthy  0s (x5 over 40s)   kubelet, node1     Liveness probe failed</span><span style="color:#24292E;">: </span><span style="color:#22863A;">cat</span><span style="color:#24292E;">: </span><span style="color:#22863A;">can&#39;t open &#39;/tmp/hello11.txt&#39;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">No such file or directory</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯å°±ä¼šå‘ç° nginx å®¹å™¨å¯åŠ¨ä¹‹åå°±è¿›è¡Œäº†å¥åº·æ£€æŸ¥</span></span>
<span class="line"><span style="color:#6A737D;"># æ£€æŸ¥å¤±è´¥ä¹‹åï¼Œå®¹å™¨è¢« kill æ‰ï¼Œç„¶åå°è¯•è¿›è¡Œé‡å¯ï¼ˆè¿™æ˜¯é‡å¯ç­–ç•¥çš„ä½œç”¨ï¼Œåé¢è®²è§£ï¼‰</span></span>
<span class="line"><span style="color:#6A737D;"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿ pod ä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ° RESTARTS ä¸å†æ˜¯ 0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-liveness-exec -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME                READY   STATUS             RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-liveness-exec   0/1     CrashLoopBackOff   2          3m19s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚/tmp/hello.txtï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹å¼äºŒï¼šTCPSocket</strong></p><p>åˆ›å»º pod-liveness-tcpsocket.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-liveness-tcpsocket</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å°è¯•è®¿é—® 8080 ç«¯å£</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»º podï¼Œè§‚å¯Ÿæ•ˆæœ</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-liveness-tcpsocket.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-liveness-tcpsocket created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod è¯¦æƒ…</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe pods pod-liveness-tcpsocket -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Scheduled  31s                            default-scheduler  Successfully assigned dev/pod-liveness-tcpsocket to node2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Pulled     &lt;invalid&gt;                      kubelet, node2     Container image &quot;nginx:1.17.1&quot; already present on machine</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Created    &lt;invalid&gt;                      kubelet, node2     Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Started    &lt;invalid&gt;                      kubelet, node2     Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">Warning  Unhealthy  &lt;invalid&gt; (x2 over &lt;invalid&gt;)  kubelet, node2     Liveness probe failed</span><span style="color:#24292E;">: </span><span style="color:#22863A;">dial tcp 10.244.2.44:8080</span><span style="color:#24292E;">: </span><span style="color:#22863A;">connect</span><span style="color:#24292E;">: </span><span style="color:#032F62;">connection refused</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯ï¼Œå‘ç°å°è¯•è®¿é—® 8080 ç«¯å£,ä½†æ˜¯å¤±è´¥äº†</span></span>
<span class="line"><span style="color:#6A737D;"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿ pod ä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ° RESTARTS ä¸å†æ˜¯ 0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-liveness-tcpsocket  -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME                     READY   STATUS             RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-liveness-tcpsocket   0/1     CrashLoopBackOff   2          3m19s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„ç«¯å£ï¼Œæ¯”å¦‚ 80ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹å¼ä¸‰ï¼šHTTPGet</strong></p><p>åˆ›å»º pod-liveness-httpget.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-liveness-httpget</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;"># å…¶å®å°±æ˜¯è®¿é—® http://127.0.0.1:80/hello  </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HTTP</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#æ”¯æŒçš„åè®®ï¼Œhttp æˆ–è€… https</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#ç«¯å£å·</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/hello</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#URI åœ°å€</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»º podï¼Œè§‚å¯Ÿæ•ˆæœ</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-liveness-httpget.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-liveness-httpget created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod è¯¦æƒ…</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe pod pod-liveness-httpget -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">....</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Pulled     6s (x3 over 64s)  kubelet, node1     Container image &quot;nginx:1.17.1&quot; already present on machine</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Created    6s (x3 over 64s)  kubelet, node1     Created container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Started    6s (x3 over 63s)  kubelet, node1     Started container nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">Warning  Unhealthy  6s (x6 over 56s)  kubelet, node1     Liveness probe failed</span><span style="color:#24292E;">: </span><span style="color:#22863A;">HTTP probe failed with statuscode</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">404</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Killing    6s (x2 over 36s)  kubelet, node1     Container nginx failed liveness probe, will be restarted</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># è§‚å¯Ÿä¸Šé¢ä¿¡æ¯ï¼Œå°è¯•è®¿é—®è·¯å¾„ï¼Œä½†æ˜¯æœªæ‰¾åˆ°,å‡ºç° 404 é”™è¯¯</span></span>
<span class="line"><span style="color:#6A737D;"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿ pod ä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ° RESTARTS ä¸å†æ˜¯ 0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pod pod-liveness-httpget -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-liveness-httpget   1/1     Running   5          3m17s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„è·¯å¾„ pathï¼Œæ¯”å¦‚/ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œå·²ç»ä½¿ç”¨ liveness Probe æ¼”ç¤ºäº†ä¸‰ç§æ¢æµ‹æ–¹å¼ï¼Œä½†æ˜¯æŸ¥çœ‹ livenessProbe çš„å­å±æ€§ï¼Œä¼šå‘ç°é™¤äº†è¿™ä¸‰ç§æ–¹å¼ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®ï¼Œåœ¨è¿™é‡Œä¸€å¹¶è§£é‡Šä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl explain pod.spec.containers.livenessProbe</span></span>
<span class="line"><span style="color:#22863A;">FIELDS</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">exec &lt;Object&gt;</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">tcpSocket    &lt;Object&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">httpGet      &lt;Object&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">initialDelaySeconds  &lt;integer&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># å®¹å™¨å¯åŠ¨åç­‰å¾…å¤šå°‘ç§’æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">timeoutSeconds       &lt;integer&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># æ¢æµ‹è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤ 1 ç§’ï¼Œæœ€å° 1 ç§’</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">periodSeconds        &lt;integer&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># æ‰§è¡Œæ¢æµ‹çš„é¢‘ç‡ã€‚é»˜è®¤æ˜¯ 10 ç§’ï¼Œæœ€å° 1 ç§’</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">failureThreshold     &lt;integer&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯ 3ã€‚æœ€å°å€¼æ˜¯ 1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">successThreshold     &lt;integer&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯ 1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢ç¨å¾®é…ç½®ä¸¤ä¸ªï¼Œæ¼”ç¤ºä¸‹æ•ˆæœå³å¯ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">more pod-liveness-httpget.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-liveness-httpget</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HTTP</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">30</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å®¹å™¨å¯åŠ¨å 30s å¼€å§‹æ¢æµ‹</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">timeoutSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æ¢æµ‹è¶…æ—¶æ—¶é—´ä¸º 5s</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-5-é‡å¯ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_5-3-5-é‡å¯ç­–ç•¥" aria-hidden="true">#</a> 5.3.5 é‡å¯ç­–ç•¥</h4><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œä¸€æ—¦å®¹å™¨æ¢æµ‹å‡ºç°äº†é—®é¢˜ï¼Œkubernetes å°±ä¼šå¯¹å®¹å™¨æ‰€åœ¨çš„ Pod è¿›è¡Œé‡å¯ï¼Œå…¶å®è¿™æ˜¯ç”± pod çš„é‡å¯ç­–ç•¥å†³å®šçš„ï¼Œpod çš„é‡å¯ç­–ç•¥æœ‰ 3 ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>Always ï¼šå®¹å™¨å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚</li><li>OnFailure ï¼š å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º 0 æ—¶é‡å¯</li><li>Never ï¼š ä¸è®ºçŠ¶æ€ä¸ºä½•ï¼Œéƒ½ä¸é‡å¯è¯¥å®¹å™¨</li></ul><p>é‡å¯ç­–ç•¥é€‚ç”¨äº pod å¯¹è±¡ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œé¦–æ¬¡éœ€è¦é‡å¯çš„å®¹å™¨ï¼Œå°†åœ¨å…¶éœ€è¦æ—¶ç«‹å³è¿›è¡Œé‡å¯ï¼Œéšåå†æ¬¡éœ€è¦é‡å¯çš„æ“ä½œå°†ç”± kubelet å»¶è¿Ÿä¸€æ®µæ—¶é—´åè¿›è¡Œï¼Œä¸”åå¤çš„é‡å¯æ“ä½œçš„å»¶è¿Ÿæ—¶é•¿ä»¥æ­¤ä¸º 10sã€20sã€40sã€80sã€160s å’Œ 300sï¼Œ300s æ˜¯æœ€å¤§å»¶è¿Ÿæ—¶é•¿ã€‚</p><p>åˆ›å»º pod-restartpolicy.yamlï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-restartpolicy</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-port</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HTTP</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/hello</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># è®¾ç½®é‡å¯ç­–ç•¥ä¸º Never</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œ Pod æµ‹è¯•</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-restartpolicy.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-restartpolicy created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod è¯¦æƒ…ï¼Œå‘ç° nginx å®¹å™¨å¤±è´¥</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl  describe pods pod-restartpolicy  -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">Warning  Unhealthy  15s (x3 over 35s)  kubelet, node1     Liveness probe failed</span><span style="color:#24292E;">: </span><span style="color:#22863A;">HTTP probe failed with statuscode</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">404</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Normal   Killing    15s                kubelet, node1     Container nginx failed liveness probe</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># å¤šç­‰ä¸€ä¼šï¼Œå†è§‚å¯Ÿ pod çš„é‡å¯æ¬¡æ•°ï¼Œå‘ç°ä¸€ç›´æ˜¯ 0ï¼Œå¹¶æœªé‡å¯   </span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl  get pods pod-restartpolicy -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-restartpolicy      0/1     Running   0          5min42s</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-pod-è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_5-4-pod-è°ƒåº¦" aria-hidden="true">#</a> 5.4 Pod è°ƒåº¦</h3><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ª Pod åœ¨å“ªä¸ª Node èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ˜¯ç”± Scheduler ç»„ä»¶é‡‡ç”¨ç›¸åº”çš„ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å—äººå·¥æ§åˆ¶çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ»¡è¶³çš„éœ€æ±‚ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶æŸäº› Pod åˆ°è¾¾æŸäº›èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦æ±‚äº†è§£ kubernetes å¯¹ Pod çš„è°ƒåº¦è§„åˆ™ï¼Œkubernetes æä¾›äº†å››å¤§ç±»è°ƒåº¦æ–¹å¼ï¼š</p><ul><li><strong>è‡ªåŠ¨è°ƒåº¦ï¼š</strong> è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šå®Œå…¨ç”± Scheduler ç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•è®¡ç®—å¾—å‡º</li><li><strong>å®šå‘è°ƒåº¦ï¼š</strong> NodeNameã€NodeSelector</li><li><strong>äº²å’Œæ€§è°ƒåº¦ï¼š</strong> NodeAffinityã€PodAffinityã€PodAntiAffinity</li><li><strong>æ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼š</strong> Taintsã€Toleration</li></ul><h4 id="_5-4-1-å®šå‘è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_5-4-1-å®šå‘è°ƒåº¦" aria-hidden="true">#</a> 5.4.1 å®šå‘è°ƒåº¦</h4><p>å®šå‘è°ƒåº¦ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨åœ¨ pod ä¸Šå£°æ˜ nodeName æˆ–è€… nodeSelectorï¼Œä»¥æ­¤å°† Pod è°ƒåº¦åˆ°æœŸæœ›çš„ node èŠ‚ç‚¹ä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„è°ƒåº¦æ˜¯å¼ºåˆ¶çš„ï¼Œè¿™å°±æ„å‘³ç€å³ä½¿è¦è°ƒåº¦çš„ç›®æ ‡ Node ä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‘ä¸Šé¢è¿›è¡Œè°ƒåº¦ï¼Œåªä¸è¿‡ pod è¿è¡Œå¤±è´¥è€Œå·²ã€‚</p><p><strong>NodeName</strong></p><p>NodeName ç”¨äºå¼ºåˆ¶çº¦æŸå°† Pod è°ƒåº¦åˆ°æŒ‡å®šçš„ Name çš„ Node èŠ‚ç‚¹ä¸Šã€‚è¿™ç§æ–¹å¼ï¼Œå…¶å®æ˜¯ç›´æ¥è·³è¿‡ Scheduler çš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å°† Pod è°ƒåº¦åˆ°æŒ‡å®šåç§°çš„èŠ‚ç‚¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼šåˆ›å»ºä¸€ä¸ª pod-nodename.yaml æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-nodename</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æŒ‡å®šè°ƒåº¦åˆ° node1 èŠ‚ç‚¹ä¸Š</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;">#åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-nodename.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-nodename</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#æŸ¥çœ‹ Pod è°ƒåº¦åˆ° NODE å±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº† node1 èŠ‚ç‚¹ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods pod-nodename -n dev -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">           </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">            </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">      </span><span style="color:#032F62;">......</span></span>
<span class="line"><span style="color:#6F42C1;">pod-nodename</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">56</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.1.87</span><span style="color:#24292E;">   </span><span style="color:#032F62;">node1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">......</span><span style="color:#24292E;">   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ¥ä¸‹æ¥ï¼Œåˆ é™¤ podï¼Œä¿®æ”¹ nodeName çš„å€¼ä¸º node3ï¼ˆå¹¶æ²¡æœ‰ node3 èŠ‚ç‚¹ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete -f pod-nodename.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pod-nodename&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# vim pod-nodename.yaml</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-nodename.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-nodename</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°å·²ç»å‘ Node3 èŠ‚ç‚¹è°ƒåº¦ï¼Œä½†æ˜¯ç”±äºä¸å­˜åœ¨ node3 èŠ‚ç‚¹ï¼Œæ‰€ä»¥ pod æ— æ³•æ­£å¸¸è¿è¡Œ</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods pod-nodename -n dev -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">           </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">    </span><span style="color:#032F62;">......</span></span>
<span class="line"><span style="color:#6F42C1;">pod-nodename</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">s</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#032F62;">node3</span><span style="color:#24292E;">   </span><span style="color:#032F62;">......</span><span style="color:#24292E;">           </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>NodeSelector</strong></p><p>NodeSelector ç”¨äºå°† pod è°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„ node èŠ‚ç‚¹ä¸Šã€‚å®ƒæ˜¯é€šè¿‡ kubernetes çš„ label-selector æœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ pod åˆ›å»ºä¹‹å‰ï¼Œä¼šç”± scheduler ä½¿ç”¨ MatchNodeSelector è°ƒåº¦ç­–ç•¥è¿›è¡Œ label åŒ¹é…ï¼Œæ‰¾å‡ºç›®æ ‡ nodeï¼Œç„¶åå°† pod è°ƒåº¦åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶çº¦æŸã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼š</p><p>1 é¦–å…ˆåˆ†åˆ«ä¸º node èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl label nodes node1 nodeenv=pro</span></span>
<span class="line"><span style="color:#6F42C1;">node/node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">labeled</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl label nodes node2 nodeenv=test</span></span>
<span class="line"><span style="color:#6F42C1;">node/node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">labeled</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2 åˆ›å»ºä¸€ä¸ª pod-nodeselector.yaml æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒåˆ›å»º Pod</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-nodeselector</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeSelector</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nodeenv</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pro</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰ nodeenv=pro æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;">#åˆ›å»º Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-nodeselector.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-nodeselector</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#æŸ¥çœ‹ Pod è°ƒåº¦åˆ° NODE å±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº† node1 èŠ‚ç‚¹ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods pod-nodeselector -n dev -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">               </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">          </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">    </span><span style="color:#032F62;">......</span></span>
<span class="line"><span style="color:#6F42C1;">pod-nodeselector</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">47</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.1.87</span><span style="color:#24292E;">   </span><span style="color:#032F62;">node1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ¥ä¸‹æ¥ï¼Œåˆ é™¤ podï¼Œä¿®æ”¹ nodeSelector çš„å€¼ä¸º nodeenv: xxxxï¼ˆä¸å­˜åœ¨æ‰“æœ‰æ­¤æ ‡ç­¾çš„èŠ‚ç‚¹ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl delete -f pod-nodeselector.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pod-nodeselector&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# vim pod-nodeselector.yaml</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-nodeselector.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-nodeselector</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç° pod æ— æ³•æ­£å¸¸è¿è¡Œ,Node çš„å€¼ä¸º none</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -n dev -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">               </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#6F42C1;">pod-nodeselector</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m20s</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹è¯¦æƒ…,å‘ç° node selector åŒ¹é…å¤±è´¥çš„æç¤º</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe pods pod-nodeselector -n dev</span></span>
<span class="line"><span style="color:#005CC5;">.......</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Reason</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Age</span><span style="color:#24292E;">        </span><span style="color:#032F62;">From</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">------</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">-------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Warning</span><span style="color:#24292E;">  </span><span style="color:#032F62;">FailedScheduling</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">unknow</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#032F62;">default-scheduler</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">available:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">didn&#39;t match node selector.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-2-äº²å’Œæ€§è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_5-4-2-äº²å’Œæ€§è°ƒåº¦" aria-hidden="true">#</a> 5.4.2 äº²å’Œæ€§è°ƒåº¦</h4><p>ä¸Šä¸€èŠ‚ï¼Œä»‹ç»äº†ä¸¤ç§å®šå‘è°ƒåº¦çš„æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„ Nodeï¼Œé‚£ä¹ˆ Pod å°†ä¸ä¼šè¢«è¿è¡Œï¼Œå³ä½¿åœ¨é›†ç¾¤ä¸­è¿˜æœ‰å¯ç”¨ Node åˆ—è¡¨ä¹Ÿä¸è¡Œï¼Œè¿™å°±é™åˆ¶äº†å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>åŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œkubernetes è¿˜æä¾›äº†ä¸€ç§äº²å’Œæ€§è°ƒåº¦ï¼ˆAffinityï¼‰ã€‚å®ƒåœ¨ NodeSelector çš„åŸºç¡€ä¹‹ä¸Šçš„è¿›è¡Œäº†æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼ï¼Œå®ç°ä¼˜å…ˆé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„ Node è¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿è°ƒåº¦æ›´åŠ çµæ´»ã€‚</p><p>Affinity ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li>nodeAffinity(node äº²å’Œæ€§ï¼‰: ä»¥ node ä¸ºç›®æ ‡ï¼Œè§£å†³ pod å¯ä»¥è°ƒåº¦åˆ°å“ªäº› node çš„é—®é¢˜</li><li>podAffinity(pod äº²å’Œæ€§) : ä»¥ pod ä¸ºç›®æ ‡ï¼Œè§£å†³ pod å¯ä»¥å’Œå“ªäº›å·²å­˜åœ¨çš„ pod éƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜</li><li>podAntiAffinity(pod åäº²å’Œæ€§) : ä»¥ pod ä¸ºç›®æ ‡ï¼Œè§£å†³ pod ä¸èƒ½å’Œå“ªäº›å·²å­˜åœ¨ pod éƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜</li></ul><blockquote><p>å…³äºäº²å’Œæ€§(åäº²å’Œæ€§)ä½¿ç”¨åœºæ™¯çš„è¯´æ˜ï¼š</p><p><strong>äº²å’Œæ€§</strong> ï¼šå¦‚æœä¸¤ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œé‚£å°±æœ‰å¿…è¦åˆ©ç”¨äº²å’Œæ€§è®©ä¸¤ä¸ªåº”ç”¨çš„å°½å¯èƒ½çš„é è¿‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å› ç½‘ç»œé€šä¿¡è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p><p><strong>åäº²å’Œæ€§</strong> ï¼šå½“åº”ç”¨çš„é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²æ—¶ï¼Œæœ‰å¿…è¦é‡‡ç”¨åäº²å’Œæ€§è®©å„ä¸ªåº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ª node ä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</p></blockquote><p><strong>NodeAffinity</strong></p><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹<code>NodeAffinity</code>çš„å¯é…ç½®é¡¹ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">pod.spec.affinity.nodeAffinity</span></span>
<span class="line"><span style="color:#24292E;">  requiredDuringSchedulingIgnoredDuringExecution  Node èŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">    nodeSelectorTerms  èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span>
<span class="line"><span style="color:#24292E;">        key    é”®</span></span>
<span class="line"><span style="color:#24292E;">        values å€¼</span></span>
<span class="line"><span style="color:#24292E;">        operat or å…³ç³»ç¬¦ æ”¯æŒ Exists, DoesNotExist, In, NotIn, Gt, Lt</span></span>
<span class="line"><span style="color:#24292E;">  preferredDuringSchedulingIgnoredDuringExecution ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æŒ‡å®šçš„è§„åˆ™çš„ Nodeï¼Œç›¸å½“äºè½¯é™åˆ¶ (å€¾å‘)</span></span>
<span class="line"><span style="color:#24292E;">    preference   ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©å™¨é¡¹ï¼Œä¸ç›¸åº”çš„æƒé‡ç›¸å…³è”</span></span>
<span class="line"><span style="color:#24292E;">      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨</span></span>
<span class="line"><span style="color:#24292E;">      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span>
<span class="line"><span style="color:#24292E;">        key    é”®</span></span>
<span class="line"><span style="color:#24292E;">        values å€¼</span></span>
<span class="line"><span style="color:#24292E;">        operator å…³ç³»ç¬¦ æ”¯æŒ In, NotIn, Exists, DoesNotExist, Gt, Lt</span></span>
<span class="line"><span style="color:#24292E;">	weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´ 1-100ã€‚</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">å…³ç³»ç¬¦çš„ä½¿ç”¨è¯´æ˜</span><span style="color:#24292E;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">- </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nodeenv</span><span style="color:#24292E;">              </span><span style="color:#6A737D;"># åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„ key ä¸º nodeenv çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Exists</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nodeenv</span><span style="color:#24292E;">              </span><span style="color:#6A737D;"># åŒ¹é…æ ‡ç­¾çš„ key ä¸º nodeenv,ä¸” value æ˜¯&quot;xxx&quot;æˆ–&quot;yyy&quot;çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">values</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;xxx&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;yyy&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nodeenv</span><span style="color:#24292E;">              </span><span style="color:#6A737D;"># åŒ¹é…æ ‡ç­¾çš„ key ä¸º nodeenv,ä¸” value å¤§äº&quot;xxx&quot;çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Gt</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">values</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;xxx&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p><p>åˆ›å»º pod-nodeaffinity-required.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-nodeaffinity-required</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">affinity</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#äº²å’Œæ€§è®¾ç½®</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nodeAffinity</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#è®¾ç½® node äº²å’Œæ€§</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># ç¡¬é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">nodeSelectorTerms</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># åŒ¹é… env çš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nodeenv</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">values</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;xxx&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;yyy&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-nodeaffinity-required.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-nodeaffinity-required created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod çŠ¶æ€ ï¼ˆè¿è¡Œå¤±è´¥ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-nodeaffinity-required -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME                        READY   STATUS    RESTARTS   AGE   IP       NODE    ......</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">pod-nodeaffinity-required   0/1     Pending   0          16s   &lt;none&gt;   &lt;none&gt;  ......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ Pod çš„è¯¦æƒ…</span></span>
<span class="line"><span style="color:#6A737D;"># å‘ç°è°ƒåº¦å¤±è´¥ï¼Œæç¤º node é€‰æ‹©å¤±è´¥</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe pod pod-nodeaffinity-required -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available</span><span style="color:#24292E;">: </span><span style="color:#032F62;">3 node(s) didn&#39;t match node selector.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available</span><span style="color:#24292E;">: </span><span style="color:#032F62;">3 node(s) didn&#39;t match node selector.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#æ¥ä¸‹æ¥ï¼Œåœæ­¢ pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl delete -f pod-nodeaffinity-required.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod &quot;pod-nodeaffinity-required&quot; deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ä¿®æ”¹æ–‡ä»¶ï¼Œå°† values: [&quot;xxx&quot;,&quot;yyy&quot;]------&gt; [&quot;pro&quot;,&quot;yyy&quot;]</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">vim pod-nodeaffinity-required.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å†æ¬¡å¯åŠ¨</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-nodeaffinity-required.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-nodeaffinity-required created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ­¤æ—¶æŸ¥çœ‹ï¼Œå‘ç°è°ƒåº¦æˆåŠŸï¼Œå·²ç»å°† pod è°ƒåº¦åˆ°äº† node1 ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-nodeaffinity-required -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME                        READY   STATUS    RESTARTS   AGE   IP            NODE  ......</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">pod-nodeaffinity-required   1/1     Running   0          11s   10.244.1.89   node1 ......</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥å†æ¼”ç¤ºä¸€ä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p><p>åˆ›å»º pod-nodeaffinity-preferred.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-nodeaffinity-preferred</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">affinity</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#äº²å’Œæ€§è®¾ç½®</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nodeAffinity</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#è®¾ç½® node äº²å’Œæ€§</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># è½¯é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">weight</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">preference</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># åŒ¹é… env çš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾(å½“å‰ç¯å¢ƒæ²¡æœ‰)</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nodeenv</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">values</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;xxx&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;yyy&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-nodeaffinity-preferred.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-nodeaffinity-preferred created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod çŠ¶æ€ ï¼ˆè¿è¡ŒæˆåŠŸï¼‰</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pod pod-nodeaffinity-preferred -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME                         READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-nodeaffinity-preferred   1/1     Running   0          40s</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">NodeAffinity è§„åˆ™è®¾ç½®çš„æ³¨æ„äº‹é¡¹ï¼š</span></span>
<span class="line"><span style="color:#24292e;">    1 å¦‚æœåŒæ—¶å®šä¹‰äº† nodeSelector å’Œ nodeAffinityï¼Œé‚£ä¹ˆå¿…é¡»ä¸¤ä¸ªæ¡ä»¶éƒ½å¾—åˆ°æ»¡è¶³ï¼ŒPod æ‰èƒ½è¿è¡Œåœ¨æŒ‡å®šçš„ Node ä¸Š</span></span>
<span class="line"><span style="color:#24292e;">    2 å¦‚æœ nodeAffinity æŒ‡å®šäº†å¤šä¸ª nodeSelectorTermsï¼Œé‚£ä¹ˆåªéœ€è¦å…¶ä¸­ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…æˆåŠŸå³å¯</span></span>
<span class="line"><span style="color:#24292e;">    3 å¦‚æœä¸€ä¸ª nodeSelectorTerms ä¸­æœ‰å¤šä¸ª matchExpressions ï¼Œåˆ™ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„æ‰èƒ½åŒ¹é…æˆåŠŸ</span></span>
<span class="line"><span style="color:#24292e;">    4 å¦‚æœä¸€ä¸ª pod æ‰€åœ¨çš„ Node åœ¨ Pod è¿è¡ŒæœŸé—´å…¶æ ‡ç­¾å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†ç¬¦åˆè¯¥ Pod çš„èŠ‚ç‚¹äº²å’Œæ€§éœ€æ±‚ï¼Œåˆ™ç³»ç»Ÿå°†å¿½ç•¥æ­¤å˜åŒ–</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PodAffinity</strong></p><p>PodAffinity ä¸»è¦å®ç°ä»¥è¿è¡Œçš„ Pod ä¸ºå‚ç…§ï¼Œå®ç°è®©æ–°åˆ›å»ºçš„ Pod è·Ÿå‚ç…§ pod åœ¨ä¸€ä¸ªåŒºåŸŸçš„åŠŸèƒ½ã€‚</p><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹<code>PodAffinity</code>çš„å¯é…ç½®é¡¹ï¼š</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">pod.spec.affinity.podAffinity</span></span>
<span class="line"><span style="color:#24292E;">  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">    namespaces       æŒ‡å®šå‚ç…§ pod çš„ namespace</span></span>
<span class="line"><span style="color:#24292E;">    topologyKey      æŒ‡å®šè°ƒåº¦ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#24292E;">    labelSelector    æ ‡ç­¾é€‰æ‹©å™¨</span></span>
<span class="line"><span style="color:#24292E;">      matchExpressions  æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span>
<span class="line"><span style="color:#24292E;">        key    é”®</span></span>
<span class="line"><span style="color:#24292E;">        values å€¼</span></span>
<span class="line"><span style="color:#24292E;">        operator å…³ç³»ç¬¦ æ”¯æŒ In, NotIn, Exists, DoesNotExist.</span></span>
<span class="line"><span style="color:#24292E;">      matchLabels    æŒ‡å¤šä¸ª matchExpressions æ˜ å°„çš„å†…å®¹</span></span>
<span class="line"><span style="color:#24292E;">  preferredDuringSchedulingIgnoredDuringExecution è½¯é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">    podAffinityTerm  é€‰é¡¹</span></span>
<span class="line"><span style="color:#24292E;">      namespaces      </span></span>
<span class="line"><span style="color:#24292E;">      topologyKey</span></span>
<span class="line"><span style="color:#24292E;">      labelSelector</span></span>
<span class="line"><span style="color:#24292E;">        matchExpressions  </span></span>
<span class="line"><span style="color:#24292E;">          key    é”®</span></span>
<span class="line"><span style="color:#24292E;">          values å€¼</span></span>
<span class="line"><span style="color:#24292E;">          operator</span></span>
<span class="line"><span style="color:#24292E;">        matchLabels </span></span>
<span class="line"><span style="color:#24292E;">    weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´ 1-100</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">topologyKey ç”¨äºæŒ‡å®šè°ƒåº¦æ—¶ä½œç”¨åŸŸ,ä¾‹å¦‚:</span></span>
<span class="line"><span style="color:#24292E;">    å¦‚æœæŒ‡å®šä¸º kubernetes.io/hostnameï¼Œé‚£å°±æ˜¯ä»¥ Node èŠ‚ç‚¹ä¸ºåŒºåˆ†èŒƒå›´</span></span>
<span class="line"><span style="color:#24292E;">	å¦‚æœæŒ‡å®šä¸º beta.kubernetes.io/os,åˆ™ä»¥ Node èŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç±»å‹æ¥åŒºåˆ†</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code>,</p><p>1ï¼‰é¦–å…ˆåˆ›å»ºä¸€ä¸ªå‚ç…§ Podï¼Œpod-podaffinity-target.yamlï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-podaffinity-target</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">podenv</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pro</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#è®¾ç½®æ ‡ç­¾</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å°†ç›®æ ‡ pod åç¡®æŒ‡å®šåˆ° node1 ä¸Š</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># å¯åŠ¨ç›®æ ‡ pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-podaffinity-target.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-podaffinity-target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod çŠ¶å†µ</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods  pod-podaffinity-target -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod-podaffinity-target</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">4</span><span style="color:#032F62;">s</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰åˆ›å»º pod-podaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-podaffinity-required</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">affinity</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#äº²å’Œæ€§è®¾ç½®</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">podAffinity</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#è®¾ç½® pod äº²å’Œæ€§</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># ç¡¬é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">labelSelector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># åŒ¹é… env çš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">podenv</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">values</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;xxx&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;yyy&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">topologyKey</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes.io/hostname</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–° Pod å¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾ nodeenv=xxx æˆ–è€… nodeenv=yyy çš„ pod åœ¨åŒä¸€ Node ä¸Šï¼Œæ˜¾ç„¶ç°åœ¨æ²¡æœ‰è¿™æ · podï¼Œæ¥ä¸‹æ¥ï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># å¯åŠ¨ pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-podaffinity-required.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-podaffinity-required created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod çŠ¶æ€ï¼Œå‘ç°æœªè¿è¡Œ</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-podaffinity-required -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME                       READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#032F62;">pod-podaffinity-required   0/1     Pending   0          9s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe pods pod-podaffinity-required  -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#22863A;">Events</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">Type     Reason            Age        From               Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">----     ------            ----       ----               -------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">Warning  FailedScheduling  &lt;unknown&gt;  default-scheduler  0/3 nodes are available</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2 node(s) didn&#39;t match pod affinity rules, 1 node(s) had taints that the pod didn&#39;t tolerate.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ¥ä¸‹æ¥ä¿®æ”¹  values: [&quot;xxx&quot;,&quot;yyy&quot;]-----&gt;values:[&quot;pro&quot;,&quot;yyy&quot;]</span></span>
<span class="line"><span style="color:#6A737D;"># æ„æ€æ˜¯ï¼šæ–° Pod å¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾ nodeenv=xxx æˆ–è€… nodeenv=yyy çš„ pod åœ¨åŒä¸€ Node ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">vim pod-podaffinity-required.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ç„¶åé‡æ–°åˆ›å»º podï¼ŒæŸ¥çœ‹æ•ˆæœ</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl delete -f  pod-podaffinity-required.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod &quot;pod-podaffinity-required&quot; de leted</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-podaffinity-required.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-podaffinity-required created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å‘ç°æ­¤æ—¶ Pod è¿è¡Œæ­£å¸¸</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-podaffinity-required -n dev</span></span>
<span class="line"><span style="color:#032F62;">NAME                       READY   STATUS    RESTARTS   AGE   LABELS</span></span>
<span class="line"><span style="color:#032F62;">pod-podaffinity-required   1/1     Running   0          6s    &lt;none&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³äº<code>PodAffinity</code>çš„ <code>preferredDuringSchedulingIgnoredDuringExecution</code>ï¼Œè¿™é‡Œä¸å†æ¼”ç¤ºã€‚</p><p><strong>PodAntiAffinity</strong></p><p>PodAntiAffinity ä¸»è¦å®ç°ä»¥è¿è¡Œçš„ Pod ä¸ºå‚ç…§ï¼Œè®©æ–°åˆ›å»ºçš„ Pod è·Ÿå‚ç…§ pod ä¸åœ¨ä¸€ä¸ªåŒºåŸŸä¸­çš„åŠŸèƒ½ã€‚</p><p>å®ƒçš„é…ç½®æ–¹å¼å’Œé€‰é¡¹è·Ÿ PodAffinty æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†åšè¯¦ç»†è§£é‡Šï¼Œç›´æ¥åšä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ã€‚</p><p>1ï¼‰ç»§ç»­ä½¿ç”¨ä¸Šä¸ªæ¡ˆä¾‹ä¸­ç›®æ ‡ pod</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -n dev -o wide --show-labels</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">            </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">    </span><span style="color:#032F62;">LABELS</span></span>
<span class="line"><span style="color:#6F42C1;">pod-podaffinity-required</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m29s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.1.38</span><span style="color:#24292E;">   </span><span style="color:#032F62;">node1</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">     </span></span>
<span class="line"><span style="color:#6F42C1;">pod-podaffinity-target</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">m25s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.1.37</span><span style="color:#24292E;">   </span><span style="color:#032F62;">node1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">podenv=pro</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰åˆ›å»º pod-podantiaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-podantiaffinity-required</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">affinity</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#äº²å’Œæ€§è®¾ç½®</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">podAntiAffinity</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#è®¾ç½® pod äº²å’Œæ€§</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># ç¡¬é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">labelSelector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># åŒ¹é… podenv çš„å€¼åœ¨[&quot;pro&quot;]ä¸­çš„æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">podenv</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">values</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;pro&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">topologyKey</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes.io/hostname</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–° Pod å¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾ nodeenv=pro çš„ pod ä¸åœ¨åŒä¸€ Node ä¸Šï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># åˆ›å»º pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl create -f pod-podantiaffinity-required.yaml</span></span>
<span class="line"><span style="color:#032F62;">pod/pod-podantiaffinity-required created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æŸ¥çœ‹ pod</span></span>
<span class="line"><span style="color:#6A737D;"># å‘ç°è°ƒåº¦åˆ°äº† node2 ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods pod-podantiaffinity-required -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME                           READY   STATUS    RESTARTS   AGE   IP            NODE   ..</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">pod-podantiaffinity-required   1/1     Running   0          30s   10.244.1.96   node2  ..</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-3-æ±¡ç‚¹å’Œå®¹å¿" tabindex="-1"><a class="header-anchor" href="#_5-4-3-æ±¡ç‚¹å’Œå®¹å¿" aria-hidden="true">#</a> 5.4.3 æ±¡ç‚¹å’Œå®¹å¿</h4><p><strong>æ±¡ç‚¹ï¼ˆTaintsï¼‰</strong></p><p>å‰é¢çš„è°ƒåº¦æ–¹å¼éƒ½æ˜¯ç«™åœ¨ Pod çš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨ Pod ä¸Šæ·»åŠ å±æ€§ï¼Œæ¥ç¡®å®š Pod æ˜¯å¦è¦è°ƒåº¦åˆ°æŒ‡å®šçš„ Node ä¸Šï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨ Node çš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨ Node ä¸Šæ·»åŠ  <strong>æ±¡ç‚¹</strong> å±æ€§ï¼Œæ¥å†³å®šæ˜¯å¦å…è®¸ Pod è°ƒåº¦è¿‡æ¥ã€‚</p><p>Node è¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’Œ Pod ä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç» Pod è°ƒåº¦è¿›æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²ç»å­˜åœ¨çš„ Pod é©±é€å‡ºå»ã€‚</p><p>æ±¡ç‚¹çš„æ ¼å¼ä¸ºï¼š<code>key=value:effect</code>, key å’Œ value æ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffect æè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š</p><ul><li>PreferNoScheduleï¼škubernetes å°†å°½é‡é¿å…æŠŠ Pod è°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„ Node ä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯è°ƒåº¦</li><li>NoScheduleï¼škubernetes å°†ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„ Node ä¸Šï¼Œä½†ä¸ä¼šå½±å“å½“å‰ Node ä¸Šå·²å­˜åœ¨çš„ Pod</li><li>NoExecuteï¼škubernetes å°†ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„ Node ä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°† Node ä¸Šå·²å­˜åœ¨çš„ Pod é©±ç¦»</li></ul><figure><img src="/assets/img/k8s/image-20200605021831545.png" alt="image-20200605021606508" tabindex="0" loading="lazy"><figcaption>image-20200605021606508</figcaption></figure><p>ä½¿ç”¨ kubectl è®¾ç½®å’Œå»é™¤æ±¡ç‚¹çš„å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># è®¾ç½®æ±¡ç‚¹</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">taint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key=value:effect</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å»é™¤æ±¡ç‚¹</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">taint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key:effect-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># å»é™¤æ‰€æœ‰æ±¡ç‚¹</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">taint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key-</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹æ±¡ç‚¹çš„æ•ˆæœï¼š</p><ol><li>å‡†å¤‡èŠ‚ç‚¹ node1ï¼ˆä¸ºäº†æ¼”ç¤ºæ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œæš‚æ—¶åœæ­¢ node2 èŠ‚ç‚¹ï¼‰</li><li>ä¸º node1 èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: <code>tag=heima:PreferNoSchedule</code>ï¼›ç„¶ååˆ›å»º pod1( pod1 å¯ä»¥ )</li><li>ä¿®æ”¹ä¸º node1 èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: <code>tag=heima:NoSchedule</code>ï¼›ç„¶ååˆ›å»º pod2( pod1 æ­£å¸¸ pod2 å¤±è´¥ )</li><li>ä¿®æ”¹ä¸º node1 èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: <code>tag=heima:NoExecute</code>ï¼›ç„¶ååˆ›å»º pod3 ( 3 ä¸ª pod éƒ½å¤±è´¥ )</li></ol><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># ä¸º node1 è®¾ç½®æ±¡ç‚¹(PreferNoSchedule)</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl taint nodes node1 tag=heima:PreferNoSchedule</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># åˆ›å»º pod1</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl run taint1 --image=nginx:1.17.1 -n dev</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME                      READY   STATUS    RESTARTS   AGE     IP           NODE</span><span style="color:#24292E;">   </span></span>
<span class="line"><span style="color:#032F62;">taint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1</span><span style="color:#24292E;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ä¸º node1 è®¾ç½®æ±¡ç‚¹(å–æ¶ˆ PreferNoScheduleï¼Œè®¾ç½® NoSchedule)</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl taint nodes node1 tag:PreferNoSchedule-</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl taint nodes node1 tag=heima:NoSchedule</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># åˆ›å»º pod2</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl run taint2 --image=nginx:1.17.1 -n dev</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods taint2 -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME                      READY   STATUS    RESTARTS   AGE     IP            NODE</span></span>
<span class="line"><span style="color:#032F62;">taint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">taint2-544694789-6zmlf    0/1     Pending   0          21s     &lt;none&gt;        &lt;none&gt;</span><span style="color:#24292E;">   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ä¸º node1 è®¾ç½®æ±¡ç‚¹(å–æ¶ˆ NoScheduleï¼Œè®¾ç½® NoExecute)</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl taint nodes node1 tag:NoSchedule-</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl taint nodes node1 tag=heima:NoExecute</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># åˆ›å»º pod3</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl run taint3 --image=nginx:1.17.1 -n dev</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME                      READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">taint1-7665f7fd85-htkmp   0/1     Pending   0          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;</span><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#032F62;">taint2-544694789-bn7wb    0/1     Pending   0          35s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;</span><span style="color:#24292E;">     </span></span>
<span class="line"><span style="color:#032F62;">taint3-6d78dbd749-tktkq   0/1     Pending   0          6s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;</span><span style="color:#24292E;">     </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">å°æç¤ºï¼š</span></span>
<span class="line"><span style="color:#24292e;">    ä½¿ç”¨ kubeadm æ­å»ºçš„é›†ç¾¤ï¼Œé»˜è®¤å°±ä¼šç»™ master èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°,æ‰€ä»¥ pod å°±ä¸ä¼šè°ƒåº¦åˆ° master èŠ‚ç‚¹ä¸Š.</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¹å¿ï¼ˆTolerationï¼‰</strong></p><p>ä¸Šé¢ä»‹ç»äº†æ±¡ç‚¹çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ node ä¸Šæ·»åŠ æ±¡ç‚¹ç”¨äºæ‹’ç» pod è°ƒåº¦ä¸Šæ¥ï¼Œä½†æ˜¯å¦‚æœå°±æ˜¯æƒ³å°†ä¸€ä¸ª pod è°ƒåº¦åˆ°ä¸€ä¸ªæœ‰æ±¡ç‚¹çš„ node ä¸Šå»ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦ä½¿ç”¨åˆ° <strong>å®¹å¿</strong> ã€‚</p><figure><img src="/assets/img/k8s/image-20200514095913741.png" alt="image-20200514095913741" tabindex="0" loading="lazy"><figcaption>image-20200514095913741</figcaption></figure><blockquote><p>æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNode é€šè¿‡æ±¡ç‚¹æ‹’ç» pod è°ƒåº¦ä¸Šå»ï¼ŒPod é€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»</p></blockquote><p>ä¸‹é¢å…ˆé€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹çœ‹ä¸‹æ•ˆæœï¼š</p><ol><li>ä¸Šä¸€å°èŠ‚ï¼Œå·²ç»åœ¨ node1 èŠ‚ç‚¹ä¸Šæ‰“ä¸Šäº†<code>NoExecute</code>çš„æ±¡ç‚¹ï¼Œæ­¤æ—¶ pod æ˜¯è°ƒåº¦ä¸ä¸Šå»çš„</li><li>æœ¬å°èŠ‚ï¼Œå¯ä»¥é€šè¿‡ç»™ pod æ·»åŠ å®¹å¿ï¼Œç„¶åå°†å…¶è°ƒåº¦ä¸Šå»</li></ol><p>åˆ›å»º pod-toleration.yaml,å†…å®¹å¦‚ä¸‹</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-toleration</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">tolerations</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;"># æ·»åŠ å®¹å¿</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;tag&quot;</span><span style="color:#24292E;">        </span><span style="color:#6A737D;"># è¦å®¹å¿çš„æ±¡ç‚¹çš„ key</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Equal&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æ“ä½œç¬¦</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;heima&quot;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># å®¹å¿çš„æ±¡ç‚¹çš„ value</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">effect</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;NoExecute&quot;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># æ·»åŠ å®¹å¿ä¹‹å‰çš„ pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME             READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">pod-toleration   0/1     Pending   0          3s    &lt;none&gt;   &lt;none&gt;   &lt;none&gt;</span><span style="color:#24292E;">           </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ·»åŠ å®¹å¿ä¹‹åçš„ pod</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl get pods -n dev -o wide</span></span>
<span class="line"><span style="color:#032F62;">NAME             READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED</span></span>
<span class="line"><span style="color:#032F62;">pod-toleration   1/1     Running   0          3s    10.244.1.62   node1   &lt;none&gt;</span><span style="color:#24292E;">        </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢çœ‹ä¸€ä¸‹å®¹å¿çš„è¯¦ç»†é…ç½®:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl explain pod.spec.tolerations</span></span>
<span class="line"><span style="color:#6F42C1;">...</span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#22863A;">FIELDS</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">key</span><span style="color:#24292E;">       </span><span style="color:#6A737D;"># å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„é”®ï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„é”®</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">value</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„å€¼</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">operator</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># key-value çš„è¿ç®—ç¬¦ï¼Œæ”¯æŒ Equal å’Œ Existsï¼ˆé»˜è®¤ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">effect</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># å¯¹åº”æ±¡ç‚¹çš„ effectï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰å½±å“</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">tolerationSeconds</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># å®¹å¿æ—¶é—´, å½“ effect ä¸º NoExecute æ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤º pod åœ¨ Node ä¸Šçš„åœç•™æ—¶é—´</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 417333277@qq.com">kevinng77</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">æ²ªICPå¤‡2023027904å·-1</a>&nbsp;<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=" target="_blank"><img src="/assets/gongan.png">å…¬å®‰å¤‡æ¡ˆå· </a></div><div class="vp-copyright">Copyright Â© 2025 Kevin å´å˜‰æ–‡</div></footer></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-436262f0.js" defer></script>
  </body>
</html>
