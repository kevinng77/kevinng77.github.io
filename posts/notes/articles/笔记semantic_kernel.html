<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://antarina.tech/posts/notes/articles/%E7%AC%94%E8%AE%B0semantic_kernel.html"><meta property="og:site_name" content="è®°å¿†ç¬”ä¹¦"><meta property="og:title" content="Semantic Kernel | ä¸Šæ‰‹ä¸åˆ†æ"><meta property="og:description" content="Semantic Kernel æœ¬æ–‡å¯¹ Semantic Kernel ä¸­çš„ Kernelï¼ŒPluginï¼ŒKernelFunctionï¼ŒSemantic Memoryï¼ŒPlannerï¼ŒServicesï¼Œreliability ç­‰è¿›è¡Œæ¦‚å¿µä»‹ç»ã€‚ 1. Kernel image-20240411094303977"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-07-05T03:34:03.000Z"><meta property="article:author" content="Kevin å´å˜‰æ–‡"><meta property="article:tag" content="NLP"><meta property="article:tag" content="AIGC"><meta property="article:tag" content="LLM"><meta property="article:tag" content="Agent"><meta property="article:published_time" content="2024-05-01T00:00:00.000Z"><meta property="article:modified_time" content="2024-07-05T03:34:03.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Semantic Kernel | ä¸Šæ‰‹ä¸åˆ†æ","image":[""],"datePublished":"2024-05-01T00:00:00.000Z","dateModified":"2024-07-05T03:34:03.000Z","author":[{"@type":"Person","name":"Kevin å´å˜‰æ–‡"}]}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link rel="icon" href="/logo.svg"><title>Semantic Kernel | ä¸Šæ‰‹ä¸åˆ†æ | è®°å¿†ç¬”ä¹¦</title><meta name="description" content="Semantic Kernel æœ¬æ–‡å¯¹ Semantic Kernel ä¸­çš„ Kernelï¼ŒPluginï¼ŒKernelFunctionï¼ŒSemantic Memoryï¼ŒPlannerï¼ŒServicesï¼Œreliability ç­‰è¿›è¡Œæ¦‚å¿µä»‹ç»ã€‚ 1. Kernel image-20240411094303977">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-a733c29d.css" as="style"><link rel="stylesheet" href="/assets/style-a733c29d.css">
    <link rel="modulepreload" href="/assets/app-90f47110.js"><link rel="modulepreload" href="/assets/ç¬”è®°semantic_kernel.html-f9373792.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/ç¬”è®°semantic_kernel.html-1556cdb5.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container no-sidebar has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><!----><!----><span class="vp-site-name">è®°å¿†ç¬”ä¹¦</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="ä¸»é¡µ" class="vp-link nav-link nav-link" href="/"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="å½’æ¡£" class="vp-link nav-link nav-link" href="/timeline/"><span class="font-icon icon iconfont icon-categoryselected" style=""></span>å½’æ¡£<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/kevinng77" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Semantic Kernel | ä¸Šæ‰‹ä¸åˆ†æ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Kevin å´å˜‰æ–‡</span></span><span property="author" content="Kevin å´å˜‰æ–‡"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-05-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 15 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT15M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category7 clickable" role="navigation">çŸ¥è¯†ç¬”è®°</span><!--]--><meta property="articleSection" content="çŸ¥è¯†ç¬”è®°"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag8 clickable" role="navigation">NLP</span><span class="page-tag-item tag4 clickable" role="navigation">AIGC</span><span class="page-tag-item tag6 clickable" role="navigation">LLM</span><span class="page-tag-item tag6 clickable" role="navigation">Agent</span><!--]--><meta property="keywords" content="NLP,AIGC,LLM,Agent"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_1-kernel">1. Kernel</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_2-plugin">2. Plugin</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#ä»£ç è§£æ">ä»£ç è§£æ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_3-kernelfunction">3. KernelFunction</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_4-semantic-memory">4. Semantic Memory</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_5-services">5. Services</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_6-planner">6.  Planner</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_6-1-basic-planner">6.1 Basic Planner</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_6-2-sequentialplanner">6.2 SequentialPlanner</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_6-3-action-planner">6.3 Action Planner</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#_6-4-stepwise-planner">6.4 Stepwise Planner</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#_7-å…¶ä»–">7. å…¶ä»–</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="semantic-kernel" tabindex="-1"><a class="header-anchor" href="#semantic-kernel" aria-hidden="true">#</a> Semantic Kernel</h1><p>æœ¬æ–‡å¯¹ Semantic Kernel ä¸­çš„ Kernelï¼ŒPluginï¼ŒKernelFunctionï¼ŒSemantic Memoryï¼ŒPlannerï¼ŒServicesï¼Œreliability ç­‰è¿›è¡Œæ¦‚å¿µä»‹ç»ã€‚</p><h2 id="_1-kernel" tabindex="-1"><a class="header-anchor" href="#_1-kernel" aria-hidden="true">#</a> 1. Kernel</h2><figure><img src="/assets/img/semantic_kernel/image-20240411094303977.png" alt="image-20240411094303977" tabindex="0" loading="lazy"><figcaption>image-20240411094303977</figcaption></figure><p>Kernel æ˜¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œç”¨æ¥æ‰§è¡Œä»¥ä¸‹å†…å®¹</p><ul><li>é€‰æ‹©æœ€ä½³çš„äººå·¥æ™ºèƒ½æœåŠ¡æ¥è¿è¡Œæç¤ºã€‚</li><li>ä½¿ç”¨æä¾›çš„ prompt æ¨¡æ¿æ„å»ºæç¤ºã€‚ï¼ˆå¿…è¦æ—¶å€™è°ƒç”¨é¢å¤–çš„å·¥å…·å’Œå‡½æ•°ï¼‰</li><li>å°† prompt å‘é€ç»™äººå·¥æ™ºèƒ½æœåŠ¡ã€‚</li><li>æ¥æ”¶å¹¶è§£æå“åº”ã€‚</li><li>æœ€åå°†å“åº”è¿”å›åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¹‹å‰ã€‚</li></ul><p>å…·ä½“å‘é€ä»€ä¹ˆ promptï¼Œå¦‚ä½•è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œéƒ½éœ€è¦å† <code>KernelFunction</code> ä¸­å®ç°ã€‚</p><p>kernel çš„æ ¸å¿ƒå‡½æ•°æ˜¯<code>invoke</code>ï¼Œç”¨çš„è¯å°±æ˜¯ç”¨ <code>kernel.invoke(functions, args)</code>ï¼Œå¤§è‡´é€»è¾‘å¦‚ä¸‹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">results </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> func </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> functions:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">True</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># é¦–å…ˆè·å¾—ä¸€äº›å‚æ•°</span></span>
<span class="line"><span style="color:#24292E;">		function_invoking_args </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.on_function_invoking(func.metadata, arguments) </span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æŸ¥çœ‹ args ä¸­ skip, cancle, update args ç­‰å‚æ•°æ˜¯å¦ä¸º True</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æ˜¯çš„è¯é‡‡å–å¯¹åº”æªæ–½</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># è°ƒç”¨ kernel function	</span></span>
<span class="line"><span style="color:#24292E;">        function_result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> func.invoke(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">, arguments)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># å‚æ•°åå¤„ç†</span></span>
<span class="line"><span style="color:#24292E;">        function_invoked_args </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.on_function_invoked(func.metadata, arguments, function_result, exception)</span></span>
<span class="line"><span style="color:#24292E;">        results.append(function_invoked_args.function_result)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æŸ¥çœ‹ args ä¸­ skip, cancle, update args ç­‰å‚æ•°æ˜¯å¦ä¸º True</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6A737D;"># æ˜¯çš„è¯é‡‡å–å¯¹åº”æªæ–½</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æŸ¥çœ‹ is_repeat_requested å‚æ•°æ˜¯å¦ä¸º True</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> function_invoked_args.is_repeat_requested:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">continue</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">break</span></span>
<span class="line"><span style="color:#D73A49;">return</span><span style="color:#24292E;"> result</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-plugin" tabindex="-1"><a class="header-anchor" href="#_2-plugin" aria-hidden="true">#</a> 2. Plugin</h2><blockquote><p>Plugin ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ª KernelFunction ç»„ã€‚Semantic Kernel çš„ Plugin è®¾è®¡æ˜¯å‚è€ƒ <a href="https://platform.openai.com/docs/actions/introduction" target="_blank" rel="noopener noreferrer">OpenAi Plugin ï¼ˆActionï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å®ç°çš„ã€‚å› æ­¤ Semantic Kernel çš„ Plugin ä¹Ÿæ˜¯å¯ä»¥åœ¨å¦‚ ChatGPTï¼ŒM365 Copilot ç­‰å¹³å°ä¸Šä½¿ç”¨çš„ï¼Œ<a href="https://learn.microsoft.com/zh-cn/semantic-kernel/agents/plugins/openai-plugins" target="_blank" rel="noopener noreferrer">å‚è€ƒæŒ‡å—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p></blockquote><p>ä¸Šæ–‡æåˆ°ï¼ŒKernel å…·ä½“å‘é€ä»€ä¹ˆ promptï¼Œå¦‚ä½•è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œéƒ½éœ€è¦å† <code>KernelFunction</code> ä¸­å®ç°ã€‚åœ¨ Semantic Kernel ä¸­ï¼Œ <code>Plugin</code> è¿™ä¸ªç±»ä¸­å¯ä»¥æ­è½½å¤šä¸ª <code>KernelFunction</code>ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ› GPT èƒ½å¤Ÿæ”¯æŒæ•°å­¦æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ª <code>MathPlugin</code>ï¼Œé‡Œé¢è£…è½½ <code>çº¿æ€§ä»£æ•° Function</code>, <code>å¾®ç§¯åˆ† MathFunction</code>, <code>å»ºæ¨¡å·¥å…· Function</code> ç­‰ç­‰ã€‚</p><h3 id="ä»£ç è§£æ" tabindex="-1"><a class="header-anchor" href="#ä»£ç è§£æ" aria-hidden="true">#</a> ä»£ç è§£æ</h3><p>KernelPlugin ç±»ä¸­å‚¨å­˜æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">KernelPlugin</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">KernelBaseModel</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    name: Annotated[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">, StringConstraints(</span><span style="color:#E36209;">pattern</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">PLUGIN_NAME_REGEX</span><span style="color:#24292E;">, </span><span style="color:#E36209;">min_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)]</span></span>
<span class="line"><span style="color:#24292E;">    description: Optional[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    functions: Optional[Dict[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;KernelFunction&quot;</span><span style="color:#24292E;">]] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#E36209;">default_factory</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">dict</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆå§‹åŒ–åï¼Œå¯ä»¥é€šè¿‡å­—å…¸çš„æ–¹æ³•è·å– Plugin ä¸‹é¢å‚¨å­˜çš„ function ï¼ˆ<code>KernelFunction</code>ï¼‰</p><p>å³ï¼š <code>func = KernelPlugin[&#39;function_name&#39;]</code>ã€‚</p><h2 id="_3-kernelfunction" tabindex="-1"><a class="header-anchor" href="#_3-kernelfunction" aria-hidden="true">#</a> 3. KernelFunction</h2><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>KernelFunction åŒ…æ‹¬ 2 å¤§ç±»å‹ï¼Œ<code>KernelFunctionFromPrompt</code> å’Œ <code>KernelFunctionFromMethod</code> ã€‚</p><ul><li><code>KernelFunctionFromPrompt</code> ä¸­ä¼šæ•´ç†ç›®å‰ä»»åŠ¡çš„å‚æ•°ï¼Œç”Ÿæˆ promptï¼Œè°ƒç”¨ <code>Service</code> æ¥å‘å¤§æ¨¡å‹å‘é€ <code>Completion</code> è¯·æ±‚ã€‚</li><li><code>KernelFunctionFromMethod</code> ä¸­ä¼šæ•´ç† method è¿è¡Œéœ€è¦çš„å‚æ•°ï¼Œè€Œåè°ƒç”¨è¯¥ method æ¥è·å–ç»“æœã€‚</li></ul><p>ä»¥ä¸Šä¸¤ç§ Function éƒ½å¯ä»¥é€šè¿‡ <code>kernel.invoke()</code> æ¥è°ƒç”¨ï¼Œå…·ä½“å‚è€ƒä¸‹æ–‡ã€‚</p></div><h4 id="_3-1-kernel-function-from-prompt" tabindex="-1"><a class="header-anchor" href="#_3-1-kernel-function-from-prompt" aria-hidden="true">#</a> 3.1 Kernel Function from Prompt</h4><h5 id="åŸºç¡€ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ä½¿ç”¨" aria-hidden="true">#</a> <strong>åŸºç¡€ä½¿ç”¨</strong></h5><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># https://learn.microsoft.com/zh-cn/semantic-kernel/prompts/your-first-prompt?tabs=python</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> asyncio</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> semantic_kernel </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> sk</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> semantic_kernel.connectors.ai.open_ai </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> OpenAIChatCompletion, AzureChatCompletion</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> semantic_kernel.prompt_template.input_variable </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> InputVariable</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> semantic_kernel.prompt_template.prompt_template_config </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> PromptTemplateConfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">kernel </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> sk.Kernel()</span></span>
<span class="line"><span style="color:#6A737D;"># æŒ‡æ˜éœ€è¦ç”¨çš„ AI æœåŠ¡</span></span>
<span class="line"><span style="color:#24292E;">kernel.add_service(</span></span>
<span class="line"><span style="color:#24292E;">  AzureChatCompletion(</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">service_id</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">deployment_name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">deployment,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">endpoint</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">endpoint,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">api_key</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">api_key,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">api_version</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;2024-02-15-preview&quot;</span></span>
<span class="line"><span style="color:#24292E;">  )</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">prompt </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;What is the intent of this request? </span><span style="color:#005CC5;">{{</span><span style="color:#032F62;">$request</span><span style="color:#005CC5;">}}</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">req_settings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kernel.get_service(</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">).get_prompt_execution_settings_class()(</span><span style="color:#E36209;">service_id</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">service_id)</span></span>
<span class="line"><span style="color:#24292E;">chat_prompt_template_config </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PromptTemplateConfig(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">template</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">prompt,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Chat with the assistant&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">execution_settings</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{service_id: req_settings},</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">input_variables</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">        InputVariable(</span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;request&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;The user input&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">is_required</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    ],</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># é€šè¿‡ prompt templateï¼Œæ„é€  KernelFunctionFromPrompt</span></span>
<span class="line"><span style="color:#24292E;">prompt_function </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kernel.create_function_from_prompt(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">function_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;sample_zero&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">plugin_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;sample_plugin&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">prompt</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">prompt</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    request </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Hello&quot;</span></span>
<span class="line"><span style="color:#24292E;">    result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> kernel.invoke(prompt_function, </span><span style="color:#E36209;">request</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">request)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(result)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__name__</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;__main__&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    asyncio.run(main())</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="invoke-æºç é€»è¾‘åˆ†æ" tabindex="-1"><a class="header-anchor" href="#invoke-æºç é€»è¾‘åˆ†æ" aria-hidden="true">#</a> invoke æºç é€»è¾‘åˆ†æ</h5><p><code>KernelFunctionFromPrompt</code> ä¸­çš„ <code>_invoke_internal</code> ä¸ºä¸»è¦å…¥å£å‡½æ•°ã€‚å½“ä½¿ç”¨ <code>kernel.invoke( KernelFunctionFromPrompt)</code> æ—¶ï¼Œä¸»è¦ä¼šè°ƒç”¨ <code>_invoke_internal</code> ã€‚è¯¥ function è°ƒç”¨å¤§è‡´çš„é€»è¾‘ä¸ºï¼š</p><p><strong>Step 1ï¼šé¦–å…ˆæ•´ç† argumentsï¼Œå¯¹ prompt template å¡«å……é»˜è®¤å€¼</strong></p><p>æå‰åœ¨ function å¯¹åº”çš„é…ç½®æ–‡ä»¶ <code>config.json</code> ï¼ˆæˆ– <code>prompt_template_config</code>ï¼‰ä¸­å®šä¹‰ prompt templateï¼Œå¦‚ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">&quot;What is the intent of this request? {{$request}}&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»¥åŠå¯¹åº”å¡«å……å‚æ•°çš„å†…å®¹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;input_variables&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;request&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;description&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Your description here&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Hello&quot;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  ]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_invoke_internal</code> ä¼šå¯¹é…ç½®ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼Œå¦‚æœ <code>arguments</code> ä¸­ç¼ºå°‘äº† prompt template éœ€è¦çš„å¡«å……å‚æ•°æ—¶ï¼Œä¼šä½¿ç”¨ <code>default</code> å€¼è¿›è¡Œå¡«å……ã€‚</p><p><strong>Step 2ï¼šé€‰æ‹©éœ€è¦æ‰§è¡Œçš„ GPT Service</strong></p><p>æ¯ä¸€ä¸ª KernelFunction éƒ½å¯ä»¥æŒ‡å®šç”¨ä»€ä¹ˆ AI æ¨¡å‹æ¥è¿›è¡Œæ¨ç†æœåŠ¡ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ OpenAI GPT-4 ä¸º <code>default</code> æ¨¡å‹ï¼Œé‚£ä¹ˆå½“å¸Œæœ›æŸä¸ª KernelFunction ä½¿ç”¨ OpenAI GPT-4 è¿›è¡Œæ¨ç†å¼ï¼Œåªè¦è®¾ç½®å¯¹åº”çš„ <code>service_id=&quot;default&quot;</code> å³å¯ã€‚</p><p>åœ¨å¯¹åº”çš„ <code>config.json</code> ä¸­éœ€è¦å®šä¹‰å¥½ <code>&quot;execution_settings&quot;</code>ï¼ŒåŒ…æ‹¬è°ƒç”¨ GPT-4 æœåŠ¡æ—¶å€™ä½¿ç”¨çš„å‚æ•°ï¼ˆå¦‚ <code>max_tokens</code> ç­‰)ï¼Œå¦‚ä¸‹:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;execution_settings&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">: { </span><span style="color:#D73A49;">//</span><span style="color:#24292E;">æ­¤å¤„çš„ default ä¸º service </span><span style="color:#005CC5;">ID</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;max_tokens&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;temperature&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.9</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;top_p&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;presence_penalty&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;frequency_penalty&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.0</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ function å¯¹åº”çš„ service_id æ²¡æ‰¾åˆ°çš„è¯ï¼Œé‚£ä¹ˆ kernel ä¼šè‡ªåŠ¨é€‰ç”¨ä¸€ä¸ª Service æ¥è¿›è¡Œå¤§æ¨¡å‹æ¨ç†ã€‚</p><p><strong>Step 3ï¼šç”Ÿæˆ prompt</strong></p><p>prompt æ”¯æŒ jinja templateï¼Œå®é™…çš„å¡«å…… prompt templateï¼Œè€Œåè°ƒç”¨ chat æœåŠ¡çš„ä½ç½®åœ¨ <code>functions.kernel_function_from_prompt.KernelFunctionFromPrompt</code> ä¸­</p><p><strong>Step 4ï¼šå¤§æ¨¡å‹æ¨ç†</strong></p><p>å°†å†å²èŠå¤©å†…å®¹ä»¥åŠå½“å‰ prompt æ•´åˆåï¼Œè¿›è¡Œå¤§æ¨¡å‹æ¨ç†ï¼Œå¾—åˆ°æ¨¡å‹å›å¤ã€‚Semantic kernel python ç‰ˆæœ¬ç”¨çš„ä¹Ÿæ˜¯ openai çš„ python åŒ…æ¥è°ƒç”¨ Openai çš„æœåŠ¡ï¼Œå› æ­¤ç†è®ºä¸Šæ”¯æŒæ‰€æœ‰çš„ openai compatible apiã€‚</p><p><strong>Step 5ï¼šç”Ÿæˆ Result å¹¶è¿”å›</strong></p><p>è¿”å›çš„ç»“æœæ ¼å¼æ˜¯ <code>FunctionResult</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">: KernelFunctionMetadata,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;value&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">        {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;content&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;encoding&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    ],</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;metadata&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;arguments&quot;</span><span style="color:#24292E;">: arguments,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;metadata&quot;</span><span style="color:#24292E;">: [],</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>ä½†ç”±äº <code>FunctionResult</code> åŠå…¶ä¸­çš„ attr å¤§éƒ¨åˆ†è¢«é‡å†™äº† <code>__str__</code> æ–¹æ³•ï¼Œå› æ­¤åœ¨åç»­è¿›è¡Œå­—ç¬¦ä¸²è½¬å˜æ“ä½œè¿‡ç¨‹ä¸­ï¼Œåªä¼šè¾“å‡º <code>content</code> çš„å†…å®¹ï¼ŒåŠè°ƒç”¨ GPT çš„æ–‡å­—å›å¤å†…å®¹ã€‚</p></div><h4 id="_3-2-kernelfunctionfrommethod" tabindex="-1"><a class="header-anchor" href="#_3-2-kernelfunctionfrommethod" aria-hidden="true">#</a> 3.2 KernelFunctionFromMethod</h4><h5 id="åŸºç¡€ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ä½¿ç”¨-1" aria-hidden="true">#</a> <strong>åŸºç¡€ä½¿ç”¨</strong></h5><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> semantic_kernel </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> sk</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> semantic_kernel.functions.kernel_function_decorator </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> kernel_function</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> semantic_kernel.kernel_pydantic </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> KernelBaseModel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyPlugin</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">KernelBaseModel</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">@kernel_function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;say hello&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">hello</span><span style="color:#24292E;">(self) -&gt; </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Hello&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">kernel </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> sk.Kernel()</span></span>
<span class="line"><span style="color:#24292E;">test </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kernel.import_plugin_from_object(MyPlugin(), </span><span style="color:#032F62;">&quot;MyPlugin&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> kernel.invoke(test[</span><span style="color:#032F62;">&#39;hello&#39;</span><span style="color:#24292E;">])</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(result)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="invoke-æºç é€»è¾‘åˆ†æ-1" tabindex="-1"><a class="header-anchor" href="#invoke-æºç é€»è¾‘åˆ†æ-1" aria-hidden="true">#</a> invoke æºç é€»è¾‘åˆ†æ</h5><p><strong>Step 1ï¼šé¦–å…ˆæ•´ç† argumentsï¼Œæå– method éœ€è¦çš„å‚æ•°</strong></p><p><strong>Step 2ï¼šè°ƒç”¨ methodï¼Œæ•´ç†è¿”å›ç»“æœ</strong></p><p>å› ä¸ºå‡½æ•°è°ƒç”¨å¯èƒ½è¿”å› generatorï¼Œæˆ– Awaitableï¼Œæˆ– asyncgen å¯¹è±¡ï¼Œå› æ­¤éœ€è¦å¯¹è¿”å›å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿è¿”å›çš„æ˜¯æœ€ç»ˆç»“æœã€‚</p><p><strong>Step 3ï¼šç”Ÿæˆ Result</strong></p><h4 id="_3-3-semantic-kernel-prompt-template-çš„ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#_3-3-semantic-kernel-prompt-template-çš„ç‰¹ç‚¹" aria-hidden="true">#</a> 3.3 Semantic Kernel Prompt Template çš„ç‰¹ç‚¹</h4><ol><li><p><a href="https://learn.microsoft.com/zh-cn/semantic-kernel/prompts/calling-nested-functions" target="_blank" rel="noopener noreferrer">prompt ä¸­å¯ä»¥è‡ªåŠ¨è°ƒç”¨å…¶ä»–çš„ plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://learn.microsoft.com/zh-cn/semantic-kernel/prompts/saving-prompts-as-files?tabs=python" target="_blank" rel="noopener noreferrer">prmopt å¯ä»¥é€šè¿‡ file çš„æ–¹å¼æ¥å¯¼å…¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ol><p>ç¤ºä¾‹ï¼šåœ¨ prmopt template ä¸­ï¼Œä½¿ç”¨ KernelFunctionFromMethodï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MyPlugin</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">KernelBaseModel</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">@kernel_function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;say hello&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(self) -&gt; </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;numpy&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> random.random() </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.5</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pandas&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;result is &quot;</span><span style="color:#24292E;">, result)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> result</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">kernel.import_plugin_from_object(MyPlugin(), </span><span style="color:#E36209;">plugin_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;GetLanguage&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># è½¬æ¢è¿™ä¸ª template æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ GetLanguage.get å‡½æ•°</span></span>
<span class="line"><span style="color:#24292E;">prompt </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Please generate </span><span style="color:#005CC5;">{{</span><span style="color:#032F62;">$number</span><span style="color:#005CC5;">}}</span><span style="color:#032F62;"> sample </span><span style="color:#005CC5;">{{</span><span style="color:#032F62;">GetLanguage.get</span><span style="color:#005CC5;">}}</span><span style="color:#032F62;"> code&quot;</span></span>
<span class="line"><span style="color:#24292E;">req_settings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kernel.get_service(</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">).get_prompt_execution_settings_class()(</span><span style="color:#E36209;">service_id</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">service_id)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">chat_prompt_template_config </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PromptTemplateConfig(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">template</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">prompt,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Chat with the assistant&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">execution_settings</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{service_id: req_settings},</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">input_variables</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">        InputVariable(</span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;number&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;The user input&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">is_required</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    ],</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">prompt_function </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kernel.create_function_from_prompt(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">function_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;sample_zero&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">plugin_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;sample_plugin&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">prompt</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">prompt</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> kernel.invoke(prompt_function, </span><span style="color:#E36209;">number</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(result) </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è½¬æ¢ä»¥ä¸Š template æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ GetLanguage.get å‡½æ•°ã€‚åŒæ—¶æ”¯æŒå¯¹ function çš„è¾“å…¥å’Œè¾“å‡ºç»“æœè¿›è¡Œæ•°æ®æ ¼å¼éªŒè¯ï¼Œæ¯”å¦‚ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6F42C1;">@kernel_function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Add&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">   self,</span></span>
<span class="line"><span style="color:#24292E;">   number1: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the first number to add&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">   number2: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the second number to add&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">) -&gt; Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the output is a float&quot;</span><span style="color:#24292E;">]:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">float</span><span style="color:#24292E;">(number1) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">float</span><span style="color:#24292E;">(number2)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä½¿ç”¨ Annotated ä¹‹åï¼Œå‡½æ•°ç»“æœåœ¨å¡«å……åˆ° prompt ä¸­æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ã€‚</p><p>å¦‚æœ kernel function è®¾ç½®äº†<code>name</code> ï¼Œåœ¨ prompt ä¸­ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>prompt = &quot;{{Add &#39;1&#39; &#39;2&#39;}}&quot;</code> æ¥è°ƒç”¨å‡½æ•°åè¿›è¡Œä¼ å‚ã€‚</p><h2 id="_4-semantic-memory" tabindex="-1"><a class="header-anchor" href="#_4-semantic-memory" aria-hidden="true">#</a> 4. Semantic Memory</h2><p>å¦‚æœç”¨ SK åšä¸€ä¸ªä¼ ç»Ÿçš„ chat æœåŠ¡çš„è¯ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹ç®€å•çš„æ–¹å¼å®ç°ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">chat</span><span style="color:#24292E;">(input_text: </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">) -&gt; </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">f</span><span style="color:#032F62;">&quot;User: </span><span style="color:#005CC5;">{</span><span style="color:#24292E;">input_text</span><span style="color:#005CC5;">}</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    chat_history.add_user_message(input_text)</span></span>
<span class="line"><span style="color:#24292E;">	</span></span>
<span class="line"><span style="color:#24292E;">    answer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> kernel.invoke(chat_function, KernelArguments(</span><span style="color:#E36209;">user_input</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">input_text, </span><span style="color:#E36209;">history</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">chat_history))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">f</span><span style="color:#032F62;">&quot;ChatBot: </span><span style="color:#005CC5;">{</span><span style="color:#24292E;">answer</span><span style="color:#005CC5;">}</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    chat_history.add_assistant_message(</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">(answer))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ <code>chat function </code> ä¸­å†™å¥½ system prompt å’Œå…¶ä»– prompt å‚æ•°ã€‚</p><p>ä½†å½“å†å²å¯¹è¯å†…å®¹éå¸¸å¤šçš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå‡ºç°é•¿åº¦è¶…å‡ºä¸Šä¸‹æ–‡çš„æƒ…å†µã€‚Semantic Kernel ä¸­æœ‰ semantic Memory ä¸€ç±»ï¼Œå¯ä»¥é€šè¿‡ embedding ç›¸ä¼¼åº¦æ¥è®²ç›¸å…³çš„å†å²å¯¹è¯å†…å®¹ï¼ŒåŠ å…¥åˆ°æœ€ç»ˆçš„ prompt å½“ä¸­ã€‚</p><p>å…·ä½“å®ç°æ–¹æ³•å¯ä»¥å‚è€ƒ <code>core_plugins/test_memory_plugin.py</code>ã€‚æ€»ç»“æ¥è¯´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>æ„é€ ä¸€ä¸ª plugin ï¼Œé‡Œé¢åŒ…å«äº†å„ç§ method function ç”¨äºæ£€ç´¢ vector store çš„ç›¸å…³æ¥å£ã€‚</li><li>æ„é€ å¦ä¸€ä¸ª prompt functionï¼Œå°† method function æ£€ç´¢çš„ç›¸å…³ä¿¡æ¯æ•´ç†æ‹¼æ¥åˆ°æœ€ç»ˆçš„ prompt é‡Œã€‚</li><li>è°ƒç”¨ prompt functionï¼Œå³å¯å®ç° Semantci Memoryã€‚</li></ol><h2 id="_5-services" tabindex="-1"><a class="header-anchor" href="#_5-services" aria-hidden="true">#</a> 5. Services</h2><blockquote><p>ç”¨äºå®šä¹‰ä½¿ç”¨çš„ AI æ¨¡å‹ï¼Œå¯ä»¥ä» huggingfaceï¼ŒGPT ç­‰åœ°æ–¹é€‰å–ã€‚</p></blockquote><p>Services çš„æºä»£ç é›†ä¸­åœ¨ SK ä»“åº“çš„ <code>services</code> ä¸­ã€‚</p><p>SK æ”¯æŒæˆ‘ä»¬åœ¨åŒä¸€ä¸ª kernel ä¸­è°ƒç”¨ä¸åŒçš„æ¨¡å‹ï¼Œæ¯”å¦‚ <code>gpt-35-turbo</code>ï¼Œ<code>Llama</code>ï¼Œ<code>GPT-4-TURBO</code> ç­‰ã€‚éœ€è¦ç”¨ <code>kernel.add_service</code> æ·»åŠ å¯¹åº”çš„ç±»ã€‚</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">kernel.add_service(</span></span>
<span class="line"><span style="color:#24292E;">  AzureChatCompletion(</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">service_id</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">service_id,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">deployment_name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">deployment,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">endpoint</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">endpoint,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#E36209;">api_key</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">api_key,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">api_version</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;2024-02-15-preview&quot;</span></span>
<span class="line"><span style="color:#24292E;">  )</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>service ç”¨äºå®šä¹‰å¤§æ¨¡å‹æœåŠ¡ï¼Œå¦‚ huggingfaceï¼Œ openai ç­‰ã€‚Function ä¼šè°ƒç”¨ service ä¸­çš„ <code>complete_chat</code> å‡½æ•°è¿›è¡Œæ¨ç†ï¼Œè·å¾—å›å¤ã€‚å…·ä½“ä½ç½®åœ¨ <code>connectors.ai.openai.services.open_ai_chat_completion_base.OpenAIChatCompletionBase</code> ä¸­ã€‚</p><h2 id="_6-planner" tabindex="-1"><a class="header-anchor" href="#_6-planner" aria-hidden="true">#</a> 6. Planner</h2><h3 id="_6-1-basic-planner" tabindex="-1"><a class="header-anchor" href="#_6-1-basic-planner" aria-hidden="true">#</a> 6.1 Basic Planner</h3><p>basic planner å¯ä»¥çœ‹åšä¸€ä¸ª <code>KernelFunctionFromPrompt</code>ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ol><li>ä¸€æ®µä½ çš„ä»»åŠ¡æè¿°ï¼Œæ¯”å¦‚â€œå¸®æˆ‘å†™ä¸€ä»½è¡Œä¸šæŠ¥å‘Šâ€ã€‚</li><li>åšä»¥ä¸Šä»»åŠ¡éœ€è¦ç”¨åˆ°çš„ functionã€‚æ¯”å¦‚ä½ å¯èƒ½éœ€è¦å®šä¹‰ä¸€äº›ï¼Œå¯ä»¥ä»ç½‘ä¸Šæœç´¢åˆ°è¡Œä¸šæŠ¥å‘Šçš„å‡½æ•°ã€‚</li><li>è¿è¡Œ plannerï¼Œplanner ä¼šå°† function ä¿¡æ¯æ•´åˆåï¼Œæ”¾åˆ°ä»¥ä¸‹ prompt template å½“ä¸­ï¼Œç”Ÿæˆ planã€‚</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">&quot;&quot;&quot; </span></span>
<span class="line"><span style="color:#032F62;">You are a planner for the Semantic Kernel.</span></span>
<span class="line"><span style="color:#032F62;">Your job is to create a properly formatted JSON plan step by step, to satisfy the goal given.</span></span>
<span class="line"><span style="color:#032F62;">Create a list of subtasks based off the [GOAL] provided.</span></span>
<span class="line"><span style="color:#032F62;">Each subtask must be from within the [AVAILABLE FUNCTIONS] list. Do not use any functions that are not in the list.</span></span>
<span class="line"><span style="color:#032F62;">Base your decisions on which functions to use from the description and the name of the function.</span></span>
<span class="line"><span style="color:#032F62;">Sometimes, a function may take arguments. Provide them if necessary.</span></span>
<span class="line"><span style="color:#032F62;">The plan should be as short as possible.</span></span>
<span class="line"><span style="color:#032F62;">For example:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[AVAILABLE FUNCTIONS]</span></span>
<span class="line"><span style="color:#032F62;">EmailConnector.LookupContactEmail</span></span>
<span class="line"><span style="color:#032F62;">description: looks up the a contact and retrieves their email address</span></span>
<span class="line"><span style="color:#032F62;">args:</span></span>
<span class="line"><span style="color:#032F62;">- name: the name to look up</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">WriterPlugin.EmailTo</span></span>
<span class="line"><span style="color:#032F62;">description: email the input text to a recipient</span></span>
<span class="line"><span style="color:#032F62;">args:</span></span>
<span class="line"><span style="color:#032F62;">- input: the text to email</span></span>
<span class="line"><span style="color:#032F62;">- recipient: the recipient&#39;s email address. Multiple addresses may be included if separated by &#39;;&#39;.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">WriterPlugin.Translate</span></span>
<span class="line"><span style="color:#032F62;">description: translate the input to another language</span></span>
<span class="line"><span style="color:#032F62;">args:</span></span>
<span class="line"><span style="color:#032F62;">- input: the text to translate</span></span>
<span class="line"><span style="color:#032F62;">- language: the language to translate to</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">WriterPlugin.Summarize</span></span>
<span class="line"><span style="color:#032F62;">description: summarize input text</span></span>
<span class="line"><span style="color:#032F62;">args:</span></span>
<span class="line"><span style="color:#032F62;">- input: the text to summarize</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">FunPlugin.Joke</span></span>
<span class="line"><span style="color:#032F62;">description: Generate a funny joke</span></span>
<span class="line"><span style="color:#032F62;">args:</span></span>
<span class="line"><span style="color:#032F62;">- input: the input to generate a joke about</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[GOAL]</span></span>
<span class="line"><span style="color:#032F62;">&quot;Tell a joke about cars. Translate it to Spanish&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[OUTPUT]</span></span>
<span class="line"><span style="color:#032F62;">    {</span></span>
<span class="line"><span style="color:#032F62;">        &quot;input&quot;: &quot;cars&quot;,</span></span>
<span class="line"><span style="color:#032F62;">        &quot;subtasks&quot;: [</span></span>
<span class="line"><span style="color:#032F62;">            {&quot;function&quot;: &quot;FunPlugin.Joke&quot;},</span></span>
<span class="line"><span style="color:#032F62;">            {&quot;function&quot;: &quot;WriterPlugin.Translate&quot;, &quot;args&quot;: {&quot;language&quot;: &quot;Spanish&quot;}}</span></span>
<span class="line"><span style="color:#032F62;">        ]</span></span>
<span class="line"><span style="color:#032F62;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[AVAILABLE FUNCTIONS]</span></span>
<span class="line"><span style="color:#032F62;">{{$available_functions}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[GOAL]</span></span>
<span class="line"><span style="color:#032F62;">{{$goal}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[OUTPUT]</span></span>
<span class="line"><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡ ä¸ªç»†èŠ‚ï¼š</p><ul><li>è¢«æ•´åˆåˆ° prompt ä¸­çš„ funciton ä¿¡æ¯æœ‰ï¼šfunction åç§°ï¼›functino æ‰€å± plugin åç§°ï¼›function descriptionï¼›function å‚æ•°ã€‚ï¼ˆå¯ä»¥çœ‹åšæ˜¯ æŠŠ function çš„ docstring åŠ å…¥åˆ°äº† prompt ä¸­ï¼‰</li><li>plan è§£æï¼šå°½ç®¡åœ¨ prompt ä¸­å‘Šè¯‰ GPT åªè¿”å›ä¸€ä¸ª jsonï¼Œä½†æ˜¯åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œsemantic kernel è¿˜æ˜¯å…ˆç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æŠ½å–å‡ºå…³é”®ä¿¡æ¯ï¼Œè€Œååœ¨ä½¿ç”¨ json.load åŠ è½½ã€‚</li><li>è¯¥ planner è¿˜æ˜¯å¾ˆè€ƒéªŒ GPT æ€§èƒ½çš„ï¼Œå¦‚æœ function åç§°åŒ¹é…ä¸ä¸Šï¼Œé‚£ä¹ˆ basic planner å°±ä¼šæŠ¥é”™ã€‚</li></ul><h3 id="_6-2-sequentialplanner" tabindex="-1"><a class="header-anchor" href="#_6-2-sequentialplanner" aria-hidden="true">#</a> 6.2 SequentialPlanner</h3><p>SequentialPlanner ä¸ basicPlanner æœ‰ç‚¹ç±»ä¼¼ï¼Œä»¥ä¸‹æ˜¯ä»–çš„ prompt template</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">Create an XML plan step by step, to satisfy the goal given, with the available functions.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[AVAILABLE FUNCTIONS]</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">{{$available_functions}}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[END AVAILABLE FUNCTIONS]</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">To create a plan, follow these steps:</span></span>
<span class="line"><span style="color:#24292e;">0. The plan should be as short as possible.</span></span>
<span class="line"><span style="color:#24292e;">1. From a &lt;goal&gt; create a &lt;plan&gt; as a series of &lt;functions&gt;.</span></span>
<span class="line"><span style="color:#24292e;">2. A plan has &#39;INPUT&#39; available in context variables by default.</span></span>
<span class="line"><span style="color:#24292e;">3. Before using any function in a plan, check that it is present in the [AVAILABLE FUNCTIONS] list. If it is not, do not use it.</span></span>
<span class="line"><span style="color:#24292e;">4. Only use functions that are required for the given goal.</span></span>
<span class="line"><span style="color:#24292e;">5. Append an &quot;END&quot; XML comment at the end of the plan after the final closing &lt;/plan&gt; tag.</span></span>
<span class="line"><span style="color:#24292e;">6. Always output valid XML that can be parsed by an XML parser.</span></span>
<span class="line"><span style="color:#24292e;">7. If a plan cannot be created with the [AVAILABLE FUNCTIONS], return &lt;plan /&gt;.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">All plans take the form of:</span></span>
<span class="line"><span style="color:#24292e;">&lt;plan&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;!-- ... reason for taking step ... --&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;function.{FullyQualifiedFunctionName} ... /&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;!-- ... reason for taking step ... --&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;function.{FullyQualifiedFunctionName} ... /&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;!-- ... reason for taking step ... --&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;function.{FullyQualifiedFunctionName} ... /&gt;</span></span>
<span class="line"><span style="color:#24292e;">    (... etc ...)</span></span>
<span class="line"><span style="color:#24292e;">&lt;/plan&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;!-- END --&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">To call a function, follow these steps:</span></span>
<span class="line"><span style="color:#24292e;">1. A function has one or more named parameters and a single &#39;output&#39; which are all strings. Parameter values should be xml escaped.</span></span>
<span class="line"><span style="color:#24292e;">2. To save an &#39;output&#39; from a &lt;function&gt;, to pass into a future &lt;function&gt;, use &lt;function.{FullyQualifiedFunctionName} ... setContextVariable=&quot;&lt;UNIQUE_VARIABLE_KEY&gt;&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;">3. To save an &#39;output&#39; from a &lt;function&gt;, to return as part of a plan result, use &lt;function.{FullyQualifiedFunctionName} ... appendToResult=&quot;RESULT__&lt;UNIQUE_RESULT_KEY&gt;&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;">4. Use a &#39;$&#39; to reference a context variable in a parameter, e.g. when `INPUT=&#39;world&#39;` the parameter &#39;Hello $INPUT&#39; will evaluate to `Hello world`.</span></span>
<span class="line"><span style="color:#24292e;">5. Functions do not have access to the context variables of other functions. Do not attempt to use context variables as arrays or objects. Instead, use available functions to extract specific elements or properties from context variables.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">DO NOT DO THIS, THE PARAMETER VALUE IS NOT XML ESCAPED:</span></span>
<span class="line"><span style="color:#24292e;">&lt;function.Plugin-Name4 input=&quot;$SOME_PREVIOUS_OUTPUT&quot; parameter_name=&quot;some value with a &lt;!-- &#39;comment&#39; in it--&gt;&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">DO NOT DO THIS, THE PARAMETER VALUE IS ATTEMPTING TO USE A CONTEXT VARIABLE AS AN ARRAY/OBJECT:</span></span>
<span class="line"><span style="color:#24292e;">&lt;function.Plugin-CallFunction input=&quot;$OTHER_OUTPUT[1]&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">DO NOT DO THIS, THE FUNCTION NAME IS NOT A FULLY QUALIFIED FUNCTION NAME:</span></span>
<span class="line"><span style="color:#24292e;">&lt;function.CallFunction input=&quot;world&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Here is a valid example of how to call a function &quot;_plugin-Function_Name&quot; with a single input and save its output:</span></span>
<span class="line"><span style="color:#24292e;">&lt;function._plugin-Function_Name input=&quot;this is my input&quot; setContextVariable=&quot;SOME_KEY&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Here is a valid example of how to call a function &quot;Plugin-FunctionName2&quot; with a single input and return its output as part of the plan result:</span></span>
<span class="line"><span style="color:#24292e;">&lt;function.Plugin-FunctionName2 input=&quot;Hello $INPUT&quot; appendToResult=&quot;RESULT__FINAL_ANSWER&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Here is a valid example of how to call a function &quot;Name3&quot; with multiple inputs:</span></span>
<span class="line"><span style="color:#24292e;">&lt;function.Plugin-Name3 input=&quot;$SOME_PREVIOUS_OUTPUT&quot; parameter_name=&quot;some value with a &amp;lt;!-- &amp;apos;comment&amp;apos; in it--&amp;gt;&quot;/&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Begin!</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">&lt;goal&gt;{{$input}}&lt;/goal&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€äº›ç»†èŠ‚ï¼š</p><ul><li>Function éƒ¨åˆ† plan æŠ½å–ï¼šå…ˆç”¨ <code>defusedxml</code> è¿›è¡Œ XML æŠ½å–ï¼Œå¤±è´¥çš„è¯ï¼Œç”¨ re å…ˆè¿›è¡Œé¢„å¤„ç†ï¼Œè€Œåå†æ¬¡ç”¨ <code>defusedxml</code> è¿›è¡Œ XML æŠ½å–</li><li>ç›¸æ¯”äº basic plannerï¼Œsequence planner æä¾›äº† <code>allow_missing_functions</code> å‚æ•°ã€‚å½“ function åç§°è§£æé”™è¯¯æ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿè¿”å› planã€‚ä½†èƒ½ä¸èƒ½æ‰§è¡Œå°±ä¸ä¸€å®šäº†</li></ul><h3 id="_6-3-action-planner" tabindex="-1"><a class="header-anchor" href="#_6-3-action-planner" aria-hidden="true">#</a> 6.3 Action Planner</h3><p>å¤§è‡´æµç¨‹ä¸ºï¼š</p><ol><li>ä½¿ç”¨ä»¥ä¸‹ prompt template ç”Ÿæˆ planã€‚</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">A planner takes a </span><span style="color:#005CC5;">list</span><span style="color:#24292E;"> of functions, a goal, </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> chooses which function to use.</span></span>
<span class="line"><span style="color:#24292E;">For each function the </span><span style="color:#005CC5;">list</span><span style="color:#24292E;"> includes details about the </span><span style="color:#005CC5;">input</span><span style="color:#24292E;"> parameters.</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">START</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">OF</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">EXAMPLES</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">{{ActionPlanner_Excluded.GoodExamples}}</span></span>
<span class="line"><span style="color:#24292E;">{{ActionPlanner_Excluded.EdgeCaseExamples}}</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">END</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">OF</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">EXAMPLES</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">REAL</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SCENARIO</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">STARTS</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">HERE</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;"> List of functions:</span></span>
<span class="line"><span style="color:#24292E;">{{ActionPlanner_Excluded.ListOfFunctions}}</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;"> End </span><span style="color:#005CC5;">list</span><span style="color:#24292E;"> of functions.</span></span>
<span class="line"><span style="color:#24292E;">Goal: {{ </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#24292E;">goal }}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­éœ€è¦å¡«å……çš„æœ‰å‡ ä¸ª semantic functionï¼š</p><ol><li><code>List of Functions</code> : å°†æ‰€æœ‰å‡½æ•°çš„ descriptionï¼Œåå­—ï¼Œè¾“å…¥ï¼Œè¾“å‡ºç­‰ä¿¡æ¯æ‹¼æ¥ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">// Returns the Addition result of the values provided.</span></span>
<span class="line"><span style="color:#24292e;">math.Add</span></span>
<span class="line"><span style="color:#24292e;">Parameter &quot;&quot;input&quot;&quot;: the first number to add.</span></span>
<span class="line"><span style="color:#24292e;">Parameter &quot;&quot;amount&quot;&quot;: the second number to add.</span></span>
<span class="line"><span style="color:#24292e;">// Subtracts value to a value.</span></span>
<span class="line"><span style="color:#24292e;">math.Subtract</span></span>
<span class="line"><span style="color:#24292e;">Parameter &quot;&quot;input&quot;&quot;: the first number.</span></span>
<span class="line"><span style="color:#24292e;">Parameter &quot;&quot;amount&quot;&quot;: the number to subtract.</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><code>GoodExamples</code>ï¼šå›ºå®šçš„ prompt exampleï¼Œåº”è¯¥æ˜¯ç”¨æ¥æ§åˆ¶è¾“å‡ºæ ·å¼</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292e;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292e;">[EXAMPLE]</span></span>
<span class="line"><span style="color:#24292e;">- List of functions:</span></span>
<span class="line"><span style="color:#24292e;">// Get the current time.</span></span>
<span class="line"><span style="color:#24292e;">TimePlugin.Time</span></span>
<span class="line"><span style="color:#24292e;">No parameters.</span></span>
<span class="line"><span style="color:#24292e;">// Makes a POST request to a uri.</span></span>
<span class="line"><span style="color:#24292e;">HttpPlugin.PostAsync</span></span>
<span class="line"><span style="color:#24292e;">Parameter &quot;&quot;body&quot;&quot;: The body of the request.</span></span>
<span class="line"><span style="color:#24292e;">- End list of functions.</span></span>
<span class="line"><span style="color:#24292e;">Goal: get the current time.</span></span>
<span class="line"><span style="color:#24292e;">{&quot;&quot;plan&quot;&quot;:{</span></span>
<span class="line"><span style="color:#24292e;">&quot;&quot;rationale&quot;&quot;: &quot;&quot;the list contains a function that gets the current time (now)&quot;&quot;,</span></span>
<span class="line"><span style="color:#24292e;">&quot;&quot;function&quot;&quot;: &quot;&quot;TimePlugin.Time&quot;&quot;</span></span>
<span class="line"><span style="color:#24292e;">}}</span></span>
<span class="line"><span style="color:#24292e;">#END-OF-PLAN</span></span>
<span class="line"><span style="color:#24292e;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292e;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><code>EdgeCaseExamples</code>ï¼šå›ºå®šçš„ prompt exampleï¼Œåº”è¯¥æ˜¯ç”¨æ¥æ§åˆ¶è¾“å‡ºæ ·å¼</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#032F62;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#032F62;">[EXAMPLE]</span></span>
<span class="line"><span style="color:#032F62;">- List of functions:</span></span>
<span class="line"><span style="color:#032F62;">// Get the current time.</span></span>
<span class="line"><span style="color:#032F62;">TimePlugin.Time</span></span>
<span class="line"><span style="color:#032F62;">No parameters.</span></span>
<span class="line"><span style="color:#032F62;">// Write a file.</span></span>
<span class="line"><span style="color:#032F62;">FileIOPlugin.WriteAsync</span></span>
<span class="line"><span style="color:#032F62;">Parameter &quot;&quot;path&quot;&quot;: Destination file. (default value: sample.txt)</span></span>
<span class="line"><span style="color:#032F62;">Parameter &quot;&quot;content&quot;&quot;: File content.</span></span>
<span class="line"><span style="color:#032F62;">// Makes a POST request to a uri.</span></span>
<span class="line"><span style="color:#032F62;">HttpPlugin.PostAsync</span></span>
<span class="line"><span style="color:#032F62;">Parameter &quot;&quot;body&quot;&quot;: The body of the request.</span></span>
<span class="line"><span style="color:#032F62;">- End list of functions.</span></span>
<span class="line"><span style="color:#032F62;">Goal: tell me a joke.</span></span>
<span class="line"><span style="color:#032F62;">{&quot;&quot;plan&quot;&quot;:{</span></span>
<span class="line"><span style="color:#032F62;">&quot;&quot;rationale&quot;&quot;: &quot;&quot;the list does not contain functions to tell jokes or something funny&quot;&quot;,</span></span>
<span class="line"><span style="color:#032F62;">&quot;&quot;function&quot;&quot;: &quot;&quot;&quot;&quot;,</span></span>
<span class="line"><span style="color:#032F62;">&quot;&quot;parameters&quot;&quot;: {</span></span>
<span class="line"><span style="color:#032F62;">}}}</span></span>
<span class="line"><span style="color:#032F62;">#END-OF-PLAN</span></span>
<span class="line"><span style="color:#032F62;">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€äº›ç»†èŠ‚ï¼š</p><ul><li>ä¸å…¶ä»– planner ç›¸ä¼¼çš„ï¼Œè™½ç„¶è¦æ±‚ GPT è¾“å‡º json æ ¼å¼ï¼Œä½†æ˜¯åœ¨è§£æ json å‰éƒ½ä¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œé¢„å¤„ç†ã€‚</li></ul><h3 id="_6-4-stepwise-planner" tabindex="-1"><a class="header-anchor" href="#_6-4-stepwise-planner" aria-hidden="true">#</a> 6.4 Stepwise Planner</h3><p>æ ¹æ®å®˜æ–¹æè¿°ï¼Œè¯¥ planner å‚è€ƒäº† MRKL (Modular Reasoning, Knowledge and Language) ï¼Œè¯¥ planner æœ‰ç‚¹ç±»ä¼¼ ReACTã€‚</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MathPlugin</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">    Description: MathPlugin provides a set of functions to make Math calculations.</span></span>
<span class="line"><span style="color:#032F62;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">@kernel_function</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Subtracts value to a value&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Subtract&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">subtract</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        self,</span></span>
<span class="line"><span style="color:#24292E;">        input: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the first number&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        amount: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the number to subtract&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">    ) -&gt; </span><span style="color:#005CC5;">float</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">        Returns the difference of numbers provided.</span></span>
<span class="line"><span style="color:#032F62;">        &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">input</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> amount</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">@kernel_function</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Add value to a value&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Add&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        self,</span></span>
<span class="line"><span style="color:#24292E;">        input: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the first number&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        amount: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the number to add&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">    ) -&gt; </span><span style="color:#005CC5;">float</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">        Returns the sum of numbers provided.</span></span>
<span class="line"><span style="color:#032F62;">        &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">input</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> amount </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">@kernel_function</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Multiply value to a value&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Multiply&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">multiply</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        self,</span></span>
<span class="line"><span style="color:#24292E;">        input: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the first number&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        amount: Annotated[</span><span style="color:#005CC5;">float</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;the number to multiply&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">    ) -&gt; </span><span style="color:#005CC5;">float</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">        Returns the difference of numbers provided.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">        :param initial_value_text: Initial value as string to subtract the specified amount</span></span>
<span class="line"><span style="color:#032F62;">        :param context: Contains the context to get the numbers from</span></span>
<span class="line"><span style="color:#032F62;">        :return: The resulting subtraction as a string</span></span>
<span class="line"><span style="color:#032F62;">        &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">input</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> amount</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#6A737D;"># from semantic_kernel.core_plugins import MathPlugin, TextPlugin, TimePlugin</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">text_plugin </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kernel.import_plugin_from_object(MathPlugin(), </span><span style="color:#032F62;">&quot;MathPlugin&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> semantic_kernel.planners.stepwise_planner </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> StepwisePlanner, StepwisePlannerConfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">planner </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> StepwisePlanner(kernel, StepwisePlannerConfig(</span><span style="color:#E36209;">max_iterations</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">, </span><span style="color:#E36209;">min_iteration_time_ms</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">))</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(): </span></span>
<span class="line"><span style="color:#24292E;">    ask </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Figure out how much I have if first, my investment of 2130.23 dollars increased by 23%, and then I spend $5 on a coffee&quot;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># noqa: E501</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    plan </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> planner.create_plan(</span><span style="color:#E36209;">goal</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">ask)</span></span>
<span class="line"><span style="color:#24292E;">    result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> plan.invoke(kernel)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> index, step </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">enumerate</span><span style="color:#24292E;">(plan._steps):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Step:&quot;</span><span style="color:#24292E;">, index)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Description:&quot;</span><span style="color:#24292E;">, step.description)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Function:&quot;</span><span style="color:#24292E;">, step.plugin_name </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;.&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> step._function.name)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">f</span><span style="color:#032F62;">&quot;  Output: </span><span style="color:#005CC5;">{</span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">.join(</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">(res) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> res </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> result.metadata[</span><span style="color:#032F62;">&#39;results&#39;</span><span style="color:#24292E;">])</span><span style="color:#005CC5;">}</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†æï¼š</p><ol><li>æ½œåœ¨ bugï¼š</li></ol><p>ç”±äºé‡‡ç”¨äº†ç±»ä¼¼ ReACT çš„æ€è·¯ï¼Œå› æ­¤åœ¨è°ƒç”¨ openai api æ—¶ï¼Œéœ€è¦è®¾ç½® <code>stop</code> å‚æ•°ä¸º <code>[&quot;[OBSERVATION]&quot;, &quot;\n[THOUGHT]&quot;]</code>ã€‚éƒ¨åˆ†å®˜æ–¹çš„æºç ä¸­ï¼Œ<code>stop</code> å‚æ•°ä¸º Noneï¼Œå´è®¾ç½®äº† <code>&quot;stop_sequences&quot;: [&quot;[OBSERVATION]&quot;, &quot;\n[THOUGHT]&quot;]</code> å¯¼è‡´ planner è¿è¡Œä¸æˆåŠŸã€‚</p><ol><li>åˆå§‹ prompt å¦‚ä¸‹ï¼š</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">INSTRUCTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">Answer the following questions </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> accurately </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> possible using the provided functions.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">AVAILABLE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">FUNCTIONS</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">The function definitions below are </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the following </span><span style="color:#005CC5;">format</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">functionName</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">description</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  inputs:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">parameterName</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">parameterDescription</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">{{</span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#24292E;">function_descriptions}}</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">END</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">AVAILABLE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">FUNCTIONS</span><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">USAGE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INSTRUCTIONS</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">To use the functions, specify a </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;"> blob representing an action. The </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;"> blob should contain an </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;"> key </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> the name of the function to use, </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> an </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;"> key </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> a </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">object</span><span style="color:#24292E;"> of string values to use when calling the function.</span></span>
<span class="line"><span style="color:#24292E;">Do </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> call functions directly; they must be invoked through an action.</span></span>
<span class="line"><span style="color:#24292E;">The </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;"> value should always include an </span><span style="color:#032F62;">&quot;input&quot;</span><span style="color:#24292E;"> key, even </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> the </span><span style="color:#005CC5;">input</span><span style="color:#24292E;"> value </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> empty. Additional keys </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;"> value should match the defined [</span><span style="color:#005CC5;">PARAMETERS</span><span style="color:#24292E;">] of the named </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">AVAILABLE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">FUNCTIONS</span><span style="color:#24292E;">].</span></span>
<span class="line"><span style="color:#24292E;">Dictionary values </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;"> must be strings </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> represent the actual values to be passed to the function.</span></span>
<span class="line"><span style="color:#24292E;">Ensure that the </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">JSON_BLOB</span><span style="color:#24292E;"> contains only a </span><span style="color:#005CC5;">SINGLE</span><span style="color:#24292E;"> action; do </span><span style="color:#005CC5;">NOT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> multiple actions.</span></span>
<span class="line"><span style="color:#005CC5;">IMPORTANT</span><span style="color:#24292E;">: Use only the available functions listed </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the [</span><span style="color:#005CC5;">AVAILABLE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">FUNCTIONS</span><span style="color:#24292E;">] section. Do </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> attempt to use </span><span style="color:#005CC5;">any</span><span style="color:#24292E;"> other functions that are </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> specified.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Here </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> an example of a valid </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">JSON_BLOB</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;pluginName-functionName&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;parameterName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;some value&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">...</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Here </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> another example of a valid </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">JSON_BLOB</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Plugin-Function&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;parameterName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;some value&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">...</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Here </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> another example of a valid </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">JSON_BLOB</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Plugin-FunctionName2&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;parameterName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;some value&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">...</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">The </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">JSON_BLOB</span><span style="color:#24292E;"> must contain an </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;"> key, </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> the {</span><span style="color:#032F62;">&quot;parameterName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;some value&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">...</span><span style="color:#24292E;">} value </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the response.</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">END</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">USAGE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INSTRUCTIONS</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">END</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">INSTRUCTION</span><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">THOUGHT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">PROCESS</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">QUESTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">the </span><span style="color:#005CC5;">input</span><span style="color:#24292E;"> question I must answer</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">THOUGHT</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">To solve this problem, I should carefully analyze the given question </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> identify the necessary steps. Any facts I discover earlier </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> my thought process should be repeated here to keep them readily available.</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">ACTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;plugin-functionName&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;parameterName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;some value&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">...</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">OBSERVATION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">The result of the action will be provided here.</span></span>
<span class="line"><span style="color:#005CC5;">...</span><span style="color:#24292E;"> (These Thought</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Action</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Observation can repeat until the final answer </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> reached.)</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">FINAL</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ANSWER</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">Once I have gathered </span><span style="color:#005CC5;">all</span><span style="color:#24292E;"> the necessary observations </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> performed </span><span style="color:#005CC5;">any</span><span style="color:#24292E;"> required actions, I can provide the final answer </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> a clear </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> human</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">readable </span><span style="color:#005CC5;">format</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">END</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">THOUGHT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">PROCESS</span><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Let</span><span style="color:#032F62;">&#39;s break down the problem step by step and think about the best approach. Questions and observations should be followed by a single thought and an optional single action to take.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Begin!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">QUESTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">{{</span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#24292E;">question}}</span></span>
<span class="line"><span style="color:#24292E;">{{</span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#24292E;">agent_scratch_pad}}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åç»­çš„ä¼šæ ¹æ® GPT çš„å›å¤ï¼Œè¿›è¡Œ Aciton æå–ï¼ŒObservation è®¡ç®—ä»¥åŠ Thought ç”Ÿæˆï¼Œé€»è¾‘ä¸ ReACT ä¸€è‡´ã€‚å‚è€ƒä¸Šæ–‡ä¸­çš„å®ä¾‹ä»£ç ï¼Œæˆ‘ä»¬å°†å¯¹åº”çš„ GPT å›å¤éƒ½æ‰“å°å‡ºæ¥å¦‚ä¸‹ï¼š</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">THOUGHT</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">To solve this problem, we need to perform two actions: first, we need to calculate the increase </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the investment by </span><span style="color:#005CC5;">23</span><span style="color:#D73A49;">%</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> then we need to subtract </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> the result. We can use the MathPlugin</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Add </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> MathPlugin</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Multiply functions to calculate the increase, </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> the MathPlugin</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Subtract function to subtract </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> the result.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">ACTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;MathPlugin-Multiply&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;input&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2130.23&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;amount&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;0.23&quot;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">Error parsing </span><span style="color:#005CC5;">XML</span><span style="color:#24292E;"> of prompt: mismatched tag: line </span><span style="color:#005CC5;">87</span><span style="color:#24292E;">, column </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">THOUGHT</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">Now that we have the increase </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the investment, we can use the MathPlugin</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Add function to add it to the original investment.</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">ACTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;MathPlugin-Add&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;input&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2130.23&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;amount&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;489.9529&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">Error parsing </span><span style="color:#005CC5;">XML</span><span style="color:#24292E;"> of prompt: mismatched tag: line </span><span style="color:#005CC5;">93</span><span style="color:#24292E;">, column </span><span style="color:#005CC5;">11</span></span>
<span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">THOUGHT</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">Finally, we need to subtract </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> the result to get the final amount.</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">ACTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#032F62;">&quot;action&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;MathPlugin-Subtract&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;action_variables&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;input&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2620.1829&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;amount&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;5&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">Error parsing </span><span style="color:#005CC5;">XML</span><span style="color:#24292E;"> of prompt: mismatched tag: line </span><span style="color:#005CC5;">99</span><span style="color:#24292E;">, column </span><span style="color:#005CC5;">11</span></span>
<span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">FINAL</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ANSWER</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">After investing </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">2130.23</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> increasing it by </span><span style="color:#005CC5;">23</span><span style="color:#D73A49;">%</span><span style="color:#24292E;">, then spending </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> on a coffee, the final amount </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">2615.1829</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#D73A49;">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">Step: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">Description: Execute a plan</span></span>
<span class="line"><span style="color:#24292E;">Function: StepwisePlanner.ExecutePlan</span></span>
<span class="line"><span style="color:#24292E;">  Output: After investing </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">2130.23</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> increasing it by </span><span style="color:#005CC5;">23</span><span style="color:#D73A49;">%</span><span style="color:#24292E;">, then spending </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> on a coffee, the final amount </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">$</span><span style="color:#005CC5;">2615.1829</span><span style="color:#24292E;">.</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³äº GPT å›å¤çš„å¤„ç†ï¼Œä¸å…¶ä»– planner ç±»ä¼¼çš„ï¼Œå½“å°è¯•ä½¿ç”¨ json æˆ–è€… xml ç­‰å·¥å…·æ— æ³•æ­£ç¡®æå–æ—¶ï¼Œéƒ½ä¼šä½¿ç”¨ re è¿›è¡Œé¢„å¤„ç†ã€‚</p><h2 id="_7-å…¶ä»–" tabindex="-1"><a class="header-anchor" href="#_7-å…¶ä»–" aria-hidden="true">#</a> 7. å…¶ä»–</h2><p><a href="https://github.com/microsoft/promptflow/tree/main" target="_blank" rel="noopener noreferrer">promptflowopen in new window<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­æœ‰å¯¹ Planner è¿›è¡Œè¯„æµ‹çš„ç¤ºä¾‹</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 417333277@qq.com">kevinng77</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">æ²ªICPå¤‡2023027904å·-1</a>&nbsp;<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=" target="_blank"><img src="/assets/gongan.png">å…¬å®‰å¤‡æ¡ˆå· </a></div><div class="vp-copyright">Copyright Â© 2024 Kevin å´å˜‰æ–‡</div></footer></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-90f47110.js" defer></script>
  </body>
</html>
